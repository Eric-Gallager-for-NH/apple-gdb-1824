<!DOCTYPE html>
<!-- saved from url=(0122)https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCFNOTIFICATION -->
<html lang="en"><script type="text/javascript">window["_gaUserPrefs"] = { ioo : function() { return true; } }</script><script>(function main() {
    // Create enabled event
    function fireEnabledEvent() {
        // If gli exists, then we are already present and shouldn't do anything
        if (!window.gli) {
            setTimeout(function () {
                var enabledEvent = document.createEvent("Event");
                enabledEvent.initEvent("WebGLEnabledEvent", true, true);
                document.dispatchEvent(enabledEvent);
            }, 0);
        } else {
            //console.log("WebGL Inspector already embedded on the page - disabling extension");
        }
    };

    // Grab the path root from the extension
    document.addEventListener("WebGLInspectorReadyEvent", function (e) {
        var pathElement = document.getElementById("__webglpathroot");
        if (window["gliloader"]) {
            gliloader.pathRoot = pathElement.innerText;
        } else {
            // TODO: more?
            window.gliCssUrl = pathElement.innerText + "gli.all.css";
        }
    }, false);

    // Rewrite getContext to snoop for webgl
    var originalGetContext = HTMLCanvasElement.prototype.getContext;
    if (!HTMLCanvasElement.prototype.getContextRaw) {
        HTMLCanvasElement.prototype.getContextRaw = originalGetContext;
    }
    HTMLCanvasElement.prototype.getContext = function () {
        var ignoreCanvas = this.internalInspectorSurface;
        if (ignoreCanvas) {
            return originalGetContext.apply(this, arguments);
        }

        var result = originalGetContext.apply(this, arguments);
        if (result == null) {
            return null;
        }

        var contextNames = ["moz-webgl", "webkit-3d", "experimental-webgl", "webgl", "3d"];
        var requestingWebGL = contextNames.indexOf(arguments[0]) != -1;
        if (requestingWebGL) {
            // Page is requesting a WebGL context!
            fireEnabledEvent(this);

            // If we are injected, inspect this context
            if (window.gli) {
                if (gli.host.inspectContext) {
                    // TODO: pull options from extension
                    result = gli.host.inspectContext(this, result);
                    // NOTE: execute in a timeout so that if the dom is not yet
                    // loaded this won't error out.
                    window.setTimeout(function() {
                        var hostUI = new gli.host.HostUI(result);
                        result.hostUI = hostUI; // just so we can access it later for debugging
                    }, 0);
                }
            }
        }

        return result;
    };
})();</script><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Technical Note TN2124: Mac OS X Debugging Magic</title>
    <meta http-equiv="X-UA-Compatible" content="IE=7">
    <meta charset="utf-8">
    <meta id="book-resource-type" name="book-resource-type" content="Technical Note">
    <meta scheme="apple_ref" id="identifier" name="identifier" content="//apple_ref/doc/uid/DTS10003391">
	<meta id="document-version" name="document-version" content="2.1.2">
    <meta id="build" name="build" content="6915aa962e5a833c4f77aad6384f2938">
    <meta id="chapterId" name="chapterId" content="DTS10003391-CH1">
    <meta id="date" name="date" content="2010-11-16">
    <meta id="description" name="description" content="TN2124: describes a large collection of Mac OS X debugging hints and tips.">
    <meta id="book-title" name="book-title" content="Mac OS X Debugging Magic">
    <meta id="book-name" name="book-name" contents="DTS_TN2124">
    <meta id="book-root" name="book-root" content="./">
    <meta id="book-json" name="book-json" content="book.json">
    <meta id="devcenter" name="devcenter" content="Mac Dev Center">
    <meta id="devcenter-url" name="devcenter-url" content="http://developer.apple.com/devcenter/mac">
    <meta id="reflib" name="reflib" content="Mac Developer Library">
    <meta id="book-assignments" name="book-assignments" content="{Type/Technical Note}, {Topic/General}">
    
    
    <meta id="generator" name="generator" content="Gutenberg bc32f2e6">
    <meta name="numbat" content="aa879094b666337fdcde744b62fbff30">
    <meta id="copyright" name="copyright" content="Copyright 2014 Apple Inc. All Rights Reserved.">
    <meta id="xcode-display" name="xcode-display" content="render">
    <meta id="IndexTitle" name="IndexTitle" content="Technical Note TN2124">
    <meta id="resources-uri" name="resources-uri" content="../../Resources/672">
    <link id="book-index-page" rel="Start" title="Mac OS X Debugging Magic" type="text/html" href="https://developer.apple.com/library/mac/technotes/tn2124/index.html">
    <link id="next-page" rel="Next" type="text/html" href="">
    <link id="previous-page" rel="Prev" type="text/html" href="">
    <link rel="stylesheet" type="text/css" href="./Technical Note TN2124  Mac OS X Debugging Magic_files/screen.css">
    
    <link rel="stylesheet" type="text/css" href="./Technical Note TN2124  Mac OS X Debugging Magic_files/feedback.css">
<style type="text/css"></style><meta name="chromesniffer" id="chromesniffer_meta" content="{&quot;Prototype&quot;:&quot;1.6.1&quot;}"><script type="text/javascript" src="chrome-extension://homgcnaoacgigpkkljjjekpignblkeae/detector.js"></script><script>window["_GOOG_TRANS_EXT_VER"] = "1";</script></head>    
<body id=""><a name="//apple_ref/doc/uid/DTS10003391" title="Technical Note TN2124"></a>
    <div id="adcHeader" class="hideOnPrint hideInXcode">
        <div id="ssi_Header" class="hideInXcode mac">
            <a id="ssi_LibraryTitle" href="https://developer.apple.com/library/mac/navigation/">Mac Developer Library</a>
            <a id="ssi_AppleDeveloperConnection" href="https://developer.apple.com/">Developer</a>
            <div id="ssi_SearchButton" role="button" title="Search">Search</div>
        </div>
        <form id="ssi_SearchMenu" method="get" action="https://developer.apple.com/library/mac/search/" accept-charset="utf-8">
            <label for="adcsearch">Search Mac Developer Library</label>
            <input type="search" id="ssi_SearchField" name="q" accesskey="s" results="5">
        </form>
    </div>

    <header id="header">
        <div id="title" role="banner">
            <h1>Mac OS X Debugging Magic</h1>
            <span id="file_links">
                <a id="PDF_link" role="button" tabindex="4" rel="alternate" title="Download PDF" class=""><span id="pdf_icon"></span>PDF</a>
                <a id="Companion_link" role="button" tabindex="3" title="Download Companion File" class=""><span id="companion_icon"></span>Companion File</a>
            </span>
        </div>
        <ul id="headerButtons" class="hideOnPrint" role="toolbar">
            <li id="toc_button" style="display: none;">
                <button tabindex="5" id="table_of_contents" class="" role="checkbox" aria-label="Show Table of Contents"><span class="disclosure"></span>Table of Contents</button>
            </li>
            <li id="jumpto_button" style="display: none;" role="navigation"><select tabindex="6" id="jumpTo"><option value="top">Jump Toâ€¦</option></select></li>
            <li id="downloadSample_button" style="display: none;">
                <a id="Sample_link"><button id="Sample_button">Download Sample Code</button></a>
            </li>
        </ul>
    </header>
    <nav id="tocContainer" tabindex="7" class="">
        <ul id="toc" role="tree"></ul>
    </nav>

    <article id="contents" tabindex="0" role="main" class="dts_doc">
        <!-- CONTENTS -->
        <div id="pageNavigationLinks_top" class="pageNavigationLinks">
            
        </div>
        <a id="top" name="top"></a>
        <a id="INDEX" href="https://developer.apple.com/library/mac/technotes/tn2124/index.html" style="display:none;"></a>
        
        <a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_2" title="Technical Note TN2124"></a><div class="dtsDocNumber">Technical Note TN2124</div><h1 id="pageTitle">Mac OS X Debugging Magic</h1><p>Mac OS X contains a number of 'secret' debugging facilities, including environment variables, preferences, routines callable from GDB, and so on. This technotes describes these facilities. If you're developing for Mac OS X, you should look through this list to see if you're missing out on something that will make your life easier.</p>

   
    <div class="outerMiniTOC">

        
			
            <div>
                <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECINTRO">Introduction</a>
                
                
                
            </div>
            
        
			
            <div>
                <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECBASICS">Basics</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECENABLE">Enabling Debugging Facilities</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECSEEINGOUTPUT">Seeing Debug Output</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECSOMEASSEMBLY">Some Assembly Required</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECINTEL64">Intel 64-Bit</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECINTEL32">Intel 32-Bit</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECPOWERPC">PowerPC</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECARCHITECTUREGOTCHAS">Architecture Gotchas</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCONTROLLEDCRASH">Controlled Crash</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECINSTRUMENTS">Instruments</a>
                
                
                
            </div>
            
        
			
            <div>
                <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCRASHREPORTER">CrashReporter</a>
                
                
                
            </div>
            
        
			
            <div>
                <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECBSD">BSD</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECMALLOC">Memory Allocator</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCPLUSPLUS">Standard C++ Library</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDYLD">Dynamic Linker (dyld)</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCOREDUMPS">Core Dumps</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECMALLOCDEBUG">MallocDebug and ObjectAlloc</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECGMALLOC">Guarded Memory Allocator</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECTOOLS">Command Line Tools</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDEBUGLIB">Debug Libraries</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECNOWINDOWSERVER">Escaping the Window Server</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDTRACE">DTrace</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDTRACETOOLS">DTrace-based Tools</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDAEMONS">Daemons</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECLAUNCHD">launchd</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDIRECTORYSERVICE">Directory Services</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECMDNSRESPONDER">mDNSResponder</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECNOTIFYD">notifyd</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECLOOKUPD">lookupd</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECPRINTING">Printing (CUPS)</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCORESERVICES">Core Services</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCF">Core Foundation</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECAE">Apple Events</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCFM">Code Fragment Manager (CFM)</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCOMPONENT">Component Manager</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCSFM">File Manager</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECFOLDERS">Folder Manager</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECGESTALT">Gestalt</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECPASTEBOARD">Pasteboard</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECTHREADING">Threading</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECWEBSERVICES">Web Services</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDISKS">Disks and Discs</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDISKARB">Disk Arbitration</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDISCRECORDING">Disc Recording</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDISKUTILITY">Disk Utility</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECAPPLICATIONSERVICES">Application Services</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCOREGRAPHICS">Core Graphics</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECPROCESSMANAGER">Process Manager</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECQUICKDRAW">QuickDraw</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECSERVICES">Services</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECQUICKLOOK">Quick Look</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCARBON">Carbon (HIToolbox)</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBPRINTERS">HIToolbox Object Printing Routines</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBFLASHERS">HIToolbox Region Flashing</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBEVENTDEBUG">HIToolbox Event Debugging</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBEVENTSTATS">HIToolbox Event Statistics</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBOTHER">Other HIToolbox Debugging Facilities</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCOCOA">Cocoa and Cocoa Touch</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECOBJECTIVEC">Objective-C</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECGC">Garbage Collection</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECFOUNDATION">Foundation</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCOREDATA">Core Data</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECAPPKIT">AppKit</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECSYNCSERVICES">Sync Services</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECNETWORKING">Networking</a>
                
                
                
            </div>
            
        
			
            <div>
                <a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-RevisionHistory-DontLinkElementID_1">Document Revision History</a>
                
                
                
            </div>
            
        
    </div>

<section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECINTRO" title="Introduction"></a><h2 class="jump">Introduction</h2><p>All Apple systems include debugging facilities added by Apple engineering teams to help develop and debug specific subsystems. Many of these facilities remain in released system software and you can use them to debug your code. This technote describes some of the more broadly useful ones. In cases where a debugging facility is documented in another place, there's a short overview of the facility and a link to the existing documentation.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_3" title="Important"></a><p><strong>Important:</strong>&nbsp;This is not an exhaustive list: not all debugging facilities are, or will be, documented.</p><p></p></aside></div><p>Many of the details covered in this technote vary from platform to platform and release to release. As such, you may encounter minor variations between platforms, and on older or newer systems. Known significant variations are called out in the text.</p><p>This technote was written with reference to Mac OS X 10.6.</p><div class="warningbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_4" title="Warning"></a><p><strong>Warning:</strong>&nbsp;The debugging facilities described in this technote are unsupported. Apple reserves the right to change or eliminate each facility as dictated by the evolution of the OS; this has happened in the past, and is very likely to happen again in the future. <strong>These facilities are for debugging only: you must not ship a product that relies on the existence or functionality of the facilities described in this technote.</strong></p><p></p><div class="clear"></div></aside></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_5" title="Note"></a><p><strong>Note:</strong>&nbsp;If you also develop for iOS, you may want to read <span class="content_text"><a href="https://developer.apple.com/technotes/tn2010/tn2239.html" class="urlLink" rel="external">Technical Note TN2239, 'iOS Debugging Magic'</a></span>.</p><p></p></aside></div><p>This technote covers advanced debugging techniques. If you're just getting started, you should consult the following material:</p><ul class="ul"><li class="li"><p>GDB is the system's primary debugging tool. For a full description of GDB, see <span class="content_text"><a href="http://developer.apple.com/library/mac/#documentation/DeveloperTools/gdb/gdb/gdb_toc.html" class="browserLink">Debugging with GDB</a></span>.</p></li><li class="li"><p>Xcode is Apple's integrated development environment (IDE). It includes a sophisticated graphical debugger, implemented as a wrapper around GDB. For more information about Xcode, see the "Tools &amp; Languages" section of the Apple developer <span class="content_text"><a href="http://developer.apple.com/library/mac/navigation/" class="browserLink">Reference Library</a></span>.</p></li></ul><p>This technote does not cover performance debugging. If you're trying to debug a performance problem, the best place to start is the <span class="content_text"><a href="http://developer.apple.com/library/mac/#referencelibrary/GettingStarted/GS_Performance/index.html" class="browserLink">Getting Started with Performance</a></span> document.</p><div class="back_to_top"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECBASICS" title="Basics"></a><h2 class="jump">Basics</h2><p>The later sections of this technote describe the debugging facilities in detail. Many of these facilities use similar techniques to enable and disable the facility, and to see its output. This section describes these common techniques.</p><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECENABLE" title="Enabling Debugging Facilities"></a><h3 class="jump">Enabling Debugging Facilities</h3><p>Some debugging facilities are enabled by default. However, most facilities must be enabled using one of the techniques described in the following sections.</p><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECENV" title="Environment Variables"></a><h4 class="jump">Environment Variables</h4><p>In many cases you can enable a debugging facility by setting a particular environment variable. You can do this using the executable inspector in Xcode. <span class="content_text"><!--a  -->Figure 1<!--/a--></span> shows an example of this.</p><figure class="figure"><a name="//apple_ref/doc/uid/DTS10003391-CH1-FIGURE1" title="Figure 1Setting environment variables in Xcode"></a><figcaption><strong class="caption_number">Figure 1</strong>&nbsp;&nbsp;Setting environment variables in Xcode</figcaption><img src="./Technical Note TN2124  Mac OS X Debugging Magic_files/tn2124_XCodeEnv.png" class="wide-image" alt="" width="739" height="582"><img src="./Technical Note TN2124  Mac OS X Debugging Magic_files/tn2124_XCodeEnv.png" class="ipad-scaled-image" alt="" width="670" height="527"></figure><p>In addition, there are a numerous other ways to set an environment variable. The first involves running your application from Terminal and specifying the environment variable on the command line. <span class="content_text"><!--a  -->Listing 1<!--/a--></span> shows how to set an environment variable in the <code>sh</code> shell; <span class="content_text"><!--a  -->Listing 2<!--/a--></span> shows the equivalent in <code>csh</code>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE1" title="Listing 1Setting an environment variable in an sh-compatible shell"></a><p class="codesample clear"><strong class="caption_number">Listing 1</strong>&nbsp;&nbsp;Setting an environment variable in an sh-compatible shell</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ MallocScribble=1 /Applications/TextEdit.app/Contents/MacOS/TextEdit  TextEdit(13506) malloc: enabling scribbling to detect mods to free blocks [â€¦]<span></span></pre></td></tr></tbody></table></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE2" title="Listing 2Setting an environment variable in a csh-compatible shell"></a><p class="codesample clear"><strong class="caption_number">Listing 2</strong>&nbsp;&nbsp;Setting an environment variable in a csh-compatible shell</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>% env MallocScribble=1 /Applications/TextEdit.app/Contents/MacOS/TextEdit TextEdit(13512) malloc: enabling scribbling to detect mods to free blocks [â€¦]<span></span></pre></td></tr></tbody></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_6" title="Note"></a><p><strong>Note:</strong>&nbsp;The default shell in Mac OS X 10.3 and later is <code>bash</code>, an <code>sh</code>-compatible shell. The default shell in Mac OS X 10.2.x and earlier was <code>tcsh</code>, a <code>csh</code>-compatible shell. Unless otherwise noted, the remainder of this technote assumes that you're using <code>bash</code>.</p><p></p></aside></div><p>In addition, you can set environment variables in GDB, as shown in <span class="content_text"><!--a  -->Listing 3<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE3" title="Listing 3Setting an environment variable in GDB"></a><p class="codesample clear"><strong class="caption_number">Listing 3</strong>&nbsp;&nbsp;Setting an environment variable in GDB</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ gdb /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 [â€¦]
(gdb) set env MallocScribble 1
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
bash(13587) malloc: enabling scribbling to detect mods to free blocks
[â€¦]<span></span></pre></td></tr></tbody></table></div><p><span class="content_text"><a href="https://developer.apple.com/qa/qa2001/qa1067.html" class="urlLink" rel="external">Technical Q&amp;A QA1067, 'Setting environment variables for user processes'</a></span> describes a mechanism for setting environment variables for all processes launched by a specific user.</p><p>Finally, you can use <code>launchctl</code> to set environment variables inherited by all processes run by <code>launchd</code>; see <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECLAUNCHD">launchd</a></span> for details.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECPREFS" title="Preferences"></a><h4 class="jump">Preferences</h4><p>Some debugging facilities are enabled by setting a special preference. You can set such a debugging preference by configuring a command line argument in Xcode. <span class="content_text"><!--a  -->Figure 2<!--/a--></span> shows how this is done.</p><figure class="figure"><a name="//apple_ref/doc/uid/DTS10003391-CH1-FIGURE2" title="Figure 2Setting command line arguments in Xcode"></a><figcaption><strong class="caption_number">Figure 2</strong>&nbsp;&nbsp;Setting command line arguments in Xcode</figcaption><img src="./Technical Note TN2124  Mac OS X Debugging Magic_files/tn2124_XcodeArgs.png" class="wide-image" alt="" width="681" height="749"><img src="./Technical Note TN2124  Mac OS X Debugging Magic_files/tn2124_XcodeArgs.png" class="ipad-scaled-image" alt="" width="670" height="736"></figure><p>You can also do this by running your program from the command line, and supplying the preference in the arguments. <span class="content_text"><!--a  -->Listing 4<!--/a--></span> shows an example.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE4" title="Listing 4Temporarily setting a preference"></a><p class="codesample clear"><strong class="caption_number">Listing 4</strong>&nbsp;&nbsp;Temporarily setting a preference</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ /Applications/TextEdit.app/Contents/MacOS/TextEdit -NSTraceEvents YES
2004-10-25 17:28:41.143 TextEdit[5774] timeout = 62993575878.857864 secoâ€¦
2004-10-25 17:28:41.179 TextEdit[5774] got apple event of class 61657674â€¦
[â€¦]<span></span></pre></td></tr></tbody></table></div><p>In addition to the temporary techniques described above, you can set preferences permanently using the <code>defaults</code> command line tool. <span class="content_text"><!--a  -->Listing 5<!--/a--></span> shows how to do this. This listing sets the <code>NSTraceEvents</code> preference for the TextEdit application (whose bundle identifier is <code>com.apple.TextEdit</code>) to YES.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE5" title="Listing 5Setting a preference using defaults"></a><p class="codesample clear"><strong class="caption_number">Listing 5</strong>&nbsp;&nbsp;Setting a preference using defaults</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ defaults write com.apple.TextEdit NSTraceEvents YES
$ /Applications/TextEdit.app/Contents/MacOS/TextEdit 
2010-02-01 13:32:36.260 TextEdit[18687:903] timeout = 62827180043.739540 seconds[â€¦]
2010-02-01 13:32:36.273 TextEdit[18687:903] got apple event of class 61657674, I[â€¦]
[â€¦]<span></span></pre></td></tr></tbody></table></div><p>Once you're finished debugging, you should delete the preference, also using <code>defaults</code>, as shown in <span class="content_text"><!--a  -->Listing 6<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE6" title="Listing 6Deleting a preference using defaults"></a><p class="codesample clear"><strong class="caption_number">Listing 6</strong>&nbsp;&nbsp;Deleting a preference using defaults</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ defaults delete com.apple.TextEdit NSTraceEvents<span></span></pre></td></tr></tbody></table></div><p>For more information about <code>defaults</code>, consult its <span class="content_text"><a href="x-man-page://1/defaults" class="urlLink" rel="external">man page</a></span>.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCALLFUNC" title="Callable Routines"></a><h4 class="jump">Callable Routines</h4><p>Many system frameworks include routines that print debugging information to <code>stderr</code>. These routines may be specifically designed to be callable from within GDB, or they may just be existing API routines that are useful while debugging. <span class="content_text"><!--a  -->Listing 7<!--/a--></span> shows an example of how to call a debugging routine from GDB; specifically, it calls <code>CFBundleGetAllBundles</code> to get a list of all the bundles loaded in the application, and then prints that list by calling the <code>CFShow</code> routine.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE7" title="Listing 7Calling a debugging routine from GDB"></a><p class="codesample clear"><strong class="caption_number">Listing 7</strong>&nbsp;&nbsp;Calling a debugging routine from GDB</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) call (void)CFShow((void *)CFBundleGetAllBundles())
&lt;CFArray 0x10025c010 [0x7fff701faf20]&gt;{type = mutable-small, count = 59, values = (
    0 : CFBundle 0x100234d00 &lt;/System/Library/Frameworks/CoreData.framework&gt; â€¦
    [â€¦]
    12 : CFBundle 0x100237790 &lt;/System/Library/Frameworks/Security.framework&gt; â€¦
    [â€¦]
    23 : CFBundle 0x100194eb0 &lt;/System/Library/Frameworks/CoreFoundation.framework&gt; â€¦
    [â€¦]
)}<span></span></pre></td></tr></tbody></table></div><p>If you don't see the output from the routine, you may need to look at the console log, as described in the <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECSEEINGOUTPUT">Seeing Debug Output</a></span> section.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_7" title="Important"></a><p><strong>Important:</strong>&nbsp;If you use this technique for your own code, be warned that it doesn't always work for routines that are declared <code>static</code>. The compiler's interprocedural optimizations may cause a <code>static</code> routine to deviate from the standard function call <span class="content_text"><a href="http://en.wikipedia.org/wiki/Application_binary_interface" class="urlLink" rel="external">ABI</a></span>. In that case, it can't be reliably called by GDB.</p><p></p></aside></div><p>In practice, this only affects Intel 32-bit code.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECFILES" title="Files"></a><h4 class="jump">Files</h4><p>Certain debugging facilities are enabled by the existence of specific files within the file system. <span class="content_text"><!--a  -->Listing 8<!--/a--></span> shows an example of this: creating the file <code>/var/log/do_dnserver_log</code> causes the CFNotificationCenter server (<span class="content_text"><a href="x-man-page://8/distnoted" class="urlLink" rel="external">distnoted</a></span>) to record information about all notifications to the system log.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE8" title="Listing 8Create a specific file to enable debugging"></a><p class="codesample clear"><strong class="caption_number">Listing 8</strong>&nbsp;&nbsp;Create a specific file to enable debugging</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ # IMPORTANT: This example is for Mac OS X 10.6 and later.
$ # See the "CFNotificationCenter" section for details on how 
$ # to do this on earlier systems.
$
$ sudo touch /var/log/do_dnserver_log

[â€¦ now restart â€¦]

$ tail -f /var/log/system.log
Virtual-Victim:~ quinn$ tail -f /var/log/system.log
[â€¦] distnoted[16]: checking_client "quicklookd" [43]
[â€¦] distnoted[16]: checking_client "Dock" [43]
[â€¦] distnoted[16]: checking_client "mds" [1]
[â€¦] distnoted[16]: checking_client "mDNSResponder" [1]
[â€¦] distnoted[16]: checking_client "fontd" [43]
[â€¦]<span></span></pre></td></tr></tbody></table></div><p>For more information about this specific example, see <span class="content_text"><a href="./Technical Note TN2124  Mac OS X Debugging Magic_files/Technical Note TN2124  Mac OS X Debugging Magic.html">CFNotificationCenter</a></span>.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECSIGNALS" title="Signals"></a><h4 class="jump">Signals</h4><p>Many Mac OS X subsystems, especially those with a BSD heritage, implement debugging facilities that you access via signals. For example, if you send the <code>SIGINFO</code> signal to <code>mDNSResponder</code>, it will dump its current state to the system log.</p><p>You can send signals programmatically or from the command line. To send a signal programmatically, use the <span class="content_text"><a href="x-man-page://2/kill" class="urlLink" rel="external">kill</a></span> routine. To send a signal from the command line, use either the <span class="content_text"><a href="x-man-page://1/kill" class="urlLink" rel="external">kill</a></span> command (if you know the process ID) or the <span class="content_text"><a href="x-man-page://1/killall" class="urlLink" rel="external">killall</a></span> command (if you know the process name).</p><p>When using these commands line tools, be aware that this technote uses the signal identifier (for example, <code>SIGINFO</code>) whereas these commands line tools use the signal name (<code>INFO</code>). So, to send a <code>SIGINFO</code> to <code>mDNSResponder</code>, you would use the command shown in <span class="content_text"><!--a  -->Listing 9<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE9" title="Listing 9Sending a signal"></a><p class="codesample clear"><strong class="caption_number">Listing 9</strong>&nbsp;&nbsp;Sending a signal</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ sudo killall -INFO mDNSResponder<span></span></pre></td></tr></tbody></table></div></section></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECSEEINGOUTPUT" title="Seeing Debug Output"></a><h3 class="jump">Seeing Debug Output</h3><p>Programs that generate debug output generally do so using one of following mechanisms:</p><ul class="ul"><li class="li"><p><code>NSLog</code></p></li><li class="li"><p>printing to <code>stderr</code></p></li><li class="li"><p>system log</p></li><li class="li"><p>kernel trace facility</p></li></ul><p><code>NSLog</code> is a high-level API for logging which is used extensively by Objective-C code. The exact behaviour of <code>NSLog</code> is surprisingly complex, and has changed significantly over time, making it beyond the scope of this document. However, it's sufficient to know that <code>NSLog</code> prints to <code>stderr</code>, or logs to the system log, or both. So, if you understand those two mechanisms, you can see anything logged via <code>NSLog</code>.</p><p>Printing to <code>stderr</code> is one of the most commonly used output mechanism. Given this topic's importance, it is covered in depth in the <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCONSOLE">next section</a></span>.</p><p>You can view the system log using the Console application (in <code>/Applications/Utilities</code>). You can learn more about the system log facility in the syslog man pages (<span class="content_text"><a href="x-man-page://3/asl" class="urlLink" rel="external">asl</a></span>, <span class="content_text"><a href="x-man-page://3/syslog" class="urlLink" rel="external">syslog</a></span>, <span class="content_text"><a href="x-man-page://5/syslog.conf" class="urlLink" rel="external">syslog.conf</a></span>, and <span class="content_text"><a href="x-man-page://8/syslogd" class="urlLink" rel="external">syslogd</a></span>).</p><p>The kernel trace facility is a specialized low-latency, high-availability logging mechanism. In most cases a program that logs to the kernel trace facility also includes a way to view the log (for example, the <span class="content_text"><a href="x-man-page://1/fs_usage" class="urlLink" rel="external">fs_usage</a></span> tool both enables file system usage logging and prints the results).</p><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCONSOLE" title="Console Output"></a><h4 class="jump">Console Output</h4><p>Many programs, and indeed many system frameworks, print debugging messages to <code>stderr</code>. The destination for this output is ultimately controlled by the program: it can redirect <code>stderr</code> to whatever destination it chooses. However, in most cases a program does not redirect <code>stderr</code>, so the output goes to the default destination inherited by the program from its launch environment. This is typically one of the following:</p><ul class="ul"><li class="li"><p>If you launch a GUI application as it would be launched by a normal user, the system redirects any messages printed on <code>stderr</code> to the system log. You can view these messages using the techniques <span class="content_text"><!--a  -->described earlier<!--/a--></span>.</p></li><li class="li"><p>If you run a program from within Xcode, you can see its <code>stderr</code> output in Xcode's debugger Console window (choose the Console menu item from the Run menu to see this window).</p></li><li class="li"><p>Finally, if you run a program (be it GUI or non-GUI) from within Terminal, its <code>stderr</code> is connected to your Terminal window; anything the program prints will appear in this window. This also applies to programs run from GDB within a Terminal window.</p></li></ul><p>Console messages (that is, system log records created in response to an application printing to <code>stderr</code>) are specially tagged to make them easy to find in the system log. There are two techniques for viewing these messages:</p><ul class="ul"><li class="li"><p>In the Console application (in <code>/Applications/Utilities</code>), there's a side bar item labelled Console Messages. If you select that item, the window displays only this type of message.</p></li><li class="li"><p>You can query ASL for console messages with the command shown in <span class="content_text"><!--a  -->Listing 10<!--/a--></span>.</p></li></ul><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE10" title="Listing 10Querying ASL for console messages"></a><p class="codesample clear"><strong class="caption_number">Listing 10</strong>&nbsp;&nbsp;Querying ASL for console messages</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ # This command just does a query and prints the results.
$ syslog -C
[â€¦]
[â€¦].com.apple.TextEdit[4373] &lt;Notice&gt;: Hello Cruel World!
$ # This command does the query, prints the results, and then waits 
$ # for any new results. Press ^C to stop it.
$ syslog -w -C
[â€¦]
[â€¦].com.apple.TextEdit[4373] &lt;Notice&gt;: Hello Cruel World!
[â€¦].com.apple.TextEdit[4373] &lt;Notice&gt;: Goodbye Cruel World!
^C<span></span></pre></td></tr></tbody></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_8" title="Note"></a><p><strong>Note:</strong>&nbsp;Prior to Mac OS X 10.5, console messages were recorded in a file. You can view these messages using the Console application, or using the commands shown in <span class="content_text"><!--a  -->Listing 11<!--/a--></span>.</p><p></p></aside></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE11" title="Listing 11Viewing console messages prior to Mac OS X 10.5"></a><p class="codesample clear"><strong class="caption_number">Listing 11</strong>&nbsp;&nbsp;Viewing console messages prior to Mac OS X 10.5</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ # This command prints the entire console log.
$ cat /Library/Logs/Console/`id -u`/console.log
[â€¦]
Hello Cruel World!
$ # This command prints the last few lines of the console log 
$ # and then waits for any new results. Press ^C to stop it.
$ tail -f /Library/Logs/Console/`id -u`/console.log
[â€¦]
Hello Cruel World!
Goodbye Cruel World!
^C<span></span></pre></td></tr></tbody></table></div><p>Attaching to a running program (using Xcode's Attach to Process menu, or the <code>attach</code> command in GDB) does not automatically connect the program's <code>stderr</code> to your GDB window. You can do this from within GDB using the trick described in the "Seeing stdout and stderr After Attaching" section of <span class="content_text"><a href="https://developer.apple.com/technotes/tn/tn2030.html" class="urlLink" rel="external">Technical Note TN2030, 'GDB for MacsBug Veterans'</a></span>.</p></section></section><div class="back_to_top"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECSOMEASSEMBLY" title="Some Assembly Required"></a><h2 class="jump">Some Assembly Required</h2><p>While it's very unusual to write a significant amount of code in assembly language these days, it's still useful to have a basic understanding of that dark art. This is particularly true when you're debugging, especially when you're debugging crashes that occur in libraries or frameworks for which you don't have the source code. This section covers some of the most basic techniques necessary to debug programs at the assembly level. Specifically, it describe how to set breakpoints, access parameters, and access the return address on all supported architectures.</p><p>All the assembly-level debugging examples shown in this technote are from 64-bit programs running on an Intel-based Macintosh computer. However, it's relatively easy to adapt these examples to other architectures. The most significant differences are:</p><ul class="ul"><li class="li"><p>accessing parameters</p></li><li class="li"><p>getting the return address</p></li></ul><p>And these are exactly the items covered by the following architecture-specific sections.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_9" title="Important"></a><p><strong>Important:</strong>&nbsp;The following architecture-specific sections contain rules of thumb. If the routine has any non-standard parameters, or a non-standard function result, these rules of thumb do not apply, and you should consult the documentation for the details.</p><p></p></aside></div><p>In this context, <strong>standard parameters</strong> are integers (that fit in a single register), enumerations, and pointers (including pointers to arrays and pointers to functions). Non-standard parameters are floating point numbers, vectors, structures, integers bigger than a register, and any parameter after the last fixed parameter of a routine that takes a variable number of arguments.</p><p>For a detailed description of the calling conventions for all Mac OS X architectures, see <span class="content_text"><a href="http://developer.apple.com/library/mac/#documentation/DeveloperTools/Conceptual/LowLevelABI/000-Introduction/introduction.html" class="browserLink">Mac OS X ABI Function Call Guide</a></span>.</p><p>Before you read the following sections, it's critical that you understand one GDB subtlety. Because GDB is, at heart, a source-level debugger, when you set a breakpoint on a routine, GDB does not set the breakpoint on the first instruction of the routine; rather, it sets the breakpoint at the first instruction after the routine's <span class="content_text"><a href="http://en.wikipedia.org/wiki/Function_prologue" class="urlLink" rel="external">prologue</a></span>. From a source-level debugging point of view this make perfect sense. In a source-level debugger you never want to step through the routine's prologue. However, when doing assembly-level debugging, it's easier to access parameters before the prologue runs. That's because the location of the parameters at the first instruction of a routine is determined by the function call <span class="content_text"><a href="http://en.wikipedia.org/wiki/Application_binary_interface" class="urlLink" rel="external">ABI</a></span>, but the prologue is allowed to shuffle things around at its discretion. Moreover, each prologue can do this in a slightly different way. So the only way to access parameters after the prologue has executed is to disassemble the prologue and work out where everything went. This is typically, but not always, quite easy, but it's still extra work.</p><p>The best way to tell GDB to set a breakpoint at the first instruction of a routine is to prefix the routine name with a "*". <span class="content_text"><!--a  -->Listing 12<!--/a--></span> shows an example of this.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE12" title="Listing 12Before and after the prologue"></a><p class="codesample clear"><strong class="caption_number">Listing 12</strong>&nbsp;&nbsp;Before and after the prologue</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ gdb
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) [â€¦]
(gdb) attach Finder
[â€¦]
(gdb) b CFStringCreateWithFormat
Breakpoint 1 at 0x7fff86098290
(gdb) info break
Num Type        Disp Enb Address            What
1   breakpoint  keep y   0x00007fff86098290 &lt;CFStringCreateWithFormat+32&gt;
(gdb) # The breakpoint is not at the first instruction.
(gdb) # Disassembling the routine shows that GDB has skipped the prologue.
(gdb) x/7i CFStringCreateWithFormat
0x7fff86098270 &lt;CFStringCreateWithFormat&gt;: push   %rbp
0x7fff86098271 &lt;CFStringCreateWithFormat+1&gt;: mov    %rsp,%rbp
0x7fff86098274 &lt;CFStringCreateWithFormat+4&gt;: sub    $0xd0,%rsp
0x7fff8609827b &lt;CFStringCreateWithFormat+11&gt;: mov    %rcx,-0x98(%rbp)
0x7fff86098282 &lt;CFStringCreateWithFormat+18&gt;: mov    %r8,-0x90(%rbp)
0x7fff86098289 &lt;CFStringCreateWithFormat+25&gt;: mov    %r9,-0x88(%rbp)
0x7fff86098290 &lt;CFStringCreateWithFormat+32&gt;: movzbl %al,%ecx
(gdb) # So we use a "*" prefix to disable GDB's 'smarts'.
(gdb) b *CFStringCreateWithFormat
Breakpoint 2 at 0x7fff86098270
(gdb) info break
Num Type        Disp Enb Address            What
1   breakpoint  keep y   0x00007fff86098290 &lt;CFStringCreateWithFormat+32&gt;
2   breakpoint  keep y   0x00007fff86098270 &lt;CFStringCreateWithFormat&gt;<span></span></pre></td></tr></tbody></table></div><p>Finally, if you're looking for information about specific instructions, be aware that the Help menu in Shark (included in the Xcode developer tools) has an instruction set reference for ARM, Intel and PowerPC architectures.</p><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECINTEL64" title="Intel 64-Bit"></a><h3 class="jump">Intel 64-Bit</h3><p>In 64-bit Intel programs the first six parameters are passed in registers. The return address is on the stack, but keep in mind that it is a 64-bit value. <span class="content_text"><!--a  -->Table 1<!--/a--></span> shows how to access these values from GDB when you've stopped at the first instruction of the function.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE1" title="Table 1Accessing parameters on Intel 64-bit"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 1</strong>&nbsp;&nbsp;Accessing parameters on Intel 64-bit</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
What
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
GDB Syntax
</p></th></tr><tr><td scope="row"><p>
return address
</p></td><td><p>
*(long*)$esp
</p></td></tr><tr><td scope="row"><p>
first parameter
</p></td><td><p>
$rdi
</p></td></tr><tr><td scope="row"><p>
second parameter
</p></td><td><p>
$rsi
</p></td></tr><tr><td scope="row"><p>
third parameter
</p></td><td><p>
$rdx
</p></td></tr><tr><td scope="row"><p>
fourth parameter
</p></td><td><p>
$rcx
</p></td></tr><tr><td scope="row"><p>
fifth parameter
</p></td><td><p>
$r8
</p></td></tr><tr><td scope="row"><p>
sixth parameter
</p></td><td><p>
$r9
</p></td></tr></tbody></table></div><p>On return from a function the result is in register RAX (<code>$rax</code>).</p><p>Because parameters are passed in registers, there's no straightforward way to access parameters after the prologue.</p><p><span class="content_text"><!--a  -->Listing 13<!--/a--></span> shows an example of how to use this information to access parameters in GDB.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE13" title="Listing 13Parameters on Intel 64-Bit"></a><p class="codesample clear"><strong class="caption_number">Listing 13</strong>&nbsp;&nbsp;Parameters on Intel 64-Bit</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ # Use the -arch x86_64 argument to GDB to get it to run the 
$ # 64-bit Intel binary. Obviously this will only work on 64-bit capable 
$ # hardware.
$ gdb -arch x86_64 /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) [â€¦]
(gdb) fb CFStringCreateWithFormat
Breakpoint 1 at 0x624dd2f1959290
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
Reading symbols for shared libraries [â€¦]
Breakpoint 1, 0x00007fff86098290 in CFStringCreateWithFormat ()
(gdb) # We've stopped after the prologue.
(gdb) p/a $pc
$1 = 0x7fff86098290 &lt;CFStringCreateWithFormat+32&gt;
(gdb) # We have to check whether the prologue 
(gdb) # has messed up the locations of the parameters.
(gdb) x/7i $pc-32
0x7fff86098270 &lt;CFStringCreateWithFormat&gt;: push   %rbp
0x7fff86098271 &lt;CFStringCreateWithFormat+1&gt;: mov    %rsp,%rbp
0x7fff86098274 &lt;CFStringCreateWithFormat+4&gt;: sub    $0xd0,%rsp
0x7fff8609827b &lt;CFStringCreateWithFormat+11&gt;: mov    %rcx,-0x98(%rbp)
0x7fff86098282 &lt;CFStringCreateWithFormat+18&gt;: mov    %r8,-0x90(%rbp)
0x7fff86098289 &lt;CFStringCreateWithFormat+25&gt;: mov    %r9,-0x88(%rbp)
0x7fff86098290 &lt;CFStringCreateWithFormat+32&gt;: movzbl %al,%ecx
(gdb) # Prologue hasn't messed up parameter registers, 
(gdb) # so we can just print them directly.
(gdb) #
(gdb) # first parameter is "alloc"
(gdb) p/a $rdi
$2 = 0x7fff70b8bf20 &lt;__kCFAllocatorSystemDefault&gt;
(gdb) # second parameter is "formatOptions"
(gdb) p/a $rsi
$3 = 0x0
(gdb) # third parameter is "format"
(gdb) call (void)CFShow($rdx)
%@
(gdb) # return address is at RBP+8
(gdb) p/a *(long*)($rbp+8)
$4 = 0x7fff8609a474 &lt;__CFXPreferencesGetNamedVolatileSourceForBundleID+36&gt;
(gdb) # Now clear the breakpoint and set a new one before the prologue.
(gdb) del 1
(gdb) b *CFStringCreateWithFormat
Breakpoint 2 at 0x7fff86098270
(gdb) c
Continuing.

Breakpoint 2, 0x00007fff86098270 in CFStringCreateWithFormat ()
(gdb) # We're at the first instruction. We can 
(gdb) # access parameters without checking the prologue.
(gdb) p/a $pc
$5 = 0x7fff86098270 &lt;CFStringCreateWithFormat&gt;
(gdb) # first parameter is "alloc"
(gdb) p/a $rdi
$6 = 0x7fff70b8bf20 &lt;__kCFAllocatorSystemDefault&gt;
(gdb) # second parameter is "formatOptions"
(gdb) p/a $rsi
$7 = 0x0
(gdb) # third parameter is "format"
(gdb) call (void)CFShow($rdx)
managed/%@/%@
(gdb) # return address is on top of the stack
(gdb) p/a *(long*)$rsp
$8 = 0x7fff8609806a &lt;__CFXPreferencesGetManagedSourceForBundleIDAndUser+74&gt;
(gdb) # Set a breakpoint on the return address.
(gdb) b *0x7fff8609806a
Breakpoint 3 at 0x7fff8609806a
(gdb) c
Continuing.

Breakpoint 3, 0x00007fff8609806a in __CFXPreferencesGetManagedSourceForBundleIDAndUser ()
(gdb) # function result
(gdb) p/a $rax
$9 = 0x10010b490
(gdb) call (void)CFShow($rax)
managed/com.apple.TextEdit/kCFPreferencesCurrentUser<span></span></pre></td></tr></tbody></table></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECINTEL32" title="Intel 32-Bit"></a><h3 class="jump">Intel 32-Bit</h3><p>In 32-bit Intel programs, parameters are passed on the stack. At the first instruction of a routine the top word of the stack contains the return address, the next word contains the first (leftmost) parameter, the next word contains the second parameter, and so on. <span class="content_text"><!--a  -->Table 2<!--/a--></span> shows how to access these values from GDB.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE2" title="Table 2Accessing parameters on Intel 32-bit"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 2</strong>&nbsp;&nbsp;Accessing parameters on Intel 32-bit</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
What
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
GDB Syntax
</p></th></tr><tr><td scope="row"><p>
return address
</p></td><td><p>
*(int*)$esp
</p></td></tr><tr><td scope="row"><p>
first parameter
</p></td><td><p>
*(int*)($esp+4)
</p></td></tr><tr><td scope="row"><p>
second parameter
</p></td><td><p>
*(int*)($esp+8)
</p></td></tr><tr><td scope="row"><p>
... and so on
</p></td><td><p>
</p></td></tr></tbody></table></div><p>After the routine's prologue you can access parameters relative to the frame pointer (register EBP). <span class="content_text"><!--a  -->Table 3<!--/a--></span> shows the syntax.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE3" title="Table 3Accessing parameters after the prologue"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 3</strong>&nbsp;&nbsp;Accessing parameters after the prologue</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
What
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
GDB Syntax
</p></th></tr><tr><td scope="row"><p>
previous frame
</p></td><td><p>
*(int*)$ebp
</p></td></tr><tr><td scope="row"><p>
return address
</p></td><td><p>
*(int*)($ebp+4)
</p></td></tr><tr><td scope="row"><p>
first parameter
</p></td><td><p>
*(int*)($ebp+8)
</p></td></tr><tr><td scope="row"><p>
second parameter
</p></td><td><p>
*(int*)($ebp+12)
</p></td></tr><tr><td scope="row"><p>
... and so on
</p></td><td><p>
</p></td></tr></tbody></table></div><p>On return from a function the result is in register EAX (<code>$eax</code>).</p><p><span class="content_text"><!--a  -->Listing 14<!--/a--></span> shows an example of how to use this information to access parameters in GDB.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE14" title="Listing 14Parameters on Intel 32-Bit"></a><p class="codesample clear"><strong class="caption_number">Listing 14</strong>&nbsp;&nbsp;Parameters on Intel 32-Bit</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ # Use the -arch i386 argument to GDB to get it to run the 
$ # 32-bit Intel binary.
$ gdb -arch i386 /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) [â€¦]
(gdb) fb CFStringCreateWithFormat
Breakpoint 1 at 0x31ec6d6
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
Reading symbols for shared libraries [â€¦]
Breakpoint 1, 0x940e36d6 in CFStringCreateWithFormat ()
(gdb) # We've stopped after the prologue.
(gdb) p/a $pc
$1 = 0x940e36d6 &lt;CFStringCreateWithFormat+6&gt;
(gdb) # However, for 32-bit Intel we don't need to inspect 
(gdb) # the prologue because the parameters are on the stack.
(gdb) # We can access them relative to EBP.
(gdb) #
(gdb) # first parameter is "alloc"
(gdb) p/a *(int*)($ebp+8)
$2 = 0xa0473ee0 &lt;__kCFAllocatorSystemDefault&gt;
(gdb) # second parameter is "formatOptions"
(gdb) p/a *(int*)($ebp+12)
$3 = 0x0
(gdb) # third parameter is "format"
(gdb) call (void)CFShow(*(int*)($ebp+16))
%@
(gdb) # return address is at EBP+4
(gdb) p/a *(int*)($ebp+4)
$4 = 0x940f59fb &lt;__CFXPreferencesGetNamedVolatileSourceForBundleID+59&gt;
(gdb) # Now clear the breakpoint and set a new one before the prologue.
(gdb) del 1
(gdb) b *CFStringCreateWithFormat
Breakpoint 2 at 0x940e36d0
(gdb) c
Continuing.

Breakpoint 2, 0x940e36d0 in CFStringCreateWithFormat ()
(gdb) # We're at the first instruction. We must access 
(gdb) # the parameters relative to ESP.
(gdb) p/a $pc
$6 = 0x940e36d0 &lt;CFStringCreateWithFormat&gt;
(gdb) # first parameter is "alloc"
(gdb) p/a *(int*)($esp+4)
$7 = 0xa0473ee0 &lt;__kCFAllocatorSystemDefault&gt;
(gdb) # second parameter is "formatOptions"
(gdb) p/a *(int*)($esp+8)
$8 = 0x0
(gdb) # third parameter is "format"
(gdb) call (void)CFShow(*(int*)($esp+12))
managed/%@/%@
(gdb) # return address is on the top of the stack
(gdb) p/a *(int*)$esp
$9 = 0x940f52cc &lt;__CFXPreferencesGetManagedSourceForBundleIDAndUser+76&gt;
(gdb) # Set a breakpoint on the return address.
(gdb) b *0x940f52cc
Breakpoint 3 at 0x940f52cc
(gdb) c
Continuing.

Breakpoint 3, 0x940f52cc in __CFXPreferencesGetManagedSourceForBundleIDAndUser ()
(gdb) # function result
(gdb) p/a $eax
$10 = 0x1079d0
(gdb) call (void)CFShow($eax)
managed/com.apple.TextEdit/kCFPreferencesCurrentUser<span></span></pre></td></tr></tbody></table></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECPOWERPC" title="PowerPC"></a><h3 class="jump">PowerPC</h3><p>In PowerPC programs, be their 32- or 64-bit, the first eight parameters are passed in registers. The return address is in register LR. <span class="content_text"><!--a  -->Table 4<!--/a--></span> shows how to access these values from GDB when you've stopped at the first instruction of the function.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE4" title="Table 4Accessing parameters on PowerPC"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 4</strong>&nbsp;&nbsp;Accessing parameters on PowerPC</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
What
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
GDB Syntax
</p></th></tr><tr><td scope="row"><p>
return address
</p></td><td><p>
$lr
</p></td></tr><tr><td scope="row"><p>
first parameter
</p></td><td><p>
$r3
</p></td></tr><tr><td scope="row"><p>
second parameter
</p></td><td><p>
$r4
</p></td></tr><tr><td scope="row"><p>
third parameter
</p></td><td><p>
$r5
</p></td></tr><tr><td scope="row"><p>
fourth parameter
</p></td><td><p>
$r6
</p></td></tr><tr><td scope="row"><p>
fifth parameter
</p></td><td><p>
$r7
</p></td></tr><tr><td scope="row"><p>
sixth parameter
</p></td><td><p>
$r8
</p></td></tr><tr><td scope="row"><p>
seventh parameter
</p></td><td><p>
$r9
</p></td></tr><tr><td scope="row"><p>
eight parameter
</p></td><td><p>
$r10
</p></td></tr></tbody></table></div><p>On return from a function the result is in register GPR3 (<code>$r3</code>).</p><p>Because parameters are passed in registers, there's no straightforward way to access parameters after the prologue.</p><p><span class="content_text"><!--a  -->Listing 15<!--/a--></span> shows an example of how to use this information to access parameters in GDB. This example shows a 32-bit PowerPC; however, the 32- and 64-bit PowerPC function call <span class="content_text"><a href="http://en.wikipedia.org/wiki/Application_binary_interface" class="urlLink" rel="external">ABIs</a></span> are so similar that the procedure is virtually identical for 64-bit programs.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_10" title="Note"></a><p><strong>Note:</strong>&nbsp;This example is from Mac OS X 10.5.x, the last system that supported PowerPC code natively.</p><p></p></aside></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE15" title="Listing 15Parameters on PowerPC"></a><p class="codesample clear"><strong class="caption_number">Listing 15</strong>&nbsp;&nbsp;Parameters on PowerPC</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ gdb /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-754) [â€¦]
(gdb) fb CFStringCreateWithFormat
Breakpoint 1 at 0x8b1bc
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
Reading symbols for shared libraries [â€¦]
Breakpoint 1, 0x90e871e8 in CFStringCreateWithFormat ()
(gdb) # We've stopped after the prologue.
(gdb) p/a $pc
$1 = 0x90e871e8 &lt;CFStringCreateWithFormat+44&gt;
(gdb) # Let's see what the prologue has done to the registers 
(gdb) # holding our parameters.
(gdb) x/12i $pc-44
0x90e871bc &lt;CFStringCreateWithFormat&gt;: mflr    r0
0x90e871c0 &lt;CFStringCreateWithFormat+4&gt;: stw     r0,8(r1)
0x90e871c4 &lt;CFStringCreateWithFormat+8&gt;: stwu    r1,-96(r1)
0x90e871c8 &lt;CFStringCreateWithFormat+12&gt;: addi    r0,r1,132
0x90e871cc &lt;CFStringCreateWithFormat+16&gt;: stw     r6,132(r1)
0x90e871d0 &lt;CFStringCreateWithFormat+20&gt;: mr      r6,r0
0x90e871d4 &lt;CFStringCreateWithFormat+24&gt;: stw     r0,56(r1)
0x90e871d8 &lt;CFStringCreateWithFormat+28&gt;: stw     r7,136(r1)
0x90e871dc &lt;CFStringCreateWithFormat+32&gt;: stw     r8,140(r1)
0x90e871e0 &lt;CFStringCreateWithFormat+36&gt;: stw     r9,144(r1)
0x90e871e4 &lt;CFStringCreateWithFormat+40&gt;: stw     r10,148(r1)
0x90e871e8 &lt;CFStringCreateWithFormat+44&gt;: bl      0x90e871a4 [â€¦]
(gdb) # Hey, the prologue hasn't modified GPR3..5, so we're OK.
(gdb) #
(gdb) # first parameter is "alloc"
(gdb) p/a $r3
$2 = 0xa019e174 &lt;__kCFAllocatorSystemDefault&gt;
(gdb) # second parameter is "formatOptions"
(gdb) p/a $r4
$3 = 0x0
(gdb) # third parameter is "format"
(gdb) call (void)CFShow($r5)
%@
(gdb) # It turns out the prologue has left LR intact as well.
(gdb) # So we can get our return address.
(gdb) p/a $lr
$4 = 0x90ebe604 &lt;__CFXPreferencesGetNamedVolatileSourceForBundleID+60&gt;
(gdb) # However, things aren't always this easy. If the prologue 
(gbb) # has munged LR, you can the return address out of the frame.
(gdb) p/a *(int*)($r1+96+8)
$8 = 0x90ebe604 &lt;__CFXPreferencesGetNamedVolatileSourceForBundleID+60&gt;
(gdb) # Now clear the breakpoint and set a new one before the prologue.
(gdb) del 1
(gdb) b *CFStringCreateWithFormat
Breakpoint 2 at 0x90e871bc
(gdb) c
Continuing.

Breakpoint 2, 0x90e871bc in CFStringCreateWithFormat ()
(gdb) # We're at the first instruction. The parameters are guaranteed 
(gdb) # to be in the right registers.
(gdb) p/a $pc
$9 = 0x90e871bc &lt;CFStringCreateWithFormat&gt;
(gdb) # first parameter is "alloc"
(gdb) p/a $r3
$10 = 0xa019e174 &lt;__kCFAllocatorSystemDefault&gt;
(gdb) # second parameter is "formatOptions"
(gdb) p/a $r4
$11 = 0x0
(gdb) # third parameter is "format"
(gdb) call (void)CFShow($r5)
managed/%@/%@
(gdb) # return address is in LR
(gdb) p/a $lr
$12 = 0x90ebe938 &lt;__CFXPreferencesGetManagedSourceForBundleIDAndUser+80&gt;
(gdb) # Set a breakpoint on the return address.
(gdb) b *0x90ebe938
Breakpoint 3 at 0x90ebe938
(gdb) c
Continuing.

Breakpoint 3, 0x90ebe938 in __CFXPreferencesGetManagedSourceForBundleIDAndUser ()
(gdb) # function result
(gdb) p/a $r3
$13 = 0x10e550
(gdb) call (void)CFShow($r3)
managed/com.apple.TextEdit/kCFPreferencesCurrentUser<span></span></pre></td></tr></tbody></table></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECARCHITECTUREGOTCHAS" title="Architecture Gotchas"></a><h3 class="jump">Architecture Gotchas</h3><p>The following sections describe a couple of gotchas you might encounter when debugging at the assembly level.</p><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECEXTRAPARAMETERS" title="Extra Parameters"></a><h4 class="jump">Extra Parameters</h4><p>When looking at parameters at the assembly level, keep in mind the following:</p><ul class="ul"><li class="li"><p>If the routine is a C++ member function, there is an implicit first parameter for <code>this</code>.</p></li><li class="li"><p>If the routine is an Objective-C method, there are two implicit first parameters (see <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECOBJECTIVEC">Objective-C</a></span> for details on this).</p></li><li class="li"><p>On PowerPC, a 64-bit integer is passed in either one register (for 64-bit programs) or two registers (for 32-bit programs).</p></li><li class="li"><p>If the compiler can find all the callers of a function, it can choose to pass parameters to that function in a non-standard way. This is very uncommon on architectures that have an efficient register-based <span class="content_text"><a href="http://en.wikipedia.org/wiki/Application_binary_interface" class="urlLink" rel="external">ABI</a></span>, but it's reasonably common for Intel 32-bit programs. So, if you set a breakpoint on a routine that isn't exported in an Intel 32-bit program, watch out for this very confusing behavior.</p></li></ul></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECENDIANNESS" title="Endianness and Unit Sizes"></a><h4 class="jump">Endianness and Unit Sizes</h4><p>When examining memory in GDB, things go smoother if you use the correct unit size. <span class="content_text"><!--a  -->Table 5<!--/a--></span> is a summary of the unit sizes supported by GDB.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE5" title="Table 5GDB unit sizes"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 5</strong>&nbsp;&nbsp;GDB unit sizes</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Size
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
C Type
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
GDB Unit
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Mnemonic
</p></th></tr><tr><td scope="row"><p>
1 byte
</p></td><td><p>
char
</p></td><td><p>
b
</p></td><td><p>
byte
</p></td></tr><tr><td scope="row"><p>
2 bytes
</p></td><td><p>
short
</p></td><td><p>
h
</p></td><td><p>
half word
</p></td></tr><tr><td scope="row"><p>
4 bytes
</p></td><td><p>
int
</p></td><td><p>
w
</p></td><td><p>
word
</p></td></tr><tr><td scope="row"><p>
8 bytes
</p></td><td><p>
long or long long
</p></td><td><p>
g
</p></td><td><p>
giant
</p></td></tr></tbody></table></div><p>This is particularly important in the following cases:</p><ul class="ul"><li class="li"><p>When debugging a 64-bit program, many quantities (for example, all pointers, including a routine's return address) will be 64 bits. GDB's default unit size ('w') will only show you 32 bits. You will need to specify 'g' in order to see all 64 bits.</p></li><li class="li"><p>When debugging on a little-endian system (that is, everything except PowerPC-based Macintosh computers), you get confusing results if you specify the wrong unit size. <span class="content_text"><!--a  -->Listing 16<!--/a--></span> shows an example of this. The second and third parameters of <code>CFStringCreateWithCharacters</code> specify an array of Unicode characters. Each element is a <code>UniChar</code>, which is a 16-bit number in native-endian format. As we're running on a little-endian system, you have to dump this array using the correct unit size, otherwise everything looks messed up.</p></li></ul><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE16" title="Listing 16Using the right unit size"></a><p class="codesample clear"><strong class="caption_number">Listing 16</strong>&nbsp;&nbsp;Using the right unit size</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ gdb
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) [â€¦]
(gdb) attach Finder
Attaching to process 4732.
Reading symbols for shared libraries . done
Reading symbols for shared libraries [â€¦]
0x00007fff81963e3a in mach_msg_trap ()
(gdb) b *CFStringCreateWithCharacters
Breakpoint 1 at 0x7fff86070520
(gdb) c
Continuing.

Breakpoint 1, 0x00007fff86070520 in CFStringCreateWithCharacters ()
(gdb) # The third parameter is the number of UniChars 
(gdb) # in the buffer pointed to by the first parameter.
(gdb) p (int)$rdx
$1 = 18
(gdb) # Dump the buffer as shorts. Everything makes sense.
(gdb) # This is the string "Auto-Save Recovery".
(gdb) x/18xh $rsi
0x10b7df292: 0x0041  0x0075  0x0074  0x006f  0x002d  0x0053  0x0061  0x0076
0x10b7df2a2: 0x0065  0x0020  0x0052  0x0065  0x0063  0x006f  0x0076  0x0065
0x10b7df2b2: 0x0072  0x0079
(gdb) # Now dump the buffer as words. Most confusing.
(gdb) # It looks like "uAotS-va eeRocevyr"!
(gdb) x/9xw $rsi
0x10b7df292: 0x00750041      0x006f0074      0x0053002d      0x00760061
0x10b7df2a2: 0x00200065      0x00650052      0x006f0063      0x00650076
0x10b7df2b2: 0x00790072
(gdb) # Now dump the buffer as bytes. This is a little less 
(gdb) # confusing, but you still have to remember that it's big 
(gdb) # endian data.
(gdb) x/36xb $rsi
0x10b7df292: 0x41    0x00    0x75    0x00    0x74    0x00    0x6f    0x00
0x10b7df29a: 0x2d    0x00    0x53    0x00    0x61    0x00    0x76    0x00
0x10b7df2a2: 0x65    0x00    0x20    0x00    0x52    0x00    0x65    0x00
0x10b7df2aa: 0x63    0x00    0x6f    0x00    0x76    0x00    0x65    0x00
0x10b7df2b2: 0x72    0x00    0x79    0x00<span></span></pre></td></tr></tbody></table></div><p>Finally, be aware that many BSD-level routines have different variants depending on the OS that you're running on, the SDK used to link the program, and the <code>MACOSX_DEPLOYMENT_TARGET</code> build setting. This can get very confusing when debugging at the assembly level. For example, <span class="content_text"><!--a  -->Listing 17<!--/a--></span> apparently shows <span class="content_text"><a href="x-man-page://1/curl" class="urlLink" rel="external">curl</a></span> downloading a URL without ever calling <span class="content_text"><a href="x-man-page://2/connect" class="urlLink" rel="external">connect</a></span>!</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE17" title="Listing 17Download without connect"></a><p class="codesample clear"><strong class="caption_number">Listing 17</strong>&nbsp;&nbsp;Download without connect</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ gdb -arch i386 /usr/bin/curl
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) [â€¦]
(gdb) # Run it once, for reasons that are just too hard to explain.
(gdb) r http://apple.com
Starting program: /usr/bin/curl http://apple.com
Reading symbols for shared libraries [â€¦]
&lt;head&gt;&lt;body&gt; This object may be found &lt;a HREF="http://www.apple.com/"&gt;here&lt;/a&gt; &lt;/body&gt;
Program exited normally.
(gdb) # Set a breakpoint and run it again.
(gdb) b *connect
Breakpoint 1 at 0x94bb7583
(gdb) r
Starting program: /usr/bin/curl http://apple.com
&lt;head&gt;&lt;body&gt; This object may be found &lt;a HREF="http://www.apple.com/"&gt;here&lt;/a&gt; &lt;/body&gt;
Program exited normally.
(gdb) # Huh!?!  We downloaded the web page without every calling connect!<span></span></pre></td></tr></tbody></table></div><p>The reason for this is that <code>curl</code> was linked with the Mac OS X 10.6 SDK with a deployment target of 10.6 and later. Therefore it calls a decorated version of <code>connect</code>, <code>connect$UNIX2003</code>. To see <code>curl</code> call <code>connect</code>, you have a set a breakpoint on that decorated symbol, as shown in <span class="content_text"><!--a  -->Listing 18<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE18" title="Listing 18Breaking on the decorated connect"></a><p class="codesample clear"><strong class="caption_number">Listing 18</strong>&nbsp;&nbsp;Breaking on the decorated connect</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ gdb -arch i386 /usr/bin/curl
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) [â€¦]
(gdb) # Run it once, for reasons that are just too hard to explain.
(gdb) r http://apple.com
Starting program: /usr/bin/curl http://apple.com
Reading symbols for shared libraries [â€¦]
&lt;head&gt;&lt;body&gt; This object may be found &lt;a HREF="http://www.apple.com/"&gt;here&lt;/a&gt; &lt;/body&gt;
Program exited normally.
(gdb) # Set the breakpoint on the decorated symbol. Note the user of 
(gdb) # single quotes to escape the dollar sign.
(gdb) b *'connect$UNIX2003'
Breakpoint 1 at 0x94b5636c
(gdb) r
Starting program: /usr/bin/curl http://apple.com

Breakpoint 1, 0x94b5636c in connect$UNIX2003 ()
(gdb) # Much better.<span></span></pre></td></tr></tbody></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_11" title="Note"></a><p><strong>Note:</strong>&nbsp;<span class="content_text"><!--a  -->Listing 18<!--/a--></span> runs the 32-bit version of <code>curl</code> to demonstrate the problem because this sort of decorated symbol malarkey is a compatibility feature for 32-bit code. Intel 64-bit programs don't require backward compatibility, and thus do not require separate <code>connect</code> and <code>connect$UNIX2003</code> symbols.</p><p></p></aside></div></section></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCONTROLLEDCRASH" title="Controlled Crash"></a><h3 class="jump">Controlled Crash</h3><p>In some cases it's useful to crash your program in a controlled manner. One common way to do this is to call <span class="content_text"><a href="x-man-page://3/abort" class="urlLink" rel="external">abort</a></span>. Another option is to use the <code>__builtin_trap</code> intrinsic function, which generates a machine-specific trap instruction. <span class="content_text"><!--a  -->Listing 19<!--/a--></span> shows how this is done.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE19" title="Listing 19Crashing via __builtin_trap"></a><p class="codesample clear"><strong class="caption_number">Listing 19</strong>&nbsp;&nbsp;Crashing via __builtin_trap</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>int main(int argc, char **argv) {     __builtin_trap();     return 1; }<span></span></pre></td></tr></tbody></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_12" title="Note"></a><p><strong>Note:</strong>&nbsp;The <code>__builtin_trap</code> intrinsic function generates a <code>trap</code> instruction on PowerPC and ARM, and a <code>ud2a</code> instruction on Intel.</p><p></p></aside></div><p>If you run the program in the debugger, you will stop at the line immediately before the <code>__builtin_trap</code> call. Otherwise the program will crash and generate a crash report.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_13" title="Note"></a><p><strong>Note:</strong>&nbsp;This technique is particularly useful prior to Mac OS X 10.5, where <code>abort</code> does not generate a crash log 
			(r. <span class="content_text"><a href="rdar://problem/3909440" class="urlLink" rel="external">3909440</a></span>)
		. </p><p></p></aside></div><div class="warningbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_14" title="Warning"></a><p><strong>Warning:</strong>&nbsp;We recommend that you restrict this technique to debug builds; your release builds should use <code>abort</code>.</p><p></p><div class="clear"></div></aside></div></section><div class="back_to_top"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECINSTRUMENTS" title="Instruments"></a><h2 class="jump">Instruments</h2><p>Instruments is an application for dynamically tracing and profiling code. It runs on Mac OS X and allows you to target programs running on Mac OS X, iOS devices, and the iPhone Simulator.</p><p>While Instruments is primarily focused on <span class="content_text"><!--a  -->performance debugging<!--/a--></span>, you can also use it for debugging errors. For example, the ObjectAlloc instrument can help you track down both over- and under-release bugs.</p><p>One particularly nice feature of Instruments is that it gives you easy access to <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECZOMBIES">zombies</a></span>. See the <span class="content_text"><a href="http://developer.apple.com/library/mac/#DOCUMENTATION/DeveloperTools/Conceptual/InstrumentsUserGuide/Introduction/Introduction.html" class="browserLink">Instruments User Guide</a></span> for details on this and other Instruments features.</p><div class="back_to_top"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCRASHREPORTER" title="CrashReporter"></a><h2 class="jump">CrashReporter</h2><p>CrashReporter is an invaluable debugging facility that logs information about all programs that crash. It is enabled all the time; all you have to do is look at its output.</p><p>CrashReporter is described in detail in <span class="content_text"><a href="https://developer.apple.com/technotes/tn2004/tn2123.html" class="urlLink" rel="external">Technical Note TN2123, 'CrashReporter'</a></span>.</p><div class="back_to_top"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECBSD" title="BSD"></a><h2 class="jump">BSD</h2><p>The BSD subsystem implements process, memory, file, and network infrastructure, and thus is critical to all programs on the system. BSD implements a number of neat debugging facilities that you can take advantage of.</p><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECMALLOC" title="Memory Allocator"></a><h3 class="jump">Memory Allocator</h3><p>The default memory allocator includes a number of debugging facilities that you can enable via environment variables. These are fully documented in the <span class="content_text"><a href="x-man-page://3/malloc" class="urlLink" rel="external">manual page</a></span>. <span class="content_text"><!--a  -->Table 6<!--/a--></span> lists some of the more useful ones.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE6" title="Table 6Some useful memory allocator environment variables"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 6</strong>&nbsp;&nbsp;Some useful memory allocator environment variables</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Variable
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td scope="row"><p>
MallocScribble
</p></td><td><p>
Fill allocated memory with 0xAA and scribble deallocated memory with 0x55
</p></td></tr><tr><td scope="row"><p>
MallocGuardEdges
</p></td><td><p>
Add guard pages before and after large allocations
</p></td></tr><tr><td scope="row"><p>
MallocStackLogging
</p></td><td><p>
Record stack logs for each memory block to assist memory debugging tools
</p></td></tr><tr><td scope="row"><p>
MallocStackLoggingNoCompact
</p></td><td><p>
Record stack logs for all operations to assist memory debugging tools
</p></td></tr></tbody></table></div><div class="warningbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_15" title="Warning"></a><p><strong>Warning:</strong>&nbsp;Prior to Mac OS X 10.5 <code>MallocStackLogging</code> and <code>MallocStackLoggingNoCompact</code> could produce erroneous and misleading results in a multi-threaded program.</p><p></p><div class="clear"></div></aside></div><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_16" title="Important"></a><p><strong>Important:</strong>&nbsp;These environment variables do <strong>not</strong> require a special memory library (unlike MallocDebug or the Guarded Memory Allocator). They are, in fact, supported by the default, non-debug memory allocator, and are, therefore, always available.</p><p></p></aside></div><p>The default memory allocator also logs messages if it detects certain common programming problems. For example, if you free a block of memory twice, or free memory that you never allocated, <code>free</code> may print the message shown in <span class="content_text"><!--a  -->Listing 20<!--/a--></span>. The number inside parentheses is the process ID.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE20" title="Listing 20A common message printed by free"></a><p class="codesample clear"><strong class="caption_number">Listing 20</strong>&nbsp;&nbsp;A common message printed by free</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>DummyPhone(1839) malloc: *** error for object 0x826600: double free *** set a breakpoint in malloc_error_break to debug<span></span></pre></td></tr></tbody></table></div><p>You can debug this sort of problem by running your program within GDB and putting a breakpoint on <code>malloc_error_break</code>. Once you hit the breakpoint, you can use GDB's <code>backtrace</code> command to determine the immediate caller.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_17" title="Note"></a><p><strong>Note:</strong>&nbsp;On Mac OS X 10.4.x you should set your breakpoint on <code>malloc_printf</code>.</p><p></p></aside></div><p>Finally, you can programmatically check the consistency of the heap using the <code>malloc_zone_check</code> routine (from <code>&lt;malloc.h&gt;</code>).</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCPLUSPLUS" title="Standard C++ Library"></a><h3 class="jump">Standard C++ Library</h3><p>The standard C++ library supports a number of debugging features:</p><ul class="ul"><li class="li"><p>Set the <code>_GLIBCXX_DEBUG</code> compile-time variable to enable debug mode in the standard C++ library.</p></li><li class="li"><p>In versions prior to GCC 4.0, set the <code>GLIBCPP_FORCE_NEW</code> environment variable to 1 to disable memory caching in the standard C++ library. This allows you to debug your C++ allocations with the other <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECMALLOC">memory debugging tools</a></span>.</p><p>In GCC 4.0 and later this is the default behavior.</p></li></ul></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECDYLD" title="Dynamic Linker (dyld)"></a><h3 class="jump">Dynamic Linker (dyld)</h3><p>The dynamic linker (dyld) supports a number of debugging facilities that you can enable via environment variables. These are fully documented in the <span class="content_text"><a href="x-man-page://1/dyld" class="urlLink" rel="external">manual page</a></span>. <span class="content_text"><!--a  -->Table 7<!--/a--></span> lists some of the more useful variables.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE7" title="Table 7Dynamic linker environment variables"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 7</strong>&nbsp;&nbsp;Dynamic linker environment variables</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Variable
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td scope="row"><p>
DYLD_IMAGE_SUFFIX
</p></td><td><p>
Search for libraries with this suffix first
</p></td></tr><tr><td scope="row"><p>
DYLD_PRINT_LIBRARIES
</p></td><td><p>
Log library loads
</p></td></tr><tr><td scope="row"><p>
DYLD_PRINT_LIBRARIES_POST_LAUNCH
</p></td><td><p>
As above, but only after main has run
</p></td></tr><tr><td scope="row"><p>
DYLD_PREBIND_DEBUG
</p></td><td><p>
Print prebinding diagnostics
</p></td></tr><tr><td scope="row"><p>
DYLD_PRINT_OPTS [1]
</p></td><td><p>
Print launch-time command line arguments
</p></td></tr><tr><td scope="row"><p>
DYLD_PRINT_ENV [1]
</p></td><td><p>
Print launch-time environment variables
</p></td></tr><tr><td scope="row"><p>
DYLD_IGNORE_PREBINDING [1]
</p></td><td><p>
Disable prebinding for performance testing
</p></td></tr><tr><td scope="row"><p>
DYLD_PRINT_APIS [1]
</p></td><td><p>
Log dyld API calls (for example, dlopen)
</p></td></tr><tr><td scope="row"><p>
DYLD_PRINT_BINDINGS [1]
</p></td><td><p>
Log symbol bindings
</p></td></tr><tr><td scope="row"><p>
DYLD_PRINT_INITIALIZERS [1]
</p></td><td><p>
Log image initialization calls
</p></td></tr><tr><td scope="row"><p>
DYLD_PRINT_SEGMENTS [1]
</p></td><td><p>
Log segment mapping
</p></td></tr><tr><td scope="row"><p>
DYLD_PRINT_STATISTICS [1]
</p></td><td><p>
Print launch performance statistics
</p></td></tr></tbody></table></div><p><strong>Notes:</strong></p><ol class="ol"><li class="li"><p>Available on Mac OS X 10.4 and later.</p></li></ol><p>On Mac OS X <code>DYLD_IMAGE_SUFFIX</code> is the most useful dyld environment variable because you can use it to enable the debug libraries, as described in <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDEBUGLIB">Debug Libraries</a></span>.</p><p>Finally, if you're loading code dynamically and the code fails to load, you can use the dynamic linker routine <code>NSLinkEditError</code> to get information about what went wrong error. <code>NSLinkEditError</code> works even if you're using a high-level API, like CFBundle, to load the code. Similarly, if you're loading code using <span class="content_text"><a href="x-man-page://3/dlopen" class="urlLink" rel="external">dlopen</a></span>, you can call <span class="content_text"><a href="x-man-page://3/dlerror" class="urlLink" rel="external">dlerror</a></span> to get information about load errors.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCOREDUMPS" title="Core Dumps"></a><h3 class="jump">Core Dumps</h3><p>Core dumps have an undeserved reputation as a primitive debugging facility. In reality they can be very helpful when debugging difficult problems, especially when you can't reproduce the problem locally.</p><p>You can enable core dumps on a system-wide basis by adding the line <code>limit core unlimited</code> to your <code>/etc/launchd.conf</code> file, creating it if necessary, and then restarting. For more information about this, see the <span class="content_text"><a href="x-man-page://5/launchd.conf" class="urlLink" rel="external">launchd.conf</a></span> man page.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_18" title="Note"></a><p><strong>Note:</strong>&nbsp;Prior to Mac OS X 10.4, you would enable core dumps on a system-wide basis by changing the line "COREDUMPS=-NO-" in <code>/etc/hostconfig</code> to "COREDUMPS=-YES-" and then restarting. </p><p></p></aside></div><p>Alternatively, if you run your program from Terminal, you can simply raise the core dump size limit in the shell beforehand. <span class="content_text"><!--a  -->Listing 21<!--/a--></span> shows an example of this.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE21" title="Listing 21Unlimited core dump size"></a><p class="codesample clear"><strong class="caption_number">Listing 21</strong>&nbsp;&nbsp;Unlimited core dump size</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ ulimit -c unlimited $ /Applications/TextEdit.app/Contents/MacOS/TextEdit [â€¦]<span></span></pre></td></tr></tbody></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_19" title="Note"></a><p><strong>Note:</strong>&nbsp;If you're using a <code>csh</code>-compatible shell, the corresponding command is shown in <span class="content_text"><!--a  -->Listing 22<!--/a--></span>.</p><p></p></aside></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE22" title="Listing 22Unlimited core dump size in a csh-compatible shell"></a><p class="codesample clear"><strong class="caption_number">Listing 22</strong>&nbsp;&nbsp;Unlimited core dump size in a csh-compatible shell</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>% limit coredumpsize unlimited<span></span></pre></td></tr></tbody></table></div><p>Core dumps are written to the directory <code>/cores</code>. On modern systems this directory is created by default. If it's not present on your system, you should create it with the commands shown in <span class="content_text"><!--a  -->Listing 23<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE23" title="Listing 23Creating the /cores directory"></a><p class="codesample clear"><strong class="caption_number">Listing 23</strong>&nbsp;&nbsp;Creating the /cores directory</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ sudo mkdir /cores $ sudo chown root:admin /cores $ sudo chmod 1775 /cores<span></span></pre></td></tr></tbody></table></div><p>The <code>/cores</code> must be writable by the program that's dumping core. By default, it is only writable by root and by users in the <code>admin</code> group. If you need normal users to be able to dump a core, you can make the directory world writable with the command shown in <span class="content_text"><!--a  -->Listing 24<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE24" title="Listing 24Creating the /cores directory"></a><p class="codesample clear"><strong class="caption_number">Listing 24</strong>&nbsp;&nbsp;Creating the /cores directory</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ sudo chmod o+w /cores<span></span></pre></td></tr></tbody></table></div><p>To test the core dump facility, send your program a <code>SIGABRT</code> signal using the <code>killall</code> command, as demonstrated by <span class="content_text"><!--a  -->Listing 25<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE25" title="Listing 25Testing core dumps by sending a SIGABRT"></a><p class="codesample clear"><strong class="caption_number">Listing 25</strong>&nbsp;&nbsp;Testing core dumps by sending a SIGABRT</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ killall -ABRT TextEdit<span></span></pre></td></tr></tbody></table></div><p>Your application will then quit with a "Abort trap (core dumped)" message. You can find the core dump in <code>/cores</code>. You can work out which core dump is which using the <code>otool</code> command. Finally, you can debug the core dump using GDB with the <code>-c</code> argument. <span class="content_text"><!--a  -->Listing 26<!--/a--></span> shows an example of this process.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE26" title="Listing 26Using core dumps"></a><p class="codesample clear"><strong class="caption_number">Listing 26</strong>&nbsp;&nbsp;Using core dumps</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>Abort trap (core dumped)
$ ls -lh /cores
total 924200
-r-------- 1 quinn  admin   451M Feb  1 14:25 core.180
$ otool -c /cores/core.180 
/cores/core.180:
Argument strings on the stack at: 00007fff5fc00000
    /Applications/TextEdit.app/Contents/MacOS/TextEdit

    [â€¦] 
    /Applications/TextEdit.app/Contents/MacOS/TextEdit
    TERM_PROGRAM=Apple_Terminal
    TERM=xterm-color
    SHELL=/bin/bash
    TMPDIR=/var/folders/3y/3yhwfA4XHhCpyl9B3eaPfk+++TM/-Tmp-/
    Apple_PubSub_Socket_Render=/tmp/launch-TvHq05/Render
    TERM_PROGRAM_VERSION=272
    USER=quinn
    COMMAND_MODE=unix2003
    SSH_AUTH_SOCK=/tmp/launch-xYN0cJ/Listeners
    __CF_USER_TEXT_ENCODING=0x1F6:0:0
    PATH=/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin
    PWD=/Users/quinn
    LANG=en_US.UTF-8
    SHLVL=1
    HOME=/Users/quinn
    LOGNAME=quinn
    DISPLAY=/tmp/launch-NaLgZ1/:0
    _=/Applications/TextEdit.app/Contents/MacOS/TextEdit
$ gdb -c /cores/core.180 
GNU gdb 6.3.50-20050815 (Apple version gdb-1344) [â€¦]
#0  0x00007fff8071fefa in mach_msg_trap ()
(gdb) bt
#0  0x00007fff8071fefa in mach_msg_trap ()
#1  0x00007fff8072056d in mach_msg ()
#2  0x00007fff83865ce2 in CFRunLoopRunSpecific ()
#3  0x00007fff8386503f in CFRunLoopRunSpecific ()
#4  0x00007fff80223c4e in BlockUntilNextEventMatchingListInMode ()
#5  0x00007fff80223a53 in BlockUntilNextEventMatchingListInMode ()
#6  0x00007fff8022390c in BlockUntilNextEventMatchingListInMode ()
#7  0x00007fff86466570 in _NSSafeOrderFront ()
#8  0x00007fff86465ed9 in _NSSafeOrderFront ()
#9  0x00007fff8642bb29 in _NSKitBundle ()
#10 0x00007fff86424844 in NSApplicationMain ()
#11 0x0000000100000fb8 in ?? ()<span></span></pre></td></tr></tbody></table></div><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_20" title="Important"></a><p><strong>Important:</strong>&nbsp;Core dumps are large. In the example <span class="content_text"><!--a  -->above<!--/a--></span>, TextEdit's core dump is 451 MB. If you have core dumps enabled as a matter of course, make sure that you regularly clean out <code>/cores</code> to avoid filling up your startup disk.</p><p></p></aside></div><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCOREPROGRAMMATIC" title="Enabling Core Dumps For Your Process"></a><h4 class="jump">Enabling Core Dumps For Your Process</h4><p>If you want to enable core dumps for your program programmatically, you can call <span class="content_text"><a href="x-man-page://2/setrlimit" class="urlLink" rel="external">setrlimit</a></span> to change the value for <code>RLIMIT_CORE</code>. The system ships with a soft limit of zero but a hard limit of infinity. Thus, core dumps aren't generated by default, but you can enable them for your process by raising the soft limit, as shown in <span class="content_text"><!--a  -->Listing 27<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE27" title="Listing 27Enabling core dumps programmatically"></a><p class="codesample clear"><strong class="caption_number">Listing 27</strong>&nbsp;&nbsp;Enabling core dumps programmatically</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>#include &lt;sys/resource.h&gt;

static bool EnableCoreDumps(void)
{
    struct rlimit   limit;

    limit.rlim_cur = RLIM_INFINITY;
    limit.rlim_max = RLIM_INFINITY;
    return setrlimit(RLIMIT_CORE, &amp;limit) == 0;
}<span></span></pre></td></tr></tbody></table></div><p>This does not, however, obviate the need for a writable <code>/cores</code> directory.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCOREGDB" title="Generating a Core Dump From GDB"></a><h4 class="jump">Generating a Core Dump From GDB</h4><p>If you want at generate a core dump from within GDB, just turn GDB's <code>unwindonsignal</code> setting off and force GDB to call <span class="content_text"><a href="x-man-page://3/abort" class="urlLink" rel="external">abort</a></span>. <span class="content_text"><!--a  -->Listing 28<!--/a--></span> shows an example of this.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE28" title="Listing 28Generating a core from within GDB"></a><p class="codesample clear"><strong class="caption_number">Listing 28</strong>&nbsp;&nbsp;Generating a core from within GDB</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ # Core dumps are enabled.
$ ulimit -c
unlimited
$ # Look ma, no cores!
$ ls -lh /cores
$ gdb /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-1344) [â€¦]
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
Reading symbols for shared libraries [â€¦]
^C
Program received signal SIGINT, Interrupt.
0x00007fff8071fefa in mach_msg_trap ()
(gdb) set unwindonsignal off
(gdb) call (void)abort()

Program received signal SIGABRT, Aborted.
0x00007fff8076e096 in __kill ()
The program being debugged was signaled while in a function called from GDB.
GDB remains in the frame where the signal was received.
To change this behavior use "set unwindonsignal on"
Evaluation of the expression containing the function (abort) will be abandoned.
(gdb) c
Continuing.

Program received signal SIGABRT, Aborted.
0x00007fff8076e096 in __kill ()
(gdb) c
Continuing.

Program terminated with signal SIGABRT, Aborted.
The program no longer exists.
(gdb) quit
$ # And lo, we have a core.
$ ls -l /cores
$ ls -lh /cores
total 925128
-r-------- 1 quinn  admin   452M Feb  1 14:43 core.273<span></span></pre></td></tr></tbody></table></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCORERETRO" title="Enabling Core Dumps Retroactively"></a><h4 class="jump">Enabling Core Dumps Retroactively</h4><p>You can take a core dump even if you forgot to enable core dumps when you launched your process. The trick is to use GDB to enable core dumps programmatically. <span class="content_text"><!--a  -->Listing 29<!--/a--></span> shows how to do this.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE29" title="Listing 29Using GDB to enable core dumps retroactively"></a><p class="codesample clear"><strong class="caption_number">Listing 29</strong>&nbsp;&nbsp;Using GDB to enable core dumps retroactively</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ gdb
GNU gdb 6.3.50-20050815 (Apple version gdb-1344) [â€¦]
(gdb) # Attach to the process.
(gdb) attach TextEdit.300 
Attaching to process 300.
Reading symbols for shared libraries [â€¦]
0x00007fff8071fefa in mach_msg_trap ()
(gdb) # Allocate a buffer for a (struct limit).
(gdb) set $limit=(long long *)malloc(16)
(gdb) # Set both rlim_cur and rlim_max to RLIM_INFINITY.
(gdb) set $limit[0]=0x7fffffffffffffff
(gdb) set $limit[1]=0x7fffffffffffffff
(gdb) # Call setrlimit. Note that 4 is RLIMIT_CORE.
(gdb) call (int)setrlimit(4, $limit)
$1 = 0
(gdb) # Detach from the process.
(gdb) detach
Detaching from process 300.
(gdb) q
$ # Nothing in /cores yet.
$ ls -lh /cores
$ # Tell TextEdit to dump core.
$ killall -ABRT TextEdit
$ # And lo, we have a core.
$ ls -lh /cores
total 925144
-r-------- 1 quinn  admin   452M Feb  1 14:57 core.300<span></span></pre></td></tr></tbody></table></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCORERUNNING" title="Generating a Core Dump of a Running Process"></a><h4 class="jump">Generating a Core Dump of a Running Process</h4><p>There are times when it's handy to generate a core dump of a running process without killing it. On other UNIX-based platforms you can do this with the <code>gcore</code> utility. Mac OS X does not currently have this utility built-in 
			(r. <span class="content_text"><a href="rdar://problem/3909440" class="urlLink" rel="external">3909440</a></span>)
		. However, there is a <span class="content_text"><a href="http://www.osxbook.com/book/bonus/chapter8/core/" class="urlLink" rel="noreferrer">third party version</a></span> that you might find helpful.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCORELEGACY" title="Core Dumps Prior to Mac OS X 10.5"></a><h4 class="jump">Core Dumps Prior to Mac OS X 10.5</h4><p>Prior to Mac OS X 10.5 the backtrace you get from a core dump (as shown in <span class="content_text"><!--a  -->Listing 26<!--/a--></span>) contained no symbolic information. However, if you have a symbol file handy, you can tell GDB to consult it using the <code>add-symbol-file</code> command. <span class="content_text"><!--a  -->Listing 30<!--/a--></span> shows how to do this for the system frameworks used by a TextEdit backtrace.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE30" title="Listing 30Adding symbols"></a><p class="codesample clear"><strong class="caption_number">Listing 30</strong>&nbsp;&nbsp;Adding symbols</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) # on 10.4.x the backtrace has no symbols
(gdb) bt
#0  0x900075c8 in ?? ()
#1  0x90007118 in ?? ()
#2  0x901960bc in ?? ()
#3  0x927d5ecc in ?? ()
#4  0x927dc640 in ?? ()
#5  0x927fe6d0 in ?? ()
#6  0x92dd2a80 in ?? ()
#7  0x92de93fc in ?? ()
#8  0x92dfd730 in ?? ()
#9  0x92eb9a1c in ?? ()
#10 0x00007d98 in ?? ()
#11 0x00007c0c in ?? ()
(gdb) # add symbols from a bunch of frameworks
(gdb) add-symbol-file /System/Library/Frameworks/AppKit.framework/AppKit 
[â€¦]
(gdb) add-symbol-file /System/Library/Frameworks/CoreFoundation.framework\
/CoreFoundation 
[â€¦]
(gdb) add-symbol-file /System/Library/Frameworks/System.framework/System
[â€¦]
#12 0x00007c0c in ?? ()
(gdb) add-symbol-file /System/Library/Frameworks/Carbon.framework/\
Frameworks/HIToolbox.framework/HIToolbox
[â€¦]
(gdb) # and lo, symbols!
(gdb) bt
#0  0x900075c8 in mach_msg_trap ()
#1  0x90007118 in mach_msg ()
#2  0x90191930 in __CFRunLoopRun ()
#3  0x901960bc in CFRunLoopRunSpecific ()
#4  0x927d5ecc in RunCurrentEventLoopInMode ()
#5  0x927dc640 in ReceiveNextEventCommon ()
#6  0x927fe6d0 in BlockUntilNextEventMatchingListInMode ()
#7  0x92dd2a80 in _DPSNextEvent ()
#8  0x92de93fc in -[NSApplication nextEventMatchingMask:untilDate:inMode:â€¦
#9  0x92dfd730 in -[NSApplication run] ()
#10 0x92eb9a1c in NSApplicationMain ()
#11 0x00007d98 in ?? ()
#12 0x00007c0c in ?? ()<span></span></pre></td></tr></tbody></table></div><p>This technique assumes that you're looking at the core file on the machine that create it, immediately after creating it. If the core file was created on a different machine, even an identical machine with the same system software installed, or if the system software has been updated since the core file was created, you will get inaccurate results.</p><p>Also, prior to Mac OS X 10.5, GDB had a bug in its handling of core files such that you couldn't look at a PowerPC core file on an Intel-based computer, or vice versa 
			(r. <span class="content_text"><a href="rdar://problem/4280384" class="urlLink" rel="external">4280384</a></span>)
		. In addition, GDB had a bug that prevents you from debugging Intel core files properly 
			(r. <span class="content_text"><a href="rdar://problem/4677738" class="urlLink" rel="external">4677738</a></span>)
		.</p><p>The aforementioned restrictions make core dumps much less useful on pre-10.5 systems. However, they can still be helpful. Keep in mind that, if your program crashes infrequently at a specific customer's site, a core dump may be the only way to discover the state of your program at the time of the crash.</p></section></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECMALLOCDEBUG" title="MallocDebug and ObjectAlloc"></a><h3 class="jump">MallocDebug and ObjectAlloc</h3><p>Mac OS X includes two GUI applications for memory allocation debugging, MallocDebug and ObjectAlloc. For more information about these tools, see the <span class="content_text"><a href="http://developer.apple.com/library/mac/#documentation/Performance/Conceptual/ManagingMemory/ManagingMemory.html" class="browserLink">Memory Usage Performance Guidelines</a></span> document.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECGMALLOC" title="Guarded Memory Allocator"></a><h3 class="jump">Guarded Memory Allocator</h3><p>Mac OS X includes a guarded memory allocator, <code>libgmalloc</code>, that you can use during debugging to catch common memory problems, such as buffer overruns and use-after-free. The easiest way to enable the guarded memory allocator is by checking Enable Guard Malloc in the Run menu in Xcode.</p><p>Alternatively, if you're running the program directly from GDB, you can enable it as shown in <span class="content_text"><!--a  -->Listing 31<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE31" title="Listing 31Enabling libgmalloc"></a><p class="codesample clear"><strong class="caption_number">Listing 31</strong>&nbsp;&nbsp;Enabling libgmalloc</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ gdb /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-1344) [â€¦]
(gdb) set env DYLD_INSERT_LIBRARIES /usr/lib/libgmalloc.dylib
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
GuardMalloc: Allocations will be placed on 16 byte boundaries.
GuardMalloc: - Some buffer overruns may not be noticed.
GuardMalloc: - Applications using vector instructions (e.g., SSE or Altivec) should work.
GuardMalloc: GuardMalloc version 18
[â€¦]<span></span></pre></td></tr></tbody></table></div><p>You can learn more about <code>libgmalloc</code> from its <span class="content_text"><a href="x-man-page://3/libgmalloc" class="urlLink" rel="external">man page</a></span>.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_21" title="Note"></a><p><strong>Note:</strong>&nbsp;In Mac OS X 10.3.x, <code>libgmalloc</code> required that you force a flat namespace (by setting the <code>DYLD_FORCE_FLAT_NAMESPACE</code> environment variable). This is not necessary on later systems.</p><p></p></aside></div><p>For information about how using <code>libgmalloc</code> on Mac OS X 10.3.x, see the <code>libgmalloc</code> man page on that system.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECTOOLS" title="Command Line Tools"></a><h3 class="jump">Command Line Tools</h3><p>Mac OS X includes a number of cool command line tools for debugging. <span class="content_text"><!--a  -->Table 8<!--/a--></span> lists some of the best.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE8" title="Table 8Command line tool highlights"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 8</strong>&nbsp;&nbsp;Command line tool highlights</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Tool
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Documentation
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td scope="row"><p>
gdb
</p></td><td><p>
manual page,
Debugging with GDB
</p></td><td><p>
Command line debugger
</p></td></tr><tr><td scope="row"><p>
dtrace
</p></td><td><p>
manual page
</p></td><td><p>
Dynamic, comprehensive and sophisticated tracing; 
see DTrace for more information [1]
</p></td></tr><tr><td scope="row"><p>
fs_usage
</p></td><td><p>
manual page
</p></td><td><p>
File system trace tool
</p></td></tr><tr><td scope="row"><p>
sc_usage
</p></td><td><p>
manual page
</p></td><td><p>
System call trace tool
</p></td></tr><tr><td scope="row"><p>
plockstat
</p></td><td><p>
manual page
</p></td><td><p>
pthread mutex and read/write lock statistics
</p></td></tr><tr><td scope="row"><p>
latency
</p></td><td><p>
manual page
</p></td><td><p>
Scheduling latency debugging tool
</p></td></tr><tr><td scope="row"><p>
heap
</p></td><td><p>
manual page
</p></td><td><p>
Heap dump
</p></td></tr><tr><td scope="row"><p>
vmmap
</p></td><td><p>
manual page
</p></td><td><p>
Address space dump
</p></td></tr><tr><td scope="row"><p>
malloc_history
</p></td><td><p>
manual page
</p></td><td><p>
Memory allocation history
</p></td></tr><tr><td scope="row"><p>
leaks
</p></td><td><p>
manual page
</p></td><td><p>
Leak detection
</p></td></tr><tr><td scope="row"><p>
tcpdump
</p></td><td><p>
manual page, 
Technical Q&amp;A QA1176, 'Getting a Packet Trace'
</p></td><td><p>
Network packet trace
</p></td></tr><tr><td scope="row"><p>
netstat
</p></td><td><p>
manual page
</p></td><td><p>
Network statistics; netstat -an shows all network connections
</p></td></tr><tr><td scope="row"><p>
lsof
</p></td><td><p>
manual page
</p></td><td><p>
List open files
</p></td></tr><tr><td scope="row"><p>
fuser
</p></td><td><p>
manual page
</p></td><td><p>
Show processes with file open
</p></td></tr><tr><td scope="row"><p>
PPCExplain
</p></td><td><p>
</p></td><td><p>
PPC mnemonics explained
</p></td></tr><tr><td scope="row"><p>
ktrace, kdump
</p></td><td><p>
manual page
</p></td><td><p>
Kernel tracing [2]
</p></td></tr><tr><td scope="row"><p>
otool
</p></td><td><p>
manual page
</p></td><td><p>
Displays object file
</p></td></tr><tr><td scope="row"><p>
nm
</p></td><td><p>
manual page
</p></td><td><p>
Displays symbol table in object file
</p></td></tr><tr><td scope="row"><p>
class-dump
</p></td><td><p>
</p></td><td><p>
Displays Objective-C runtime information in object file
</p></td></tr><tr><td scope="row"><p>
dyldinfo
</p></td><td><p>
manual page
</p></td><td><p>
Displays dyld information in object file [3]
</p></td></tr></tbody></table></div><p><strong>Notes:</strong></p><ol class="ol"><li class="li"><p>Available in Mac OS X 10.5 and later.</p></li><li class="li"><p><code>ktrace</code> and <code>kdump</code> are not available in Mac OS X 10.5 and later; use <code>dtrace</code> or <code>dtruss</code> instead.</p></li><li class="li"><p>Available in Mac OS X 10.6 and later.</p></li></ol></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECDEBUGLIB" title="Debug Libraries"></a><h3 class="jump">Debug Libraries</h3><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_22" title="Important"></a><p><strong>Important:</strong>&nbsp;The debug and profile libraries are not currently available for Mac OS X 10.6 and later 
			(r. <span class="content_text"><a href="rdar://problem/7432152" class="urlLink" rel="external">7432152</a></span>)
		 
			(r. <span class="content_text"><a href="rdar://problem/7289236" class="urlLink" rel="external">7289236</a></span>)
		. The examples in this section are from Mac OS X 10.5.</p><p></p></aside></div><p>Many Mac OS X frameworks include both a production and a debug variant. The debug variant has the suffix "_debug". For example, the Core Foundation framework's production variant is <code>/System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation</code> while its debug variant is <code>/System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation_debug</code>. You can force dyld to load the debug variant of a library (if such a variant exists) by setting the <code>DYLD_IMAGE_SUFFIX</code> environment variable to "_debug". <span class="content_text"><!--a  -->Listing 32<!--/a--></span> shows an example of how to do this from within Terminal.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE32" title="Listing 32Using _debug libraries"></a><p class="codesample clear"><strong class="caption_number">Listing 32</strong>&nbsp;&nbsp;Using _debug libraries</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ DYLD_IMAGE_SUFFIX=_debug /Applications/TextEdit.app/Contents/MacOS/TextEdit  2010-01-29 18:25:29.780 TextEdit[960:10b] Assertions enabled [â€¦]<span></span></pre></td></tr></tbody></table></div><p>If Terminal doesn't float your boat, you can do the same using the executable inspector in Xcode. In <span class="content_text"><!--a  -->Figure 3<!--/a--></span>, you can see that the "Use â€¦ suffix when loading frameworks" popup has been set to "debug".</p><figure class="figure"><a name="//apple_ref/doc/uid/DTS10003391-CH1-FIGURE3" title="Figure 3Enabling debug libraries in Xcode"></a><figcaption><strong class="caption_number">Figure 3</strong>&nbsp;&nbsp;Enabling debug libraries in Xcode</figcaption><img src="./Technical Note TN2124  Mac OS X Debugging Magic_files/tn2124_XcodeDebugLib32.png" alt="" width="470" height="673"></figure><p>The exact behavior of the debug library varies from framework to framework. Most debug libraries include:</p><ul class="ul"><li class="li"><p>full debug symbols â€” This is particularly useful if the source for the framework is included in <span class="content_text"><a href="http://developer.apple.com/darwin/" class="browserLink">Darwin</a></span>.</p></li><li class="li"><p>extra assertions â€” These can help pinpoint programming errors on your part.</p></li><li class="li"><p>extra debugging facilities â€” A number of the debugging facilities described later in this document are only available in the debug library.</p></li></ul><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_23" title="Note"></a><p><strong>Note:</strong>&nbsp;Unless otherwise stated, the debugging facilities in this technote <strong>do not</strong> require you to use the debug libraries.</p><p></p></aside></div><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECJUSTONELIB" title="Enabling Just One Debug Library"></a><h4 class="jump">Enabling Just One Debug Library</h4><p>In some circumstances you might want to enable just one debug library. For example, let's say you're debugging an Apple event problem, so you want to enabled the "_debug" variant of the AE framework. However, when you set <code>DYLD_IMAGE_SUFFIX</code> to "_debug", you discover that using all the debug libraries causes a problem elsewhere in your application. At this time you just want to focus on debugging the Apple event problem. What do you do?</p><p>Fortunately there's a simple solution to this conundrum: just make a copy of the debug variant with a new unique suffix, and activate that suffix via <code>DYLD_IMAGE_SUFFIX</code>. <span class="content_text"><!--a  -->Listing 33<!--/a--></span> shows an example of this.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE33" title="Listing 33Activating just the AE debug library"></a><p class="codesample clear"><strong class="caption_number">Listing 33</strong>&nbsp;&nbsp;Activating just the AE debug library</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ cd /System/Library/Frameworks/CoreServices.framework/Frameworks/AE.framework/Versions/A/
$ sudo cp AE_debug AE_qtest
$ # Now test this by running TextEdit from GDB.
$ gdb /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-768) [â€¦]
(gdb) set env DYLD_IMAGE_SUFFIX _qtest
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
Reading symbols for shared libraries [â€¦]
^C
Program received signal SIGINT, Interrupt.
0x93cdb8e6 in mach_msg_trap ()
(gdb) # The info shared command reveals that the AE_qtest variant 
(gdb) # was loaded. Neato!
(gdb) info shared
The DYLD shared library state has been initialized from the executable's [â€¦]
                                          Requested State Current State
Num Basename                Type Address         Reason | | Source 
  | |                          | |                    | | | | 
[â€¦]
 43 AE_qtest                   F 0x54000           dyld Y Y /System/Libra[â€¦]
[â€¦]<span></span></pre></td></tr></tbody></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_24" title="Note"></a><p><strong>Note:</strong>&nbsp;Prior to Mac OS X 10.5 the path to the Apple events framework was <code>/System/Library/Frameworks/ApplicationServices.framework/Frameworks/AE.framework/Versions/A</code>.</p><p></p></aside></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-DEBUGLIBVERSION" title="Debug Library Versioning"></a><h4 class="jump">Debug Library Versioning</h4><p>To get meaningful results <strong>you must use the debug libraries that correspond to your production libraries</strong>. If you use the wrong version of the debug libraries, you can run into all sorts of weird problems. For example, if you install the debug libraries on Mac OS X 10.4 and then update your system to Mac OS X 10.4.3, the debug libraries will no longer work. This is because, in Mac OS X 10.4.3, Apple added a new routine to the CoreServices framework, and updated the DesktopServicesPriv framework to use that routine. However, one of these frameworks (CoreServices) has a debug variant and the other (DesktopServicesPriv) does not. Thus, if you enable debug libraries, you get the debug variant of CoreServices from Mac OS X 10.4 and the production variant of DesktopServicesPriv from Mac OS X 10.4.3, and this combination fails to load.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-DEBUGLIBINSTALL" title="Installing Debug Libraries"></a><h4 class="jump">Installing Debug Libraries</h4><p>For Mac OS X 10.5 and later, you can download the debug libraries for any given OS release from the <span class="content_text"><a href="http://connect.apple.com/" class="urlLink" rel="external">ADC member site</a></span>. Look in the Developer Tools section of the Downloads area for a "Debug and Profile Libraries" package that matches your OS version.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_25" title="Important"></a><p><strong>Important:</strong>&nbsp;If you do a software update after installing the debug libraries, your debug and production libraries will be out of sync and you will have problems. You can resolve this by installing the debug libraries associated with that software update.</p><p></p></aside></div><p>Prior to Mac OS X 10.5, the situation is very different. The debug libraries are installed by the Xcode installer, not by the system installer. The debug libraries are not updated when you update your system software. They are, however, updated when you update Xcode. This makes it tricky to keep your debug and production libraries in sync.</p><p>The most reliable way to use debug libraries on systems prior to Mac OS X 10.5 is to set up a dedicated debug partition. On this partition you should first clean install the desired major OS release, and then install the developer tools associated with that release. For example, clean install Mac OS X 10.4, and then install Xcode 2.0. Also remember to disable software updates for that partition, and not update Xcode. This ensures that your production and debug libraries start out in sync, and stay in synch.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECPROFILELIBRARIES" title="Profile Libraries"></a><h4 class="jump">Profile Libraries</h4><p>Many libraries also support a profiling variant which has the suffix "_profile". The profile libraries have many of the same limitations as the debug libraries.</p></section></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECNOWINDOWSERVER" title="Escaping the Window Server"></a><h3 class="jump">Escaping the Window Server</h3><p>Under some circumstances it can be helpful to operate without the window server. For example, if you need to modify the parameters to <code>loginwindow</code> specified in <code>/etc/ttys</code>, it's nice to be able to do it while <code>loginwindow</code> is not running. Mac OS X provides a convenient way to do this:</p><ol class="ol"><li class="li"><p>In the Accounts panel of System Preferences, click on Login Options. If the text is greyed out, you must first unlock the panel by clicking the lock icon.</p></li><li class="li"><p>Change the "Display login window as" setting to "Name and password".</p></li><li class="li"><p>Log out.</p></li><li class="li"><p>At the login window, enter "&gt;console" as your user name and click the Log In button; <code>loginwindow</code> will quit and you'll be faced with a glass TTY interface displaying the "Login" prompt (you may need to press Return to cause the prompt to be displayed).</p></li><li class="li"><p>Log in using your standard user name and password.</p></li></ol><p>When you're done working at this level, just exit from your shell (using the <code>exit</code> command) and you will return to the standard login window.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_26" title="Important"></a><p><strong>Important:</strong>&nbsp;This environment is <strong>not</strong> <span class="content_text"><a href="http://support.apple.com/kb/HT1492" class="urlLink" rel="external">single user mode</a></span>. Most system daemons are still running; only the GUI components of the system are shut down.</p><p></p></aside></div></section><div class="back_to_top"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECDTRACE" title="DTrace"></a><h2 class="jump">DTrace</h2><p>DTrace is a comprehensive dynamic tracing facility introduced with Mac OS X 10.5. DTrace was originally developed by Sun Microsystems (now Oracle) for their Solaris operation system, but has been integrated into Mac OS X by Apple. While a full explanation of DTrace is beyond the scope of this document, this section covers some of the highlights.</p><p>The most important thing to realise is that DTrace is not just for performance debugging. While it was originally designed to support performance debugging, and it is very strong in that area, it can also be used for other types of debugging. For example, sometimes it's useful to know what processes are opening what files, and DTrace can tell you that easily.</p><p>DTrace is also the foundation of many debugging tools on Mac OS X, including:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="x-man-page://1/dtruss" class="urlLink" rel="external">dtruss</a></span> â€” This makes it easy to see what system calls being made by a process.</p></li><li class="li"><p>Instruments â€” Many of the built-in instruments are actually implemented in terms of DTrace.</p></li><li class="li"><p>numerous other tools â€” See <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDTRACETOOLS">DTrace-based Tools</a></span> for a list of tools based on DTrace.</p></li></ul><p>A good place to start with DTrace is the <span class="content_text"><a href="http://www.oracle.com/technetwork/systems/dtrace/dtrace/index.html" class="urlLink" rel="noreferrer">Oracle BigAdmin page for DTrace</a></span>. Alternatively, there are many DTrace scripts built in to Mac OS X (some are described in the <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDTRACETOOLS">next section</a></span>), and you can just look at the source for those scripts. Finally, instruments has a nice UI for building custom Instruments based on a DTrace script.</p><p>Take the time to learn DTrace; it will pay off in the long run!</p><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECDTRACETOOLS" title="DTrace-based Tools"></a><h3 class="jump">DTrace-based Tools</h3><p>The following tables list some of the DTrace-based tools built in to Mac OS X. Keep in mind that, while these scripts might not do exactly what you want, you can copy a script's source and tweak it to better suit your needs.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE9" title="Table 9Process-related DTrace tools"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 9</strong>&nbsp;&nbsp;Process-related DTrace tools</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Tool
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Documentation
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td scope="row"><p>
execsnoop
</p></td><td><p>
manual page
</p></td><td><p>
Traces process execution
</p></td></tr><tr><td scope="row"><p>
newproc.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows new processes as they are created
</p></td></tr><tr><td scope="row"><p>
pidpersec.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows process create count per second
</p></td></tr><tr><td scope="row"><p>
setuids.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows setuid changes as they happen
</p></td></tr></tbody></table></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE10" title="Table 10System call-related DTrace tools"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 10</strong>&nbsp;&nbsp;System call-related DTrace tools</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Tool
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Documentation
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td scope="row"><p>
dtruss
</p></td><td><p>
manual page
</p></td><td><p>
Traces process system calls
</p></td></tr><tr><td scope="row"><p>
errinfo
</p></td><td><p>
manual page
</p></td><td><p>
Traces system call failures
</p></td></tr><tr><td scope="row"><p>
lastwords
</p></td><td><p>
manual page
</p></td><td><p>
Shows the last system calls made by a process
</p></td></tr><tr><td scope="row"><p>
procsystime
</p></td><td><p>
manual page
</p></td><td><p>
Shows system call execution times
</p></td></tr><tr><td scope="row"><p>
syscallbypid.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows system calls by process ID
</p></td></tr><tr><td scope="row"><p>
syscallbyproc.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows system calls by process name
</p></td></tr><tr><td scope="row"><p>
syscallbysysc.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows system call counts
</p></td></tr><tr><td scope="row"><p>
topsyscall
</p></td><td><p>
manual page
</p></td><td><p>
Each second, shows the most common system calls
</p></td></tr><tr><td scope="row"><p>
topsysproc
</p></td><td><p>
manual page
</p></td><td><p>
Each second, shows the processes making the most system calls
</p></td></tr></tbody></table></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE11" title="Table 11Signal-related DTrace tools"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 11</strong>&nbsp;&nbsp;Signal-related DTrace tools</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Tool
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Documentation
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td scope="row"><p>
kill.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows signals as they are sent
</p></td></tr><tr><td scope="row"><p>
sigdist.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows signals by process
</p></td></tr></tbody></table></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE12" title="Table 12File I/O-related DTrace tools"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 12</strong>&nbsp;&nbsp;File I/O-related DTrace tools</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Tool
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Documentation
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td scope="row"><p>
creatbyproc.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows files created with creat
</p></td></tr><tr><td scope="row"><p>
fddist
</p></td><td><p>
manual page
</p></td><td><p>
Shows file descriptor usage distribution
</p></td></tr><tr><td scope="row"><p>
filebyproc.d
</p></td><td><p>
manual page
</p></td><td><p>
Traces files opened by a process
</p></td></tr><tr><td scope="row"><p>
opensnoop
</p></td><td><p>
manual page
</p></td><td><p>
Shows files being opened
</p></td></tr><tr><td scope="row"><p>
pathopens.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows open counts by path
</p></td></tr><tr><td scope="row"><p>
rwbypid.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows read and write calls by process
</p></td></tr><tr><td scope="row"><p>
rwbytype.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows read and write calls by vnode type
</p></td></tr><tr><td scope="row"><p>
rwsnoop
</p></td><td><p>
manual page
</p></td><td><p>
Shows read and write calls as they happen
</p></td></tr></tbody></table></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE13" title="Table 13Network I/O-related DTrace tools"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 13</strong>&nbsp;&nbsp;Network I/O-related DTrace tools</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Tool
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Documentation
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td scope="row"><p>
httpdstat.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows Apache connection statistics
</p></td></tr><tr><td scope="row"><p>
weblatency.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows HTTP request latency statistics
</p></td></tr></tbody></table></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE14" title="Table 14Disk I/O-related DTrace tools"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 14</strong>&nbsp;&nbsp;Disk I/O-related DTrace tools</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Tool
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Documentation
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td scope="row"><p>
bitesize.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows disk I/O size by process
</p></td></tr><tr><td scope="row"><p>
diskhits
</p></td><td><p>
manual page
</p></td><td><p>
Shows file access by offset
</p></td></tr><tr><td scope="row"><p>
hotspot.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows disk usage by location
</p></td></tr><tr><td scope="row"><p>
iofile.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows I/O wait times by file
</p></td></tr><tr><td scope="row"><p>
iofileb.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows transfer sizes by file
</p></td></tr><tr><td scope="row"><p>
iopattern
</p></td><td><p>
manual page
</p></td><td><p>
Shows disk access patterns
</p></td></tr><tr><td scope="row"><p>
iopending
</p></td><td><p>
manual page
</p></td><td><p>
Shows number of pending disk transfers
</p></td></tr><tr><td scope="row"><p>
iosnoop
</p></td><td><p>
manual page
</p></td><td><p>
Shows disk accesses as they happen
</p></td></tr><tr><td scope="row"><p>
iotop
</p></td><td><p>
manual page
</p></td><td><p>
Shows disk I/O per process
</p></td></tr><tr><td scope="row"><p>
seeksize.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows disk seeks by process
</p></td></tr></tbody></table></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE15" title="Table 15Scheduler-related DTrace tools"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 15</strong>&nbsp;&nbsp;Scheduler-related DTrace tools</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Tool
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Documentation
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td scope="row"><p>
cpuwalk.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows which CPUs a process runs on
</p></td></tr><tr><td scope="row"><p>
dappprof
</p></td><td><p>
manual page
</p></td><td><p>
Profiles user space code
</p></td></tr><tr><td scope="row"><p>
dapptrace
</p></td><td><p>
manual page
</p></td><td><p>
Traces user space code
</p></td></tr><tr><td scope="row"><p>
dispqlen.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows scheduler dispatch queue lengths
</p></td></tr><tr><td scope="row"><p>
loads.d
</p></td><td><p>
manual page
</p></td><td><p>
Show load averages
</p></td></tr><tr><td scope="row"><p>
priclass.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows process class distribution
</p></td></tr><tr><td scope="row"><p>
pridist.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows process priority distribution
</p></td></tr><tr><td scope="row"><p>
runocc.d
</p></td><td><p>
manual page
</p></td><td><p>
Shows scheduler run queue occupancy by CPU
</p></td></tr><tr><td scope="row"><p>
sampleproc
</p></td><td><p>
manual page
</p></td><td><p>
Profiles which process is on which CPU
</p></td></tr></tbody></table></div></section><div class="back_to_top"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECDAEMONS" title="Daemons"></a><h2 class="jump">Daemons</h2><p>Most system daemons include some sort of debugging facility. In many cases a daemon's debugging features are described in its man page. This section describes some of the particularly interesting ones.</p><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECLAUNCHD" title="launchd"></a><h3 class="jump">launchd</h3><p><span class="content_text"><a href="x-man-page://8/launchd" class="urlLink" rel="external">launchd</a></span> is the first process run by the kernel (Mac OS X 10.4 and later); it is responsible for launching all other processes on the system. <code>launchd</code> has a number of useful debugging facilities, each described in a subsequent section.</p><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECLAUNCHCTL" title="launchctl"></a><h4 class="jump">launchctl</h4><p>You can interact with <code>launchd</code> using the <span class="content_text"><a href="x-man-page://1/launchctl" class="urlLink" rel="external">launchctl</a></span> command. <code>launchctl</code> supports a number of sub-commands; <span class="content_text"><!--a  -->Table 16<!--/a--></span> lists the ones that are most relevant to debugging.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE16" title="Table 16Useful launchctl commands"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 16</strong>&nbsp;&nbsp;Useful launchctl commands</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Command
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td scope="row"><p>
list
</p></td><td><p>
Displays a list of loaded jobs, or detailed information about a specific job
</p></td></tr><tr><td scope="row"><p>
limit
</p></td><td><p>
Sets the resource limits of launchd; this value will be inherited by any process launchd executes; the most common usage is limit core unlimited, which enables core dumps
</p></td></tr><tr><td scope="row"><p>
setenv
</p></td><td><p>
Modifies the environment variables passed to any launched programs
</p></td></tr><tr><td scope="row"><p>
debug
</p></td><td><p>
Lets you control the WaitForDebugger property of a loaded job (Mac OS X 10.6 and later)
</p></td></tr><tr><td scope="row"><p>
bstree
</p></td><td><p>
Displays a tree of the Mach bootstrap namespaces being managed by launchd (Mac OS X 10.6 and later)
</p></td></tr></tbody></table></div><p>For commands that change the <code>launchd</code> state (like <code>limit</code> or <code>setenv</code>), you can make a temporary change by running <code>launchctl</code> with one of these commands as an argument. This will affect <code>launchd</code> itself, and any process that <code>launchd</code> executes from then on.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_27" title="Important"></a><p><strong>Important:</strong>&nbsp;To affect the state of the global instance of <code>launchd</code>, you must run <code>launchctl</code> as root (typically using <code>sudo</code>). If you run <code>launchctl</code> without using <code>sudo</code>, the change affects your per-user instance of <code>launchd</code>.</p><p></p></aside></div><p>You can make a persistent change to the global instance of <code>launchd</code> by adding the command to <span class="content_text"><a href="x-man-page://5/launchd.conf" class="urlLink" rel="external">/etc/launchd.conf</a></span>. <code>launchd</code> adopts these settings early in the boot process, and so, upon restart, they affect every process on the system.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECLAUNCHDJOBS" title="Debugging a Particular Job"></a><h4 class="jump">Debugging a Particular Job</h4><p>Finally, <code>launchd</code> lets you debug a specific job by modifying properties in its <span class="content_text"><a href="x-man-page://5/launchd.plist" class="urlLink" rel="external">property list file</a></span>. <span class="content_text"><!--a  -->Table 17<!--/a--></span> lists the properties that are most useful for debugging.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE17" title="Table 17Properties useful for debugging"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 17</strong>&nbsp;&nbsp;Properties useful for debugging</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Property
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td scope="row"><p>
StandardOutPath
</p></td><td><p>
Sets the job's stdout destination
</p></td></tr><tr><td scope="row"><p>
StandardErrorPath
</p></td><td><p>
Sets the job's stderr destination
</p></td></tr><tr><td scope="row"><p>
EnvironmentVariables
</p></td><td><p>
Sets environment variables for the job
</p></td></tr><tr><td scope="row"><p>
SoftResourceLimits, HardResourceLimits
</p></td><td><p>
Sets resource limits for the job; most useful to enable core dumps for just one job
</p></td></tr><tr><td scope="row"><p>
WaitForDebugger
</p></td><td><p>
If this is true, the job's process will wait for the debugger to attach before running any code (Mac OS X 10.5 and later)
</p></td></tr></tbody></table></div></section></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECDIRECTORYSERVICE" title="Directory Services"></a><h3 class="jump">Directory Services</h3><p>The <code>DirectoryService</code> daemon is the central repository of directory information on Mac OS X (things like the list of users and groups). The <span class="content_text"><a href="x-man-page://8/DirectoryService" class="urlLink" rel="external">man page</a></span> describes how you can use the <code>SIGUSR1</code> and <code>SIGUSR2</code> signals to enable two different flavours of logging. If you need to enable logging early in the boot process, you can create the <code>/Library/Preferences/DirectoryService/.DSLogAtStart</code> file before you restart. Finally, starting with Mac OS X 10.5, you can change the amount of debug logging using the <code>Debug Logging Priority Level</code> preference, as described in <span class="content_text"><a href="http://support.apple.com/kb/HT3186" class="urlLink" rel="external">Mac OS X Server v10.5, 10.6: Enabling Directory Service debug logging</a></span>.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECMDNSRESPONDER" title="mDNSResponder"></a><h3 class="jump">mDNSResponder</h3><p>The <code>mDNSResponder</code> daemon is responsible for multicast DNS services on all versions of Mac OS X and, starting with Mac OS X 10.5, it also handles unicast DNS as well. The daemon maintains a lot of internal state, including a DNS resolver cache. If you send it a <code>SIGINFO</code> signal, it will dump that state to the system log.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECNOTIFYD" title="notifyd"></a><h3 class="jump">notifyd</h3><p>If you send a <code>SIGUSR1</code> signal to <span class="content_text"><a href="x-man-page://8/notifyd" class="urlLink" rel="external">notifyd</a></span>, it will dump its state to <code>/var/run/notifyd_XXX.status</code>, where XXX is its process ID. You can also send a <code>SIGUSR2</code> signal to get a longer status report.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECLOOKUPD" title="lookupd"></a><h3 class="jump">lookupd</h3><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_28" title="Important"></a><p><strong>Important:</strong>&nbsp;Mac OS X 10.5 and later do not include <code>lookupd</code>. Its core functionality has been moved to the <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDIRECTORYSERVICE">Directory Service daemon</a></span>. The text in this section only applies to pre-Mac OS X 10.5 systems.</p><p></p></aside></div><p>If you're experiencing problems with <code>lookupd</code> (for example, DNS requests are taking a long time), you can enable <code>lookupd</code> debugging with the following steps:</p><ol class="ol"><li class="li"><p>Create the <code>Debug</code> and <code>Trace</code> properties in the local machine's <code>/config/lookupd</code> NetInfo directory.</p></li><li class="li"><p>Change the <span class="content_text"><a href="x-man-page://5/syslog.conf" class="urlLink" rel="external">syslog configuration</a></span> so that NetInfo debugging information (<code>netinfo.debug</code>) is sent to the NetInfo log file (<code>/var/log/netinfo.log</code>).</p></li><li class="li"><p>Send a <code>SIGHUP</code> signal to <code>syslogd</code> to get it to recognize the previous change.</p></li><li class="li"><p>Send a <code>SIGHUP</code> signal to <code>lookupd</code> to get it to recognize the change from step 1.</p></li></ol><p><span class="content_text"><!--a  -->Listing 34<!--/a--></span> shows an example of this. Once you've done these steps, you can look in <code>/var/log/netinfo.log</code> for the debugging output. You can also execute <code>lookupd -statistics</code> get statistics from <code>lookupd</code>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE34" title="Listing 34Enabling lookupd debugging"></a><p class="codesample clear"><strong class="caption_number">Listing 34</strong>&nbsp;&nbsp;Enabling lookupd debugging</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ sudo dscl . create /dsRecTypeStandard:Config/lookupd Debug YES
$ sudo dscl . create /dsRecTypeStandard:Config/lookupd Trace YES
$ sudo cp /etc/syslog.conf /etc/syslog.conf-orig
$ sed 's/netinfo.err/netinfo.debug/' /etc/syslog.conf-orig | \
sudo cp /dev/stdin /etc/syslog.conf
$ sudo kill -HUP `cat /var/run/syslog.pid`
$ sudo kill -HUP `cat /var/run/lookupd.pid`<span></span></pre></td></tr></tbody></table></div><p><span class="content_text"><!--a  -->Listing 35<!--/a--></span> shows how to undo these changes.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE35" title="Listing 35Disabling lookupd debugging"></a><p class="codesample clear"><strong class="caption_number">Listing 35</strong>&nbsp;&nbsp;Disabling lookupd debugging</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ sudo dscl . delete /dsRecTypeStandard:Config/lookupd $ sudo mv /etc/syslog.conf-orig /etc/syslog.conf $ sudo kill -HUP `cat /var/run/syslog.pid` $ sudo kill -HUP `cat /var/run/lookupd.pid`<span></span></pre></td></tr></tbody></table></div><p>For more information about <code>lookupd</code>, see its <span class="content_text"><a href="x-man-page://8/lookupd" class="urlLink" rel="external">man page</a></span>.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECPRINTING" title="Printing (CUPS)"></a><h3 class="jump">Printing (CUPS)</h3><p>Mac OS X uses <span class="content_text"><a href="http://cups.org/" class="urlLink" rel="noreferrer">CUPS</a></span> as its core printing architecture (starting with Mac OS X 10.2). CUPS has a built-in debug logging feature, controlled by the CUPS configuration file (<code>/etc/cups/cupsd.conf</code>). Within this file the <code>LogLevel</code> directive controls the level of logging, while the <code>ErrorLog</code> directive controls the log destination (the default is <code>/var/log/cups/error_log</code>). For more information about this file, see the <span class="content_text"><a href="x-man-page://5/cupsd.conf" class="urlLink" rel="external">man page</a></span>.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_29" title="Important"></a><p><strong>Important:</strong>&nbsp;If you change these preferences you must signal the CUPS daemon to get it to recognise the changes. Prior to Mac OS X 10.5, you could do this by sending a <code>SIGHUP</code> signal to the daemon. In Mac OS X 10.5 and later you can just ask <code>launchd</code> to stop the daemon (it will then relaunch on demand). <span class="content_text"><!--a  -->Listing 36<!--/a--></span> shows both techniques.</p><p></p></aside></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE36" title="Listing 36Restarting the CUPS daemon"></a><p class="codesample clear"><strong class="caption_number">Listing 36</strong>&nbsp;&nbsp;Restarting the CUPS daemon</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ # Prior to Mac OS X 10.5, use this command:
$
$ sudo /System/Library/StartupItems/PrintingServices/PrintingServices \
restart
$
$ # In Mac OS X 10.5 and later, use this command:
$
$ sudo launchctl stop org.cups.cupsd<span></span></pre></td></tr></tbody></table></div><p>Starting with Mac OS X 10.5, you can use the <span class="content_text"><a href="x-man-page://8/cupsctl" class="urlLink" rel="external">cupsctl</a></span> tool to control debug logging, as shown in <span class="content_text"><!--a  -->Listing 37<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE37" title="Listing 37Enabling and disabling CUPS debug logging"></a><p class="codesample clear"><strong class="caption_number">Listing 37</strong>&nbsp;&nbsp;Enabling and disabling CUPS debug logging</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ # Enable CUPS debug logging. $ cupsctl --debug-logging $ # Disable CUPS debug logging. $ cupsctl --no-debug-logging<span></span></pre></td></tr></tbody></table></div><p>You can get general CUPS help from the built-in <span class="content_text"><a href="http://localhost:631/help" class="urlLink" rel="noreferrer">Online Help</a></span>. Also, the <span class="content_text"><a href="http://localhost:631/help/api-filter.html" class="urlLink" rel="noreferrer">Filter and Backend Programming</a></span> document has a bunch of useful debugging information.</p><p>If you're writing a CUPS driver or filter, you can add entries to this log by printing them to <code>stderr</code>. You must start each line with the logging level of the message, as illustrated by <span class="content_text"><!--a  -->Listing 38<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE38" title="Listing 38Logging to CUPS"></a><p class="codesample clear"><strong class="caption_number">Listing 38</strong>&nbsp;&nbsp;Logging to CUPS</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>// Debug message

fprintf(stderr, "DEBUG: page_width = %.0f\n", page_width); 

// Warning message

fprintf(stderr, "WARNING: Printer not responding\n"); 

// Error message

fprintf(stderr, "ERROR: Lost connection with printer\n");<span></span></pre></td></tr></tbody></table></div></section><div class="back_to_top"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCORESERVICES" title="Core Services"></a><h2 class="jump">Core Services</h2><p>Core Services includes a number of routines (for example, <code>Debugger</code>, <code>DebugStr</code>, and <code>SysBreak</code>) that enter the debugger with a message. If you set the <code>USERBREAK</code> environment variable to 1, these routines will send a <code>SIGINT</code> signal to the current process, which causes you to break into GDB. Xcode has GUI to enabled this facility (the "Break on Debugger() and DebugStr()" checkbox in the Debugging panel of the executable inspector, as shown in <span class="content_text"><!--a  -->Figure 4<!--/a--></span>).</p><figure class="figure"><a name="//apple_ref/doc/uid/DTS10003391-CH1-FIGURE4" title="Figure 4Setting USERBREAK in Xcode"></a><figcaption><strong class="caption_number">Figure 4</strong>&nbsp;&nbsp;Setting USERBREAK in Xcode</figcaption><img src="./Technical Note TN2124  Mac OS X Debugging Magic_files/tn2124_XcodeDebugStr3.png" alt="" width="470" height="673"></figure><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCF" title="Core Foundation"></a><h3 class="jump">Core Foundation</h3><p>The Core Foundation (CF) framework exports the <code>CFShow</code> routine, which prints a description of any CF object to <code>stderr</code>. You can make this call from your own code, however, it's particularly useful when <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCALLFUNC">called from GDB</a></span>. <span class="content_text"><!--a  -->Listing 39<!--/a--></span> shows an example of this.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE39" title="Listing 39Calling CFShow from GDB"></a><p class="codesample clear"><strong class="caption_number">Listing 39</strong>&nbsp;&nbsp;Calling CFShow from GDB</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ gdb /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) [â€¦]
(gdb) fb CFRunLoopAddSource
Breakpoint 1 at 0x624dd2f195cfa8
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
Reading symbols for shared libraries [â€¦]
Breakpoint 1, 0x00007fff8609bfa8 in CFRunLoopAddSource ()
(gdb) # Check that the prologue hasn't changed $rdi.
(gdb) p/a 0x00007fff8609bfa8
$1 = 0x7fff8609bfa8 &lt;CFRunLoopAddSource+24&gt;
(gdb) p/a $pc
$2 = 0x7fff8609bfa8 &lt;CFRunLoopAddSource+24&gt;
(gdb) x/8i $pc-24
0x7fff8609bf90 &lt;CFRunLoopAddSource&gt;: push   %rbp
0x7fff8609bf91 &lt;CFRunLoopAddSource+1&gt;: mov    %rsp,%rbp
0x7fff8609bf94 &lt;CFRunLoopAddSource+4&gt;: mov    %rbx,-0x20(%rbp)
0x7fff8609bf98 &lt;CFRunLoopAddSource+8&gt;: mov    %r12,-0x18(%rbp)
0x7fff8609bf9c &lt;CFRunLoopAddSource+12&gt;: mov    %r13,-0x10(%rbp)
0x7fff8609bfa0 &lt;CFRunLoopAddSource+16&gt;: mov    %r14,-0x8(%rbp)
0x7fff8609bfa4 &lt;CFRunLoopAddSource+20&gt;: sub    $0x40,%rsp
0x7fff8609bfa8 &lt;CFRunLoopAddSource+24&gt;: mov    %rdi,%r12
(gdb) # Nope. Go ahead and CFShow it.
(gdb) call (void)CFShow($rdi)
&lt;CFRunLoop 0x100115540 [0x7fff70b8bf20]&gt;{
    locked = false, 
    wakeup port = 0x1e07, 
    stopped = false,
    current mode = (none),
    common modes = &lt;CFBasicHash 0x1001155a0 [0x7fff70b8bf20]&gt;{
        type = mutable set, 
        count = 1,
        entries =&gt;
            2 : &lt;CFString 0x7fff70b693d0 [0x7fff70b8bf20]&gt;{
                contents = "kCFRunLoopDefaultMode"
            }
    },
    common mode items = (null),
    modes = &lt;CFBasicHash 0x1001155d0 [0x7fff70b8bf20]&gt;{
        type = mutable set, 
        count = 1,
        entries =&gt;
            0 : &lt;CFRunLoopMode 0x100115670 [0x7fff70b8bf20]&gt;{
                name = kCFRunLoopDefaultMode, 
                locked = false, 
                port set = 0x1f03,
                sources = (null),
                observers = (null),
                timers = (null)
        },
    }
}<span></span></pre></td></tr></tbody></table></div><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_30" title="Important"></a><p><strong>Important:</strong>&nbsp;If you don't see any output from <code>CFShow</code>, it was probably sent to the console. See <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECSEEINGOUTPUT">Seeing Debug Output</a></span> for information on how to view this output.</p><p></p></aside></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_31" title="Note"></a><p><strong>Note:</strong>&nbsp;In <span class="content_text"><!--a  -->Listing 39<!--/a--></span> the output from <code>CFShow</code> has been reformatted to make it easier to read.</p><p></p></aside></div><p>There are a number of other CF routines that you might find useful to call from GDB, including <code>CFGetRetainCount</code>, <code>CFBundleGetMainBundle</code>, and <code>CFRunLoopGetCurrent</code>.</p><p>The Core Foundation framework also has a debug variant that offers extensive debugging assistance. For example, the non-debug variant of Core Foundation does not check the validity of parameters that you pass to its routines, whereas the debug variant includes full parameter checking. This can help you track down numerous Core Foundation-related bugs in your code.</p><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCFZOMBIES" title="Zombies!"></a><h4 class="jump">Zombies!</h4><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_32" title="Important"></a><p><strong>Important:</strong>&nbsp;If you're programming in Objective-C, you're more likely to be interested in <code>NSZombieEnabled</code>, as described in <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECZOMBIES">More Zombies!</a></span>.</p><p></p></aside></div><p>Core Foundation supports an environment variable called <code>CFZombieLevel</code>. It interprets this variable as an integer containing a set of flag bits. <span class="content_text"><!--a  -->Table 18<!--/a--></span> describes the bits that are currently defined. These can help you track down various CF memory management issues.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE18" title="Table 18Bit definitions for CFZombieLevel environment variable"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 18</strong>&nbsp;&nbsp;Bit definitions for CFZombieLevel environment variable</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Bit
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Action
</p></th></tr><tr><td scope="row"><p>
0
</p></td><td><p>
scribble deallocated CF memory
</p></td></tr><tr><td scope="row"><p>
1
</p></td><td><p>
when scribbling deallocated CF memory, don't scribble object header (CFRuntimeBase)
</p></td></tr><tr><td scope="row"><p>
4
</p></td><td><p>
never free memory used to hold CF objects
</p></td></tr><tr><td scope="row"><p>
7
</p></td><td><p>
if set, scribble deallocations using bits 8..15, otherwise use 0xFC
</p></td></tr><tr><td scope="row"><p>
8..15
</p></td><td><p>
if bit 7 is set, scribble deallocations using this value
</p></td></tr><tr><td scope="row"><p>
16
</p></td><td><p>
scribble allocated CF memory
</p></td></tr><tr><td scope="row"><p>
23
</p></td><td><p>
if set, scribble allocations using bits 24..31, otherwise use 0xCF
</p></td></tr><tr><td scope="row"><p>
24..31
</p></td><td><p>
if bit 23 is set, scribble allocations using this value
</p></td></tr></tbody></table></div><div class="warningbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_33" title="Warning"></a><p><strong>Warning:</strong>&nbsp;Prior to Mac OS X 10.5, <code>CFZombieLevel</code> was not compatible with custom allocators (created using <code>CFAllocatorCreate</code>) 
			(r. <span class="content_text"><a href="rdar://problem/4158401" class="urlLink" rel="external">4158401</a></span>)
		 or extensive use of the Security framework 
			(r. <span class="content_text"><a href="rdar://problem/4594016" class="urlLink" rel="external">4594016</a></span>)
		.</p><p></p><div class="clear"></div></aside></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_34" title="Note"></a><p><strong>Note:</strong>&nbsp;Prior to Mac OS X 10.4 <code>CFZombieLevel</code> required the debug variant of the Core Foundation framework.</p><p></p></aside></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCFNOTIFICATION" title="CFNotificationCenter"></a><h4 class="jump">CFNotificationCenter</h4><p>You can enable CFNotificationCenter logging by creating the file <code>/var/log/do_dnserver_log</code>. If this file exists and is owned by root, the CFNotificationCenter daemon (<span class="content_text"><a href="x-man-page://8/distnoted" class="urlLink" rel="external">distnoted</a></span>) will log its activity to the system log. See <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECFILES">Files</a></span> for an example of how to create this file.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_35" title="Important"></a><p><strong>Important:</strong>&nbsp;You must restart for this setting to take effect.</p><p></p></aside></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_36" title="Note"></a><p><strong>Note:</strong>&nbsp;Prior to Mac OS X 10.6 CFNotificationCenter would log to its own file, <code>/var/log/dnserver.log</code> and, depending on your system version, you had to jump through various different hoops to enable logging.</p><p></p></aside></div><p>In Mac OS X 10.5.x, the CFNotificationCenter daemon process (<code>distnoted</code>) runs as the user <code>daemon</code>, which means that the file <code>/var/log/dnserver.log</code> must be writable by that user. <span class="content_text"><!--a  -->Listing 40<!--/a--></span> shows how to create this file.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE40" title="Listing 40Creating the CFNotificationCenter log file for Mac OS X 10.5"></a><p class="codesample clear"><strong class="caption_number">Listing 40</strong>&nbsp;&nbsp;Creating the CFNotificationCenter log file for Mac OS X 10.5</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ sudo touch /var/log/dnserver.log $ sudo chown daemon:daemon /var/log/dnserver.log<span></span></pre></td></tr></tbody></table></div><p>Prior to Mac OS X 10.5 <code>distnoted</code> ran as root, so the ownership and permissions of the <code>/var/log/dnserver.log</code> file were irrelevant.</p><p>On Mac OS X 10.3.x, the corresponding files were <code>/var/tmp/do_dnserver_log</code> and <code>/var/tmp/dnserver.log</code>.</p><p>Also, Mac OS X 10.3.x supported client-side logging. If you create the file <code>/var/tmp/do_xnc_log</code>, CFNotificationCenter will log each client's activity in its own file (<code>/var/tmp/xnc_logs/&lt;progname&gt;</code>). This setting takes effect when you relaunch the program. Client-side logging is not available in Mac OS X 10.4 and later.</p></section></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECAE" title="Apple Events"></a><h3 class="jump">Apple Events</h3><p>The Apple Event Manager has extensive built-in debugging support. The best way to learn about this support is use GDB to call the <code>GDBPrintHelpDebuggingAppleEvents</code> routine, as shown in <span class="content_text"><!--a  -->Listing 41<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE41" title="Listing 41Apple Event Manager debugging help"></a><p class="codesample clear"><strong class="caption_number">Listing 41</strong>&nbsp;&nbsp;Apple Event Manager debugging help</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) call (void)GDBPrintHelpDebuggingAppleEvents()
The AppleEvent Manager has been completely rewritten for this
version of Mac OS X. The internal structure of an AEDesc is
now a pointer to a sparse tree. If you're having problems
it could be because you're accessing the dataHandle of an
AEDesc directly.

Also of note is that AEGetDescData and AEGetDescDataSize only
work with value descriptors created by AECreateDesc - you cannot
get the data size of an AERecord or AEList, for example.

To print the contents of an AppleEvent from GDB, you can:
  (gdb) call (void) GDBPrintAEDesc(descPtr)

To view all currently installed AppleEvent coercion handlers:
  (gdb) call (void) GDBPrintAECoercionTables()

To view all contents install AppleEvent handlers:
  (gdb) call (void) GDBPrintAEHandlerTables()

Additionally, to log information about AppleEvent manager calls,
you can set environment variables that will produce debugging output
to the console:

  % setenv AEDebugSends    1            # print sent events
  % setenv AEDebugReceives 1            # print received events and replies<span></span></pre></td></tr></tbody></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_37" title="Note"></a><p><strong>Note:</strong>&nbsp;In the above text, "this version of Mac OS X" refers to Mac OS X 10.2.</p><p></p></aside></div><p>Some environment variablesâ€”specifically <code>AEDebug</code>, <code>AEDebugVerbose</code>, <code>AEDebugOSL</code>, <code>AEDebugFlattenedEvents</code>, and <code>AEDebugFile</code>â€”are only supported by the debug library.</p><p>If you are using the debug library, you can also control Apple event debugging by creating three files in <code>/var/tmp</code>:</p><ul class="ul"><li class="li"><p>Creating the file <code>/var/tmp/AEDebugFull</code> is equivalent to setting the <code>AEDebug</code>, <code>AEDebugSends</code>, <code>AEDebugReceives</code>, <code>AEDebugVerbose</code>, <code>AEDebugOSL</code>, and <code>AEDebugFlattenedEvents</code> environment variables.</p></li><li class="li"><p>Creating the file <code>/var/tmp/AEDebug.out</code> is equivalent to setting <code>AEDebugFile</code> to "/var/tmp/AEDebug.out".</p></li><li class="li"><p>Creating the file <code>/var/tmp/AEDebugLogs</code> causes Apple Event Manager to send all of its output to a file named <code>/var/tmp/AELog-&lt;progname&gt;</code>.</p></li></ul><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_38" title="Important"></a><p><strong>Important:</strong>&nbsp;The last two items only affect the destination of the debugging output. In order to produce debugging output, you have to enable it using one of the environment variables listed above, or by creating <code>/var/tmp/AEDebugFull</code>.</p><p></p></aside></div><p>If you set the <code>AE_PRINT_XML</code> environment variable to 1 (10.4 and later), <code>GDBPrintAEDesc</code> will print the descriptor as XML (if possible).</p><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECEPPC" title="Remote Apple Events"></a><h4 class="jump">Remote Apple Events</h4><p>If you're having problems with remote Apple events, you may find it useful to enable logging for the Apple event server process. To do this, edit <code>/System/Library/LaunchDaemons/com.apple.eppc.plist</code> and add a "--debug" entry to the <code>ProgramArguments</code> array. The end result should be a file like the one shown in <span class="content_text"><!--a  -->Listing 42<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE42" title="Listing 42Enabling remote Apple event debugging"></a><p class="codesample clear"><strong class="caption_number">Listing 42</strong>&nbsp;&nbsp;Enabling remote Apple event debugging</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
        &lt;key&gt;Label&lt;/key&gt;
        &lt;string&gt;com.apple.AEServer&lt;/string&gt;
        &lt;key&gt;ProgramArguments&lt;/key&gt;
        &lt;array&gt;
                &lt;string&gt;/System/Library/Frameworks/CoreServices.framework/Frameworks/AE.framework/Versions/A/Support/AEServer&lt;/string&gt;
                &lt;string&gt;--debug&lt;/string&gt;
        &lt;/array&gt;
        [â€¦]
&lt;/dict&gt;
&lt;/plist&gt;<span></span></pre></td></tr></tbody></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_39" title="Note"></a><p><strong>Note:</strong>&nbsp;Prior to Mac OS X 10.6 this file was <code>/System/Library/LaunchDaemons/eppc.plist</code>.</p><p></p></aside></div><p>You must stop and start the Remote Apple Events service for this change to take effect; you can do this in the Sharing panel of System Preferences. The logging information will appear in the <span class="content_text"><!--a  -->system log<!--/a--></span>.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_40" title="Important"></a><p><strong>Important:</strong>&nbsp;Because <code>AEServer</code> is launched on demand by <span class="content_text"><a href="x-man-page://8/launchd" class="urlLink" rel="external">launchd</a></span>, you won't see any log entries until you actually send an Apple event to the machine. If you still don't see any log entries, restart the server machine and try again.</p><p></p></aside></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_41" title="Note"></a><p><strong>Note:</strong>&nbsp;Prior to Mac OS X 10.4 the Apple event server was run by <span class="content_text"><a href="x-man-page://8/xinetd" class="urlLink" rel="external">xinetd</a></span>. The configuration file was <code>/etc/xinetd.d/eppc</code>. To enable debugging, uncomment the "server_args" line, and change the parameter value to "--debug".</p><p></p></aside></div></section></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCFM" title="Code Fragment Manager (CFM)"></a><h3 class="jump">Code Fragment Manager (CFM)</h3><p>The CFM compatibility environment on Mac OS X supports two helpful environment variables, <code>CFMDebugBasic</code> and <code>CFMDebugFull</code>, which you can set to 1 to get limited and verbose debug logging, respectively. This facility is particularly useful for tracking down CFM closure problems, and problems where fragment initialization routines fail.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCOMPONENT" title="Component Manager"></a><h3 class="jump">Component Manager</h3><p>Component Manager exports a routine, <code>GDBComponentList</code>, that you can call from GDB to print the database of registered components and their instances. <span class="content_text"><!--a  -->Listing 43<!--/a--></span> gives an example of its use.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE43" title="Listing 43Print a list of components and instances"></a><p class="codesample clear"><strong class="caption_number">Listing 43</strong>&nbsp;&nbsp;Print a list of components and instances</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) call (void)GDBComponentList()
Cnt   tRef# (address) Type/SubT/Manu    Flags           EntryPnt File â€¦
[â€¦]
  1 0x10011 0x00000001008870a0 osa /ascr/appl 100001fe 0x00000001004efeb6    0 â€¦
    Inst:0x810001; Err=0; Storage:0x85f9f0
  1 0x10013 0x00000001008871e0 osa /scpt/appl 100001fe 0x00000001004efea2    0 â€¦
    Inst:0x810000; Err=0; Storage:0x2384c0
[â€¦]
There are 1 component manager files:
    0: refs 2, path [/System/Library/Components/AppleScript.component], where kâ€¦<span></span></pre></td></tr></tbody></table></div><p>In addition, if you set the <code>ComponentDebug</code> environment variable to 1, Component Manager will print of variety of debug messages. These may be helpful if something is going wrong with your component, in particular if it fails to load.</p><p>Finally, if a component fails to load, you can use dynamic linker facilities to debug the problem; see <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDYLD">Dynamic Linker (dyld)</a></span> for the details.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCSFM" title="File Manager"></a><h3 class="jump">File Manager</h3><p>Core Services File Manager (commonly known as the Carbon File Manager, or just File Manager) is nicely integrated with the <code>fs_usage</code> command line tool. If you enable the Core Services debug library, <code>fs_usage</code> will not only show primitive BSD file system calls but also the File Manager calls that prompted them. See the fs_usage <span class="content_text"><a href="x-man-page://1/fs_usage" class="urlLink" rel="external">man page</a></span> for more details.</p><p>Prior to Mac OS X 10.5, if you set the <code>FilesASDDebug</code> environment variable to 1, File Manager will log its dealings with AppleDouble files on file systems that do not have native support for resource forks and Macintosh metadata. In Mac OS X 10.5 and later this feature is no longer supported because AppleDouble support has moved into kernel.</p><p>Prior to Mac OS X 10.6, and when using the debug variant of the CarbonCore framework, if you set the <code>VNDebug</code> environment variable to 1, File Manager will log its interaction with <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDISKARB">Disk Arbitration</a></span>.</p><p>File Manager has a number of useful GDB-callable routines. The most useful, <code>PrintVolumeInfo</code>, prints the volume list. It takes one Boolean parameter that is ignored by modern systems. <span class="content_text"><!--a  -->Listing 44<!--/a--></span> shows an example this.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE44" title="Listing 44PrintVolumeInfo in action"></a><p class="codesample clear"><strong class="caption_number">Listing 44</strong>&nbsp;&nbsp;PrintVolumeInfo in action</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) call (void)PrintVolumeInfo(1) 2010-02-01 17:48:00.657 Finder[620:a0f] 1:vol=-100  "Macintosh HD" 2010-02-01 17:48:00.658 Finder[620:a0f] 2:returned error -35<span></span></pre></td></tr></tbody></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_42" title="Note"></a><p><strong>Note:</strong>&nbsp;Prior to Mac OS X 10.6 the parameter to <code>PrintVolumeInfo</code> was not ignored. Rather, it specified whether to use the File Manager API to enumerate the volumes (1) or to walk an internal data structure (0). The former yielded a nice summary while the latter yielded more detailed information.</p><p></p></aside></div><p>There are a number of other GDB-callable routines that are primarily of interest to folks developing VFS plug-ins on Mac OS X. They allow you to print the directory enumeration cache and the file ID tree, both of which are compatibility structures maintained by the File Manager for non-volfs volumes (see <span class="content_text"><a href="https://developer.apple.com/qa/qa2001/qa1113.html" class="urlLink" rel="external">Technical Q&amp;A QA1113, 'The "/.vol" directory and "volfs"'</a></span> for information about volfs).</p><p>The <code>PrintEnumerationCache</code> routine prints the directory enumeration cache on the volume. It takes a single parameter, which is the volume reference number (<code>vRefNum</code>) of the volume of interest.</p><p>The file ID tree is maintained centrally by <code>coreservicesd</code>. There are two different ways to look at this tree:</p><ul class="ul"><li class="li"><p>The <code>FileIDTreePrintVolumeTree</code> routine prints the file ID tree hierarchy. It takes a single parameter that specifies the volume reference number.</p></li><li class="li"><p>The <code>FileIDTreeStorageServerDump</code> routine prints various bits of cryptic information, the most useful of which is the list of ongoing file ID tree transactions.</p></li></ul><p><span class="content_text"><!--a  -->Listing 45<!--/a--></span> shows how an example of accessing this information on Mac OS X 10.5 and later.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE45" title="Listing 45Print the file ID tree"></a><p class="codesample clear"><strong class="caption_number">Listing 45</strong>&nbsp;&nbsp;Print the file ID tree</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>Virtual-Victim:~ quinn$ sudo gdb
GNU gdb 6.3.50-20050815 (Apple version gdb-1344) [â€¦]
(gdb) attach coreservicesd
[â€¦]
(gdb) call (void)PrintVolumeInfo(0)
(gdb) # The volume reference number in the next command (-104) 
(gdb) # comes from the output of the previous command (see below).
(gdb) call (int)FileIDTreePrintVolumeIDs(-104)
$1 = 0
(gdb) call (void)CFShow((void*) FileIDTreeStorageServerDump("fsnode_all") )<span></span></pre></td></tr></tbody></table></div><p>To see the output of these commands, you have to display <code>/var/log/system.log</code> in a separate window, as shown in <span class="content_text"><!--a  -->Listing 46<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE46" title="Listing 46File ID tree output"></a><p class="codesample clear"><strong class="caption_number">Listing 46</strong>&nbsp;&nbsp;File ID tree output</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ tail -f /var/log/system.log
[â€¦] 1:vol=-100  "Macintosh HD"
[â€¦] 2:vol=-104  "UNTITLED"
[â€¦] 3:returned error -35
[â€¦]
[â€¦] volume -104 flags: &lt;dev_id:234881028, statFSFlags:2101272, devCheckTime:0&gt;
[â€¦] Index Entry: a0000025
[â€¦] . Index Entry: a0000024
[â€¦] . . . 2000001e: 1 at 
[â€¦] . . . 5a: 2 at UNTITLED
[â€¦] . Index Entry: a0000026
[â€¦] . . . 60: 16 at UNTITLED/.Trashes
[â€¦] . . . 67: 17 at UNTITLED/.Trashes/502
[â€¦] . . . 2f: 18 at UNTITLED/.fseventsd
[â€¦] No transactions in progress
[â€¦] Observers:
[â€¦] pid 717
[â€¦] port 0x8783(4) watching 192(UnmountFailed, Unmounted)
[â€¦] port 0x8947(3) watching 192(UnmountFailed, Unmounted)
[â€¦] port 0x5427(2) watching 192(UnmountFailed, Unmounted)
[â€¦] port 0xe017(1) watching 194(Mounted, UnmountFailed, Unmounted)
[â€¦]
[â€¦] 0x943f(9) watching 194(Mounted, UnmountFailed, Unmounted)
[â€¦] port 0xdaab(8) watching 11(RepairStarted, Mounted, Renamed)
[â€¦] port 0x9dc7(7) watching 202(Mounted, Renamed, UnmountFailed, Un[â€¦]
[â€¦] port 0x7447(6) watching 234(Mounted, Renamed, AboutToUnmount, U[â€¦]
[â€¦] port 0xcc9b(5) watching 194(Mounted, UnmountFailed, Unmounted)
[â€¦] port 0x6263(4) watching 192(UnmountFailed, Unmounted)
[â€¦] port 0xc943(3) watching 192(UnmountFailed, Unmounted)
[â€¦] port 0x9927(2) watching 192(UnmountFailed, Unmounted)
[â€¦] port 0x24a3(1) watching 250(Mounted, Renamed, PropertyChanged, [â€¦]
[â€¦] pid 168
[â€¦] port 0x7863(5) watching 194(Mounted, UnmountFailed, Unmounted)
[â€¦] port 0x6ad3(4) watching 192(UnmountFailed, Unmounted)
[â€¦] port 0x2f97(3) watching 192(UnmountFailed, Unmounted)
[â€¦] port 0xca93(2) watching 192(UnmountFailed, Unmounted)
[â€¦]
[â€¦] Process info:<span></span></pre></td></tr></tbody></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_43" title="Note"></a><p><strong>Note:</strong>&nbsp;On Mac OS X 10.4.x you must use a different technique to see the output of these commands. Rather than just running <code>syslog</code>, you must redirect <code>coreservicesd</code>'s <code>stderr</code> to your terminal device, as described in <span class="content_text"><a href="https://developer.apple.com/technotes/tn/tn2030.html" class="urlLink" rel="external">Technical Note TN2030, 'GDB for MacsBug Veterans'</a></span>.</p><p></p></aside></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_44" title="Note"></a><p><strong>Note:</strong>&nbsp;On Mac OS X 10.5 and later, <code>FileIDTreeStorageServerDump</code> only prints the list of in-progress file ID tree transactions; on Mac OS X 10.4.x it also prints a whole bunch of other cryptic information which is not really useful for third party developers.</p><p></p></aside></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_45" title="Note"></a><p><strong>Note:</strong>&nbsp;In Mac OS X 10.3.x, the file ID tree was maintained independently by each process. You can dump the tree by calling <code>PrintFileIDTree</code> from GDB. It takes a single volume reference number parameter and prints the current process's mapping from file IDs to file paths on that volume.</p><p></p></aside></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECFOLDERS" title="Folder Manager"></a><h3 class="jump">Folder Manager</h3><p>The Folder Manager supports a single environment variable, <code>FolderDebug</code>. If you set this to 1, the Folder Manager will print a number of extra debugging messages. This facility requires the Core Services debug library.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECGESTALT" title="Gestalt"></a><h3 class="jump">Gestalt</h3><p>Core Services exports three routinesâ€”<code>DebugDumpGestalt</code>, <code>DebugGestalt</code>, and <code>DebugGestaltStr</code>â€”that you can call from GDB to view the Gestalt registry. <span class="content_text"><!--a  -->Listing 47<!--/a--></span> shows an example of their use.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE47" title="Listing 47Using the Gestalt debug routines"></a><p class="codesample clear"><strong class="caption_number">Listing 47</strong>&nbsp;&nbsp;Using the Gestalt debug routines</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) call (void)DebugDumpGestalt()
'a/ux': 0x7fff8887b74b (proc)
'addr': 0x00000007
[â€¦]
'vm  ': 0x00000011
[â€¦]
(gdb) call (void)DebugGestalt(0x766d2020)
'vm  ': 0x00000011
(gdb) call (void)DebugGestaltStr("  mv")
'vm  ': 0x00000011<span></span></pre></td></tr></tbody></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_46" title="Note"></a><p><strong>Note:</strong>&nbsp;On little-endian computers you have to reverse the string you pass to <code>DebugGestaltStr</code>. That is, rather than pass "vm  " you have to pass "  mv" 
			(r. <span class="content_text"><a href="rdar://problem/7607346" class="urlLink" rel="external">7607346</a></span>)
		.</p><p></p></aside></div><p>Prior to Mac OS X 10.5, these routines print the Gestalt selector in reverse on little-endian computers. For example, the first line of output of <code>DebugDumpGestalt</code> would be 'xu/a', not 'a/ux' 
			(r. <span class="content_text"><a href="rdar://problem/5491464" class="urlLink" rel="external">5491464</a></span>)
		.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECPASTEBOARD" title="Pasteboard"></a><h3 class="jump">Pasteboard</h3><p>Starting in Mac OS X 10.6 the <code>pbs</code> tool (<code>/System/Library/CoreServices/pbs</code>) has a number of useful debugging options. Run the tool with the <code>-?</code> argument to see a list.</p><p>If you'd like to see what's been put on the pasteboard, check out the <span class="content_text"><a href="https://developer.apple.com/samplecode/ClipboardViewer/index.html" class="urlLink" rel="external">Sample Code 'ClipboardViewer'</a></span> sample.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECTHREADING" title="Threading"></a><h3 class="jump">Threading</h3><p>The Core Services threading APIs (MP threads and Thread Manager) support an environment variable, <code>ThreadDebug</code>, that enables a few debug messages and a number of internal consistency checks. This facility requires the Core Services debug library.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECWEBSERVICES" title="Web Services"></a><h3 class="jump">Web Services</h3><p>Web Services supports two helpful environment variables, <code>WSDebug</code> and <code>WSDebugVerbose</code>, which you can set to 1 to get limited and verbose debug logging, respectively. These variables are effective in the non-debug library, but include even more logging in the debug library.</p></section><div class="back_to_top"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECDISKS" title="Disks and Discs"></a><h2 class="jump">Disks and Discs</h2><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECDISKARB" title="Disk Arbitration"></a><h3 class="jump">Disk Arbitration</h3><p>If you add a "-d" string to the <code>ProgramArguments</code> array in <code>/System/Library/LaunchDaemons/com.apple.diskarbitrationd.plist</code> and then restart, Disk Arbitration will log detailed information about its activities to <code>/var/log/diskarbitrationd.log</code>.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_47" title="Note"></a><p><strong>Note:</strong>&nbsp;Prior to Mac OS X 10.5 you can get the same result by appending "-d" to the <code>Command</code> property in <code>/etc/mach_init.d/diskarbitrationd.plist</code>.</p><p></p></aside></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECDISCRECORDING" title="Disc Recording"></a><h3 class="jump">Disc Recording</h3><p>If you set the <code>DRVerboseLogging</code> environment variable to 1, Disc Recording will log information about its activity to <code>~/Library/Logs/DiscRecording.log</code>.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_48" title="Note"></a><p><strong>Note:</strong>&nbsp;Due to a bug 
			(r. <span class="content_text"><a href="rdar://problem/4413303" class="urlLink" rel="external">4413303</a></span>)
		, this facility does not work on Mac OS X 10.4.x.</p><p></p></aside></div><p>Also, prior to Mac OS X 10.4 Disc Recording would always log to <code>stderr</code>.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECDISKUTILITY" title="Disk Utility"></a><h3 class="jump">Disk Utility</h3><p>If you set the <code>DUDebugMenuEnabled</code> preference to YES, Disk Utility will display a Debug menu with a number of helpful commands.</p></section><div class="back_to_top"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECAPPLICATIONSERVICES" title="Application Services"></a><h2 class="jump">Application Services</h2><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCOREGRAPHICS" title="Core Graphics"></a><h3 class="jump">Core Graphics</h3><p>Quartz Debug has a number of useful debugging features; see <span class="content_text"><a href="https://developer.apple.com/qa/qa2001/qa1236.html" class="urlLink" rel="external">Technical Q&amp;A QA1236, 'Debugging Graphics with QuartzDebug'</a></span> for more details.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECPROCESSMANAGER" title="Process Manager"></a><h3 class="jump">Process Manager</h3><p>There are circumstances where you want to debug a process, but you don't want to launch it from within GDB. For example, if you've ssh'd into a remote computer in order to debug a GUI application, you shouldn't launch it directly from GDB because the application will be in the wrong Mach bootstrap namespace, and thus can't connect to critical services like the pasteboard server. Normally this isn't a problem: you simply ask the remote user to launch the application for you and then attach to the running application using GDB's <code>attach</code> command. However, what happens if you want to debug the application's startup procedure?  You end up playing the 'attach race' game, where the user launches the application and you race to attach with GDB. Not good.</p><p>Process Manager offers a nice solution to this problem. If you set the <code>INIT_Processes</code> environment variable to 1, Process Manager will delay the application's launch for 15 seconds, giving you time to attach with GDB. It even logs a nice message (see <span class="content_text"><!--a  -->Listing 48<!--/a--></span>) to the system log letting you know what it's doing.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE48" title="Listing 48System log message generated by paused process"></a><p class="codesample clear"><strong class="caption_number">Listing 48</strong>&nbsp;&nbsp;System log message generated by paused process</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>[â€¦] Blocking on INIT_Processes for 15 seconds; attach to pid 103 if you want.<span></span></pre></td></tr></tbody></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_49" title="Note"></a><p><strong>Note:</strong>&nbsp;<span class="content_text"><a href="https://developer.apple.com/qa/qa2007/qa1573.html" class="urlLink" rel="external">Technical Q&amp;A QA1573, 'Debugging Process Startup'</a></span> describes a number of other techniques for debugging a process as it starts up.</p><p></p></aside></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECQUICKDRAW" title="QuickDraw"></a><h3 class="jump">QuickDraw</h3><div class="warningbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_50" title="Warning"></a><p><strong>Warning:</strong>&nbsp;As QuickDraw is now officially deprecated, these debugging facilities have not been verified on Mac OS X 10.6.</p><p></p><div class="clear"></div></aside></div><p>QuickDraw exports a number of routines that you can call from GDB to get information about QuickDraw state. The first three routinesâ€”<code>QDDebugPrintPortInfo</code>, <code>QDDebugPrintCGSInfo</code>, and <code>QDDebugDumpRegion</code>â€”print information to <code>stderr</code>. <span class="content_text"><!--a  -->Listing 49<!--/a--></span> shows an example of their use.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE49" title="Listing 49QuickDraw printing routines"></a><p class="codesample clear"><strong class="caption_number">Listing 49</strong>&nbsp;&nbsp;QuickDraw printing routines</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) set $window = (void *) FrontWindow()
(gdb) set $port = (void *) GetWindowPort($window)
(gdb) call (int) QDDebugPrintPortInfo($port)
Dumping port 0x435670...
    PixMap: 0x1FE72C
        Base Address: 0xB0028000 [onscreen, buffered]
        RowBytes: 0xFFFF9400
        Bounds: (0, 0, 106, 352) (352w x 106h)
        Depth: 0020
    Port bounds: (0, 0, 106, 352) (352w x 106h)
    Port shape: 0x1FE798 (0, 0, 106, 352) (352w x 106h) â€¦
    Vis rgn: 0x1FE730 (0, 0, 106, 352) (352w x 106h) â€¦
    Clip rgn: 0x1FE738 (-32000, -32000, 32000, 32000) â€¦
    Fore Color: 0000 0000 0000
    Back Color: FFFF FFFF FFFF
[â€¦]
$21 = 0
(gdb) call (int) QDDebugPrintCGSInfo($port)
CGS info for port 0x435670
    CGSWindowID: 19798
    Shape: 0x59E734 (99, 785, 205, 1137) (352w x â€¦
    Vis Region: 0x59E72C (0, 0, 0, 0) (0w x 0h) [rect]
    Dirty Region: 0x59E730 (0, 0, 0, 0) (0w x 0h) [rect]
$20 = 0
(gdb) # 0x1FE730 is "Vis rgn" from QDDebugPrintPortInfo
(gdb) set $rgn=0x1FE730
(gdb) call (int)QDDebugDumpRegion($rgn)
Size = 116  Bounds = (0, 0, 106, 352) (352w x 106h) NEW FORMAT
0: 2 350 
1: 1 351 
2: 0 352 
104: 1 351 
105: 2 350 
106: 

$21 = 0<span></span></pre></td></tr></tbody></table></div><p>The remaining routines are designed to help you visualize regions on screen by flashing the region shape. <span class="content_text"><!--a  -->Listing 50<!--/a--></span> shows how to call these routines; unfortunately you can't see the results in this document, so you'll have to try this yourself. It assumes that the <code>$port</code> and <code>$rgn</code> convenience variables are set up as per <span class="content_text"><!--a  -->the previous listing<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE50" title="Listing 50QuickDraw flashing routines"></a><p class="codesample clear"><strong class="caption_number">Listing 50</strong>&nbsp;&nbsp;QuickDraw flashing routines</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) call (int) QDDebugFlashRegion($port, $rgn)
$23 = 0
(gdb) call (void) QDDebugFlashClipRgn($port)
(gdb) call (void) QDDebugFlashPortShape($port)
(gdb) call (void) QDDebugFlashVisRgn($port)
(gdb) call (int) QDDebugFlashCGSWindowShape($port)
$24 = 0
(gdb) call (int) QDDebugFlashCGSWindowOpaqueShape($port)
$25 = 0
(gdb) call (int) QDDebugFlashCGSVisRgn($port)
$26 = 0
(gdb) call (int) QDDebugFlashCGSDirtyRgn($port)
$27 = 0<span></span></pre></td></tr></tbody></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_51" title="Note"></a><p><strong>Note:</strong>&nbsp;Unfortunately <code>QDDebugFlashCGSWindowShape</code> and <code>QDDebugFlashCGSWindowOpaqueShape</code> crash when called on Mac OS X 10.5 
			(r. <span class="content_text"><a href="rdar://problem/5491538" class="urlLink" rel="external">5491538</a></span>)
		.</p><p></p></aside></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECSERVICES" title="Services"></a><h3 class="jump">Services</h3><p>The <span class="content_text"><a href="http://developer.apple.com/library/mac/#documentation/cocoa/Conceptual/SysServices/introduction.html" class="browserLink">Services Implementation Guide</a></span> describes a number of helpful hints about debugging services, including:</p><ul class="ul"><li class="li"><p>the <code>NSDebugServices</code> user default</p></li><li class="li"><p>the <code>pbs</code> tool</p></li></ul></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECQUICKLOOK" title="Quick Look"></a><h3 class="jump">Quick Look</h3><p>Quick Look has some nice features to help you debug your generator code; these are documented in depth in the <span class="content_text"><a href="http://developer.apple.com/library/mac/#DOCUMENTATION/UserExperience/Conceptual/Quicklook_Programming_Guide/Articles/QLDebugTest.html" class="browserLink">Quick Look Programming Guide</a></span>.</p></section><div class="back_to_top"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCARBON" title="Carbon (HIToolbox)"></a><h2 class="jump">Carbon (HIToolbox)</h2><p>Carbon's HIToolbox includes a wealth of facilities for your debugging convenience:</p><ul class="ul"><li class="li"><p>There is a debug variant of the HIToolbox library that prints debugging messages when it encounters errors.</p></li><li class="li"><p>There are numerous HIToolbox routines that you can call from within GDB to <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBPRINTERS">print information about HIToolbox objects</a></span> in your process, including events, menus, windows, dialogs, and controls.</p></li><li class="li"><p>There are routines to <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBFLASHERS">flash regions</a></span> so that can visualize them on screen.</p></li><li class="li"><p>This are a variety of facilities to <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBEVENTTRACE">trace events</a></span> as they flow through the toolbox.</p></li></ul><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_52" title="Important"></a><p><strong>Important:</strong>&nbsp;Starting with Mac OS X 10.5 most HIToolbox debugging routines are declared in a public header file (<code>HIToolboxDebugging.h</code>). This change required that some routines be renamed. <span class="content_text"><!--a  -->Table 19<!--/a--></span> shows the new and old names.</p><p></p></aside></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE19" title="Table 19New and old names for HIToolbox object printing routines"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 19</strong>&nbsp;&nbsp;New and old names for HIToolbox object printing routines</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Mac OS X 10.5 and later
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Mac OS X 10.4.x and earlier
</p></th></tr><tr><td scope="row"><p>
DebugPrintMainEventQueue
</p></td><td><p>
GDBPrintEventQueue
</p></td></tr><tr><td scope="row"><p>
DebugPrintEventQueue
</p></td><td><p>
_DebugPrintEventQueue
</p></td></tr><tr><td scope="row"><p>
DebugPrintEvent
</p></td><td><p>
_DebugPrintEvent
</p></td></tr><tr><td scope="row"><p>
DebugPrintDialogInfo
</p></td><td><p>
GDBShowDialogInfo
</p></td></tr><tr><td scope="row"><p>
DebugPrintControlHierarchy
</p></td><td><p>
GDBShowControlHierarchy
</p></td></tr><tr><td scope="row"><p>
DebugPrintControl
</p></td><td><p>
GDBShowControlInfo
</p></td></tr><tr><td scope="row"><p>
DebugSetEventTraceEnabled
</p></td><td><p>
SetEventTraceEnabled
</p></td></tr><tr><td scope="row"><p>
DebugTraceEventByName
</p></td><td><p>
TraceEventByName, UntraceEventByName
</p></td></tr><tr><td scope="row"><p>
DebugTraceEvent
</p></td><td><p>
TraceEvent, UntraceEvent
</p></td></tr></tbody></table></div><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBPRINTERS" title="HIToolbox Object Printing Routines"></a><h3 class="jump">HIToolbox Object Printing Routines</h3><p>The following listings show the various HIToolbox object printing routines.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE51" title="Listing 51HIToolbox event printing"></a><p class="codesample clear"><strong class="caption_number">Listing 51</strong>&nbsp;&nbsp;HIToolbox event printing</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) call (int)DebugPrintMainEventQueue()

Printing event queue 0x7632536c...
RunLoop: 0x40c560
Count: 4 Header: 0x1805010 Head: 0x49faf0 Tail: 0x489d10

EventRef Event Kind           Time       P Cnt Desc
-------- -------------------- ---------- - --- --------------------
  49FAF0 kEventMouseDown       219335.28 H 001 x=879, y=61, button 1
  489530 kEventWindowActivate  219335.46 H 002 0x4350A0 "Untitled 1"
  43A4E0 kEventAppActiveWindo 218971.143 S 002 
  489D10 kEventWindowUpdate   219335.473 L 002 0x4A3C10 "Untitled 1 Properties"
$2 = 0
(gdb) # 0x489D10 is the kEventWindowUpdate event from last command
(gdb) call (void) DebugPrintEvent(0x489D10)
Displaying event 489D10...
   Class           wind
   Kind            1
   When                219335
   Priority        Low
   RetainCount     2
   Queued          Yes
   Info            kEventWindowUpdate, 0x4A3C10 "Untitled 1 Properties"
   Parameters
        param: ----
           type: wind
           size: 4
           data: 004A3C10
                  J&lt;<span></span></pre></td></tr></tbody></table></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE52" title="Listing 52HIToolbox menu printing"></a><p class="codesample clear"><strong class="caption_number">Listing 52</strong>&nbsp;&nbsp;HIToolbox menu printing</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) call (void) DebugPrintMenuList()
Index  MenuRef     ID   Title
----- ---------- ------ -----
    1  0x0041F330 -21629 &lt;Apple&gt;
    2  0x0042EC00     128  QuickTime Player
    3  0x0043C4B0     129  File
    4  0x00445B70     130  Edit
[â€¦]
&lt;hierarchical menus&gt;
           0x0042CF90     140  Open Recent
(gdb) # 0x0042EC00 is the QuickTime Player menu
(gdb) set $menu=0x0042EC00
(gdb) call (void) DebugPrintMenu($menu)
MenuRef: 0x0042EC00
    Title : QuickTime Player
    ID : 128
    Width : 0
    Height : 0
    Enabled : true
    Attributes : CondenseSeparators, ReceivedInit
    Modal level : 0
    Refcount : 3
    Element : 0x004435B0
    Item Count : 12
    Item Icon  Cmd Key   Mark   CmdID E V Text
    ---- ---- -------- -------- ----- - - ----
    0001 0000 0x00 ' ' 0x00 ' '       Y Y About QuickTime Player
    0002 0000 0x00 ' ' 0x00 ' '       N Y -
    0003 0000 0x00 ' ' 0x00 ' '  pref Y Y Preferences
[â€¦]
HIObject
    Ref count : 3
    Event Target : 0x42f040
    Event Handler : 0x436f10
(gdb) call (void) DebugPrintMenuItem($menu, 1)
Menu: 0x0042EC00 Item: 1 Info:
 Text: About QuickTime Player
 Mark: &lt;none&gt;
 Cmd Key: &lt;none&gt;
 Icon: &lt;none&gt;
 Style Normal
 Command ID: 0 (0x00000000)
 Modifiers: 0x00
[â€¦]<span></span></pre></td></tr></tbody></table></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE53" title="Listing 53HIToolbox window and dialog printing"></a><p class="codesample clear"><strong class="caption_number">Listing 53</strong>&nbsp;&nbsp;HIToolbox window and dialog printing</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) call (void) DebugPrintWindowList() 

Window      Class    WID  Vis Hil Level Title                 Group
---------- -------- ---- --- --- ----- --------------------- -----------â€¦
0x004350A0  Document 4ED4  Y   Y      0 Untitled 1            0x76E47A89 â€¦
0x004A3C10  Document 4EED  Y   N      0 Untitled 1 Properties 0x76E47A89 â€¦
(gdb) # 0x004350A0 is the "Untitled 1" window
(gdb) set $window=0x004350A0
(gdb) # 0x004A3C10 is the "Untitled 1 Properties" dialog
(gdb) set $dialogWindow=0x004A3C10
(gdb) call (void) DebugPrintWindow($window)
Window 0x004350A0
    Title : Untitled 1
    Class : Document
    Group : 0x76E47A89 "com.apple.HIToolbox.windowgroups.document"
    Scope : all
    Attributes : Collapse Box, In WindowMenu
    Visible : Yes
    Collapsed : No
    Latent visibility : &lt;none&gt;
    Highlighted : Yes
    Structure region : 1FE80C #0, #0, #106, #352 (#352w x #106h) [non-rect]
[â€¦]
(gdb) call (void) DebugPrintAllWindowGroups()
Window group tree
-------------------------------------------------------------------------â€¦
  1  level    0  group 0x76E0BFE9 "com.apple.hitoolbox.windowgroups.root"
  2  level    0    group 0x76E47A89 "com.apple.HIToolbox.windowgroups.docâ€¦
(gdb) # 0x76E47A89 is the second window group
(gdb) call (void) DebugPrintWindowGroup(0x76E47A89)
WindowGroup 0x76E47A89 "com.apple.HIToolbox.windowgroups.document"
 Attributes: &lt;none&gt;
 Refcount: 1
 Previous group: &lt;none&gt;
 Next group: &lt;none&gt;
 Parent group: 0x76E0BFE9 "com.apple.hitoolbox.windowgroups.root"
[â€¦]
(gdb) set $dialog = (void *) GetDialogFromWindow($dialogWindow)
(gdb) call (void) DebugPrintDialogInfo($dialog)
Dialog: 0x76ED59A1
 Window: 0x004A3C10 "Untitled 1 Properties"
 TextHandle: 0x0059EC7C
 Default Item: 1
 Cancel Item: 0
 Keyboard Focus Item: 0
 RefCon: 0x06054AB5 (101010101)<span></span></pre></td></tr></tbody></table></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE54" title="Listing 54HIToolbox control printing"></a><p class="codesample clear"><strong class="caption_number">Listing 54</strong>&nbsp;&nbsp;HIToolbox control printing</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) call (void) DebugPrintControlHierarchy($window)
Dumping info for window 0x4A3C10
Window found. Dumping views...
Root 0x4ba260 , ID ''/0, (-32768,-32768,32767,32767), Embedder, Vis, Act,â€¦
    Control 0x4c24d0 &lt;appl/sbar&gt; ( "" ), ID ''/0, (172,301,226,317), Vis,â€¦
    Control 0x4c6080 &lt;appl/sbar&gt; ( "" ), ID ''/0, (75,301,142,317), Vis, â€¦
    Control 0x4c49c0 &lt;appl/push&gt; ( "Delete" ), ID ''/0, (241,220,261,290)â€¦
    Control 0x4c4790 &lt;appl/push&gt; ( "Edit?" ), ID ''/0, (241,135,261,205),â€¦
    Control 0x4c17c0 &lt;appl/push&gt; ( "Add?" ), ID ''/0, (241,50,261,120), Vâ€¦
    Control 0x4be1d0 &lt;appl/popb&gt; ( "" ), ID ''/0, (12,176,28,316), Vis, Aâ€¦
    Control 0x4ba1f0 &lt;appl/popb&gt; ( "" ), ID ''/0, (12,24,28,164), Vis, Acâ€¦
(gdb) # 0x4c24d0 is first scrollbar control
(gdb) call (void) DebugPrintControl(0x4c24d0)
HIScrollBar
    Size : Auto
    Live Tracking : No
Control 0x004C24D0 ""
    Control Kind : 'appl', 'sbar'
    Control ID : '', 0
    Window : 0x004A3C10 "Untitled 1 Properties"
    Parent : 0x004BA260
    Minimum : 0 (0x00000000)
    Maximum : 0 (0x00000000)
    Value : 0 (0x00000000)
[â€¦]
HIObject
    Ref count : 1
    Event Target : 0x4c39a0
    Event Handler : 0x4c3a10<span></span></pre></td></tr></tbody></table></div><p>Finally, you can print the debug information for any HIObject (windows, menus, controls, HIViews, and so on) using <code>HIObjectPrintDebugInfo</code>.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBFLASHERS" title="HIToolbox Region Flashing"></a><h3 class="jump">HIToolbox Region Flashing</h3><p>The routines shown in <span class="content_text"><!--a  -->Listing 55<!--/a--></span> can be used to flash regions so that you can visualize them on screen; unfortunately you can't see the results in this document, so you'll have to try this yourself.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE55" title="Listing 55HIToolbox region flashing routines"></a><p class="codesample clear"><strong class="caption_number">Listing 55</strong>&nbsp;&nbsp;HIToolbox region flashing routines</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) call (void) DebugFlashWindowVisRgn($window) (gdb) call (void) DebugFlashWindowUpdateRgn($window)<span></span></pre></td></tr></tbody></table></div><p>You can also use <code>HIViewFlashDirtyArea</code>, introduced in Mac OS X 10.5 and documented in <code>HIToolboxDebugging.h</code>.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBEVENTDEBUG" title="HIToolbox Event Debugging"></a><h3 class="jump">HIToolbox Event Debugging</h3><p>With the advent of Carbon Events, it's often hard to understand the flow of events through the toolbox. HIToolbox offers two debugging facilities that can help here.</p><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBEVENTDEBUGENV" title="EventDebug Environment Variable"></a><h4 class="jump">EventDebug Environment Variable</h4><p>By setting the <code>EventDebug</code> environment variable to 1, you cause HIToolbox to log all events as they flow through the system. <span class="content_text"><!--a  -->Listing 56<!--/a--></span> shows an example of this.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE56" title="Listing 56EventDebug output"></a><p class="codesample clear"><strong class="caption_number">Listing 56</strong>&nbsp;&nbsp;EventDebug output</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ EventDebug=1 /Applications/iTunes.app/Contents/MacOS/iTunes 
Event Posted: Queue: 0x1809c00, Event: kEventAppleEvent, 4949.1, S â€¦
SendEventToEventTarget entered with event kEventTargetHandlerInstalled
    Sending event to target application: kEventTargetHandlerInstalled
        Leaving target application with result -9874
[â€¦]
SendEventToEventTarget entered with event kEventHIObjectInitialize
    Sending event to target 0xb: kEventHIObjectInitialize
        SendEventToEventTarget entered with event kEventControlInitialize
            Sending event to target 0xb: kEventControlInitialize
                Called handler 0x945f072a. Event was handled
                Leaving target 0xb with result 0
[â€¦]<span></span></pre></td></tr></tbody></table></div><p>You can programmatically enable and disable event tracing with the routine <code>DebugSetEventTraceEnabled</code>.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBEVENTTRACE" title="Event Tracing"></a><h4 class="jump">Event Tracing</h4><p>The <code>EventDebug</code> environment variable produces a lot of output, which can have some negative effects. Specifically, it slows your program down considerably and it's sometimes hard to find the information you're looking for amongst all the output.</p><p>One solution to this problem is to enable event-by-event tracing. You can do this by calling the <code>DebugTraceEventByName</code> routine from within GDB. <span class="content_text"><!--a  -->Listing 57<!--/a--></span> shows an example of this, enabling tracing just for the <code>kEventRawKeyDown</code> event.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE57" title="Listing 57Event tracing"></a><p class="codesample clear"><strong class="caption_number">Listing 57</strong>&nbsp;&nbsp;Event tracing</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) call (void) DebugTraceEventByName("kEventRawKeyDown", 1)
(gdb) c
Continuing.
Event Posted: Queue: 0x76309338, Event: kEventRawKeyDown, 221443.183, S
SendEventToEventTarget entered
    Sending Event to 0x415750: kEventRawKeyDown
        SendEventToEventTarget entered
            Sending Event to 0x413050: kEventRawKeyDown
                Called handler 0x928CD05C. Event was NOT handled
                Leaving target 0x413050 with result -9874
        SendEventToEventTarget entered
            Sending Event to 0x42DE30: kEventRawKeyDown
                Leaving target 0x42DE30 with result -9874
            Sending Event to 0x4351F0: kEventRawKeyDown
                Leaving target 0x4351F0 with result -9874
            Sending Event to 0x4126F0: kEventRawKeyDown
                Called handler 0x929597E0. Event was NOT handled
                Called handler 0x927F4F40. Event was NOT handled
                Leaving target 0x4126F0 with result -9874
        Leaving target 0x415750 with result -9874
Event Removed: Queue: 0x76309338, Event: kEventRawKeyDown, 221443.183, S
Event Pulled (C): kEventRawKeyDown, 221443.183, S<span></span></pre></td></tr></tbody></table></div><p>Also, starting in Mac OS X 10.5, you can see what events are being traced by calling <code>DebugPrintTracedEvents</code>.</p></section></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBEVENTSTATS" title="HIToolbox Event Statistics"></a><h3 class="jump">HIToolbox Event Statistics</h3><p>There are two environment variables that cause HIToolbox to print event statistics. If you set <code>EventRate</code> to 1, HIToolbox will, every second, print a summary of the events handled that second. If you set <code>HLTBRecordEventStats</code>, HIToolbox will print a bunch of statistics about event handling when your application quits; this feature requires the debug library.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBOTHER" title="Other HIToolbox Debugging Facilities"></a><h3 class="jump">Other HIToolbox Debugging Facilities</h3><p>If you set the <code>NSQuitAfterLaunch</code> environment variable to 1, your application will quit as soon as it enters its event loop. This is useful if you want to measure application launch time, or look for leaks. This environment variable is also supported by <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECAPPKIT">AppKit</a></span>.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_53" title="Important"></a><p><strong>Important:</strong>&nbsp;In Mac OS X 10.4 and later you must be using the profile version of the HIToolbox framework (<code>HIToolbox_profile</code>) for this to work.</p><p></p></aside></div><p>If you set the <code>HLTBPrintKeyMatchingStatus</code> environment variable to 1, HIToolbox will print detailed information about menu item matching. This feature requires the debug library.</p><p>If you set the <code>TSMEventTracing</code> environment variable to 1, HIToolbox will print detailed information about Text Services Manager (TSM) event processing.</p></section><div class="back_to_top"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCOCOA" title="Cocoa and Cocoa Touch"></a><h2 class="jump">Cocoa and Cocoa Touch</h2><p>All Cocoa objects (everything derived from <code>NSObject</code>) support a <code>description</code> method that returns an <code>NSString</code> describing the object. The most convenient way to access this description is via Xcode's Print Description to Console menu command. Alternatively, if you're a command line junkie, you can use GDB's <code>print-object</code> (or <code>po</code> for short) command, as illustrated by <span class="content_text"><!--a  -->Listing 58<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE58" title="Listing 58Using GDB&#39;s po command"></a><p class="codesample clear"><strong class="caption_number">Listing 58</strong>&nbsp;&nbsp;Using GDB's po command</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ gdb /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) [â€¦]
(gdb) fb -[NSCFDictionary copyWithZone:]
Breakpoint 1 at 0x83126e97675259
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
Reading symbols for shared libraries [â€¦]
Breakpoint 1, 0x00007fff837aa259 in -[NSCFDictionary copyWithZone:] ()
(gdb) po $rdi
{
    AddExtensionToNewPlainTextFiles = 1;
    AutosaveDelay = 30;
    CheckGrammarWithSpelling = 0;
    CheckSpellingWhileTyping = 1;
    [â€¦]
}<span></span></pre></td></tr></tbody></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_54" title="Note"></a><p><strong>Note:</strong>&nbsp;<code>print-object</code> actually calls the <code>debugDescription</code> method of the specified object. <code>NSObject</code> implements this method by calling through to the <code>description</code> method. Thus, by default, an object's debug description is the same as its description. However, you can override <code>debugDescription</code> if you want to decouple these; many Cocoa objects do this.</p><p></p></aside></div><p>Curiously, the <code>debugDescription</code> method is not declared in any header. If you want to implement it yourself, you should do so as shown in <span class="content_text"><!--a  -->Listing 59<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE59" title="Listing 59Implementing debugDescription"></a><p class="codesample clear"><strong class="caption_number">Listing 59</strong>&nbsp;&nbsp;Implementing debugDescription</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>- (NSString *)debugDescription {     ... your code here ... }<span></span></pre></td></tr></tbody></table></div><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECOBJECTIVEC" title="Objective-C"></a><h3 class="jump">Objective-C</h3><p>To break on an Objective-C exception, regardless of how it's thrown, set a symbolic breakpoint on <code>objc_exception_throw</code>. The easiest way to set such a breakpoint is with Xcode's Stop on Objective-C Exceptions menu command.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_55" title="Note"></a><p><strong>Note:</strong>&nbsp;This is better than setting a breakpoint on <code>-[NSException raise]</code> because it will be hit even if the exception is thrown using <code>@throw</code>.</p><p></p></aside></div><p>If you set the <code>NSObjCMessageLoggingEnabled</code> environment variable to "YES", the Objective-C runtime will log all dispatched Objective-C messages to a file named <code>/tmp/msgSends-&lt;pid&gt;</code>.</p><p>If you set the <code>OBJC_HELP</code> environment variable (10.4 and later), the Objective-C runtime will print out a list of all of the debugging environment variables that it supports. The exact list varies from release-to-release, so you should set <code>OBJC_HELP</code> on your particular system to see what's available. <span class="content_text"><!--a  -->Table 20<!--/a--></span> lists some of the highlights.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE20" title="Table 20Useful Objective-C runtime debugging environment variables"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 20</strong>&nbsp;&nbsp;Useful Objective-C runtime debugging environment variables</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Variable
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td scope="row"><p>
OBJC_PRINT_IMAGES
</p></td><td><p>
Log images loaded by runtime
</p></td></tr><tr><td scope="row"><p>
OBJC_PRINT_LOAD_METHODS
</p></td><td><p>
Log execution of +load methods
</p></td></tr><tr><td scope="row"><p>
OBJC_DEBUG_FRAGILE_SUPERCLASSES
</p></td><td><p>
Warns if a class's instance variables overlap its superclass's instance variables
</p></td></tr><tr><td scope="row"><p>
OBJC_PRINT_EXCEPTIONS (Mac OS X 10.5 and later)
</p></td><td><p>
Log exception handling
</p></td></tr><tr><td scope="row"><p>
OBJC_PRINT_REPLACED_METHODS (Mac OS X 10.5 and later)
</p></td><td><p>
Prints information about replaced methods; this is particularly useful when implementing plug-ins, or an application that hosts plug-ins
</p></td></tr></tbody></table></div><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_56" title="Important"></a><p><strong>Important:</strong>&nbsp;To be effective these environment variables must be set to "YES".</p><p></p></aside></div><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECOBJECTIVECASSEMBLY" title="Assembly-Level Objective-C Debugging"></a><h4 class="jump">Assembly-Level Objective-C Debugging</h4><p>When debugging Cocoa code at the assembly level, keep in mind the following features of the Objective-C runtime:</p><ul class="ul"><li class="li"><p>The Objective-C compiler adds two implicit parameters to each method, the first of which is a pointer to the object being called (<code>self</code>).</p></li><li class="li"><p>The second implicit parameter is the method selector (<code>_cmd</code>). In Objective-C this is of type <code>SEL</code>; in GDB you can print this as a C string.</p></li><li class="li"><p>The Objective-C runtime dispatches methods via a family of C function. The most commonly seen is <code>objc_msgSend</code>, but some architectures use <code>objc_msgSend_stret</code> for methods which returns structures, and some architectures use <code>objc_msgSend_fpret</code> for methods that return floating point values. There are also equivalent functions for calling <code>super</code> (<code>objc_msgSendSuper</code> and so on).</p></li><li class="li"><p>The first word of any Objective-C object (the <code>isa</code> field) is a pointer to the object's class.</p></li></ul><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_57" title="Note"></a><p><strong>Note:</strong>&nbsp;If you're interested in learning more about Objective-C message dispatch, you should check out <span class="content_text"><a href="http://sealiesoftware.com/blog/archive/2008/09/22/objc_explain_So_you_crashed_in_objc_msgSend.html" class="urlLink" rel="noreferrer">this article</a></span>.</p><p></p></aside></div><p><span class="content_text"><!--a  -->Table 21<!--/a--></span> is a summary of how to access <code>self</code> and <code>_cmd</code> from GDB if you've stopped at the first instruction of a method. For more information about this, see <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECSOMEASSEMBLY">Some Assembly Required</a></span>. </p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE21" title="Table 21Accessing self and _cmd"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 21</strong>&nbsp;&nbsp;Accessing self and _cmd</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Architecture
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
self
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
_cmd
</p></th></tr><tr><td scope="row"><p>
Intel 64-bit
</p></td><td><p>
$rdi
</p></td><td><p>
$rsi
</p></td></tr><tr><td scope="row"><p>
Intel 32-bit
</p></td><td><p>
*(int*)($esp+4)
</p></td><td><p>
*(int*)($esp+8)
</p></td></tr><tr><td scope="row"><p>
PowerPC
</p></td><td><p>
$r3
</p></td><td><p>
$r4
</p></td></tr></tbody></table></div><p><span class="content_text"><!--a  -->Listing 60<!--/a--></span> shows an example of how to use this information from GDB.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE60" title="Listing 60Objective-C runtime &#39;secrets&#39;"></a><p class="codesample clear"><strong class="caption_number">Listing 60</strong>&nbsp;&nbsp;Objective-C runtime 'secrets'</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ gdb /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) [â€¦]
(gdb) # Give the runtime a chance to start up.
(gdb) fb NSApplicationMain
Breakpoint 1 at 0x9374bc69df7307
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
Reading symbols for shared libraries [â€¦]
Breakpoint 1, 0x00007fff841a0307 in NSApplicationMain ()
(gdb) # Set a breakpoint on -retain.
(gdb) b *'-[NSObject(NSObject) retain]'
Breakpoint 2 at 0x7fff8608a860
(gdb) c
Continuing.

Breakpoint 2, 0x00007fff8608a860 in -[NSObject(NSObject) retain] ()
(gdb) # Hit the breakpoint; dump the first 4 words of the object
(gdb) x/4xg $rdi
0x1001138f0: 0x00007fff7055e6d8  0x0041002f01a00000
0x100113900: 0x0069006c00700070  0x0069007400610063
(gdb) # Now print the selector
(gdb) x/s $rsi
0x7fff848d73d8: "retain"
(gdb) # Want to 'po' object; must disable the breakpoint first
(gdb) dis
(gdb) po $rdi
/Applications/TextEdit.app
(gdb) # Print the 'isa' pointer, which is a Class object.
(gdb) po 0xa02d9740
NSPathStore2<span></span></pre></td></tr></tbody></table></div><p>When debugging without symbols, you can use functions from the Objective-C runtime to assist your debugging efforts. The routines shown in <span class="content_text"><!--a  -->Table 22<!--/a--></span> are particularly useful.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE22" title="Table 22Useful Objective-C runtime functions"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 22</strong>&nbsp;&nbsp;Useful Objective-C runtime functions</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Function
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td scope="row"><p>
id objc_getClass(const char *name);
</p></td><td><p>
Get the Objective-C Class object for the given class name
</p></td></tr><tr><td scope="row"><p>
SEL sel_getUid(const char *str);
</p></td><td><p>
Get the Objective-C SEL for the given method name
</p></td></tr><tr><td scope="row"><p>
IMP class_getMethodImplementation(Class cls, SEL name);
</p></td><td><p>
Get a pointer to the code that implements the given method in a given class; available on Mac OS X 10.5 and later
</p></td></tr><tr><td scope="row"><p>
Method class_getInstanceMethod(Class, SEL);
</p></td><td><p>
Get the Objective-C Method for a given instance method in a given class
</p></td></tr></tbody></table></div><p><span class="content_text"><!--a  -->Listing 61<!--/a--></span> shows an example of debugging the <code>-[DocumentController openUntitledDocumentAndDisplay:error:]</code> method of TextEdit, even though TextEdit does not ship with symbols.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE61" title="Listing 61Using the Objective-C runtime to debug without symbols"></a><p class="codesample clear"><strong class="caption_number">Listing 61</strong>&nbsp;&nbsp;Using the Objective-C runtime to debug without symbols</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ gdb -arch x86_64 /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) [â€¦]
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
Reading symbols for shared libraries [â€¦]
^C
(gdb) # Try to find the 
(gdb) # -[DocumentController openUntitledDocumentAndDisplay:error:] 
(gdb) # symbol.
(gdb) info func openUntitledDocumentAndDisplay
All functions matching regular expression "openUntitledDocumentAndDisplay":

Non-debugging symbols:
0x00007fff843ac083 -[NSDocumentController openUntitledDocumentAndDisplay:error:]
(gdb) # These are not the droids we're looking for. It turns out that 
(gdb) # TextEdit ships with its symbols stripped, so we'll have to do 
(gdb) # this the hard way.
(gdb) #
(gdb) # Get the Class object for the DocumentController class.
(gdb) set $class=(void *)objc_getClass("DocumentController")
(gdb) # Get the SEL object for the "openUntitledDocumentAndDisplay:error:" method.
(gdb) set $sel=(void *)sel_getUid("openUntitledDocumentAndDisplay:error:")
(gdb) # Get a pointer to the method implementation.
(gdb) call (void*)class_getMethodImplementation($class, $sel)
$1 = (void *) 0x100001966
(gdb) # Confirm that this is sensible. Looks like a method prologue to me.
(gdb) x/4i 0x00009aa5
0x100001966: push   %rbp
0x100001967: mov    %rsp,%rbp
0x10000196a: push   %r12
0x10000196c: push   %rbx
(gdb) # Set a breakpoint on the method.
(gdb) b *0x100001966
Breakpoint 1 at 0x100001966
(gdb) # Resume execution, and then create a new, untitled document.
(gdb) c
Continuing.
[â€¦]
Breakpoint 1, 0x0000000100001966 in ?? ()
(gdb) # We've hit our breakpoint; print the parameters, starting with 
(gdb) # the implicit "self" and "SEL" parameters that are common to all 
(gdb) # methods, followed by the method-specific "display" and 
(gdb) # "error" parameters.
(gdb) po $rdi
&lt;DocumentController: 0x100227a50&gt;
(gdb) x/s $rsi
0x7fff848e4e04: "openUntitledDocumentAndDisplay:error:"
(gdb) p (int)$rdx
$2 = 1
(gdb) x/xg $rcx
0x7fff5fbff108: 0x00000001001238f0<span></span></pre></td></tr></tbody></table></div><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_58" title="Important"></a><p><strong>Important:</strong>&nbsp;If you are confused by the register names (<code>$rdi</code> and so on) in <span class="content_text"><!--a  -->Listing 60<!--/a--></span> and <span class="content_text"><!--a  -->Listing 61<!--/a--></span>, you can learn more about this in <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECSOMEASSEMBLY">Some Assembly Required</a></span>.</p><p></p></aside></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_59" title="Note"></a><p><strong>Note:</strong>&nbsp;The <code>class_getMethodImplementation</code> routine was introduced in Mac OS X 10.5. On earlier systems you have to use the <code>class_getInstanceMethod</code> routine. This returns a <code>Method</code> object; you can get a pointer to the method name (useful for double checking that everything worked) from the first word and a pointer to the method implementation from the third word. <span class="content_text"><!--a  -->Listing 62<!--/a--></span> shows how to do this.</p><p></p></aside></div><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE62" title="Listing 62Using class_getInstanceMethod when class_getMethodImplementation is not available"></a><p class="codesample clear"><strong class="caption_number">Listing 62</strong>&nbsp;&nbsp;Using class_getInstanceMethod when class_getMethodImplementation is not available</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ # You should only do this on old systems, so we're going to run 
$ # TextEdit as i386 in order to get the old Objective-C runtime.
$ gdb -arch i386 /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) [â€¦]
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
Reading symbols for shared libraries [â€¦]
^C
Program received signal SIGINT, Interrupt.
0x94af18da in mach_msg_trap ()
(gdb) # These steps are unchanged.
(gdb) set $class=(void *)objc_getClass("DocumentController")
(gdb) set $sel=(void *)sel_getUid("openUntitledDocumentAndDisplay:error:")
(gdb) # Get the Method for that method of that class
(gdb) call (void*)class_getInstanceMethod($class, $sel)
$1 = (void *) 0x11aab0
(gdb) # Dump the Method
(gdb) x/3x 0x11aab0
0x11aab0: 0x913b28c9  0x00015acb  0x00002b64
(gdb) # Print the first word, just to make sure everything is copacetic
(gdb) x/s 0x913b28c9
0x913b28c9: "openUntitledDocumentAndDisplay:error:"
(gdb) # The third word is a pointer to code; confirm that this is sensible
(gdb) x/4i 0x00002b64
0x2b64: push   %ebp
0x2b65: mov    %esp,%ebp
0x2b67: push   %esi
0x2b68: push   %ebx<span></span></pre></td></tr></tbody></table></div><p>You can learn more about the Objective-C runtime functions and data structures by looking through the headers in <code>/usr/include/objc/</code>.</p><div class="warningbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_60" title="Warning"></a><p><strong>Warning:</strong>&nbsp;As with many things described in this technote, the inner workings of the Objective-C runtime are private: they have changed in the past, and they will change in the future. It's fine to use this information for debugging, but do not depend on it in code that you ship to customers.</p><p></p><div class="clear"></div></aside></div></section></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECGC" title="Garbage Collection"></a><h3 class="jump">Garbage Collection</h3><p>If you set the <code>AUTO_USE_GUARDS</code> environment variable to <code>YES</code>, the garbage collected memory allocator will work like the <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECGMALLOC">Guarded Memory Allocator</a></span>, placing guard pages at the end of each memory allocation. This is a great way to detect buffer overruns.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_61" title="Important"></a><p><strong>Important:</strong>&nbsp;We recommended that, if you enable <code>AUTO_USE_GUARDS</code>, you should also enable <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECGMALLOC">libgmalloc</a></span>.</p><p></p></aside></div><p>If you set the <code>AUTO_DISABLE_GENERATIONAL</code> environment variable to <code>YES</code>, the garbage collected memory allocator will disable its generational collector; all collections will be full collections.</p><p>You can use the environment variables from <span class="content_text"><!--a  -->Table 23<!--/a--></span> to enable various logging facilities in the garbage collected memory allocator. Some of these will generate a lot of logging.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE23" title="Table 23Garbage collected memory allocator logging environment variables"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 23</strong>&nbsp;&nbsp;Garbage collected memory allocator logging environment variables</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Environment Variable
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Effect
</p></th></tr><tr><td scope="row"><p>
AUTO_LOG_COLLECTIONS
</p></td><td><p>
Log when a collection occurs
</p></td></tr><tr><td scope="row"><p>
AUTO_LOG_REGIONS
</p></td><td><p>
Log when new regions are allocated
</p></td></tr><tr><td scope="row"><p>
AUTO_LOG_WEAK
</p></td><td><p>
Log all weak reference manipulations
</p></td></tr><tr><td scope="row"><p>
AUTO_LOG_ALL
</p></td><td><p>
Equivalent to setting all of the above
</p></td></tr><tr><td scope="row"><p>
AUTO_REFERENCE_COUNT_LOGGING
</p></td><td><p>
Enables reference count logging 
</p></td></tr></tbody></table></div><p>The garbage collected memory allocator supports some other potentially useful environment variables, as shown in <span class="content_text"><!--a  -->Table 24<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE24" title="Table 24Garbage collected memory allocator other environment variables"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 24</strong>&nbsp;&nbsp;Garbage collected memory allocator other environment variables</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Environment Variable
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Effect
</p></th></tr><tr><td scope="row"><p>
AUTO_COLLECT_EXHAUSTIVE_NOTIFICATION
</p></td><td><p>
If set, the allocator listens for a notification (in the &lt;notify.h&gt; sense) of the specified name and, when notified, triggers a collection
</p></td></tr><tr><td scope="row"><p>
AUTO_DIRTY_ALL_DELETED
</p></td><td><p>
Deleted objects will be scribbled (similar to MallocScribble)
</p></td></tr><tr><td scope="row"><p>
AUTO_USE_TLC
</p></td><td><p>
Disables the thread local collector (TLC)
</p></td></tr></tbody></table></div><p>When writing garbage collected code you sometimes run into problems where an object lives beyond its expected life. There are two useful GDB commands for debugging this:</p><ul class="ul"><li class="li"><p><code>info gc-roots</code> lists the roots leading to a specified address</p></li><li class="li"><p><code>info gc-references</code> lists all of the direct references to a specified address</p></li></ul><p>You can also access these commands via Xcode's Print Roots to Console and Print Referers to Console menu items.</p><p>If you have dual mode code (code that supports both the garbage collected and retain/release models), you can force it to run in retain/release mode by setting the <code>OBJC_DISABLE_GC</code> environment variable to <code>YES</code>.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECFOUNDATION" title="Foundation"></a><h3 class="jump">Foundation</h3><p>Foundation has a number of debugging facilities that are enabled by environment variables. <span class="content_text"><!--a  -->Table 25<!--/a--></span> highlights the most interesting ones; these are all further documented in <code>NSDebug.h</code>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-TABLE25" title="Table 25Environment variables from &#39;NSDebug.h&#39;"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 25</strong>&nbsp;&nbsp;Environment variables from 'NSDebug.h'</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Name
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Default
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Action
</p></th></tr><tr><td scope="row"><p>
NSZombieEnabled
</p></td><td><p>
NO
</p></td><td><p>
If set to YES, deallocated objects are 'zombified'; this allows you to quickly debug problems where you send a message to an object that has already been freed; see More Zombies! for details
</p></td></tr><tr><td scope="row"><p>
NSDeallocateZombies
</p></td><td><p>
NO
</p></td><td><p>
If set to YES, the memory for 'zombified' objects is actually freed
</p></td></tr><tr><td scope="row"><p>
NSUnbufferedIO
</p></td><td><p>
NO
</p></td><td><p>
If set to YES, Foundation will use unbuffered I/O for stdout (stderr is unbuffered by default)
</p></td></tr></tbody></table></div><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_62" title="Important"></a><p><strong>Important:</strong>&nbsp;To enable or disable a Foundation debugging facility, you must set the value of the environment variable to "YES" or "NO", not 1 or 0 as is the case with other system components.</p><p></p></aside></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_63" title="Note"></a><p><strong>Note:</strong>&nbsp;<code>NSDebug.h</code> describes a number of debugging facilities, for example <code>NSEnableAutoreleasePool</code>, that are not supported by Mac OS X 10.5 and later.</p><p></p></aside></div><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECRETAINCOUNTS" title="Retain Counts"></a><h4 class="jump">Retain Counts</h4><p>You can use <code>-retainCount</code> to get the current retain count of an object. While this can sometimes be a useful debugging aid, be very careful when you interpret the results. <span class="content_text"><!--a  -->Listing 63<!--/a--></span> shows one potential source of confusion.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE63" title="Listing 63Confusing retain count"></a><p class="codesample clear"><strong class="caption_number">Listing 63</strong>&nbsp;&nbsp;Confusing retain count</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) set $s=(void *)[NSClassFromString(@"NSString") string]
(gdb) p (int)[$s retainCount]
$4 = 2147483647
(gdb) p/x 2147483647
$5 = 0x7fffffff
(gdb) # The system maintains a set of singleton strings for commonly 
(gdb) # used values, like the empty string. The retain count for these 
(gdb) # strings is a special value indicating that the object can't be 
(gdb) # released.<span></span></pre></td></tr></tbody></table></div><p>Another common source of confusion is the autorelease mechanism. If an object has been autoreleased, its retain count is higher than you might otherwise think, a fact that's compensation for by the autorelease pool releasing it at some point in the future.</p><p>You can determine what objects are in what autorelease pools by calling <code>_CFAutoreleasePoolPrintPools</code> to print the contents of all the autorelease pools on the autorelease pool stack.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE64" title="Listing 64Printing the autorelease pool stack"></a><p class="codesample clear"><strong class="caption_number">Listing 64</strong>&nbsp;&nbsp;Printing the autorelease pool stack</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) call (void)_CFAutoreleasePoolPrintPools()
- -- ---- -------- Autorelease Pools -------- ---- -- -
==== top of stack ================
  0x327890 (NSCFDictionary)
  0x32cf30 (NSCFNumber)
  [â€¦]
==== top of pool, 10 objects ================
  0x306160 (__NSArray0)
  0x127020 (NSEvent)
  0x127f60 (NSEvent)
==== top of pool, 3 objects ================
- -- ---- -------- ----------------- -------- ---- -- -<span></span></pre></td></tr></tbody></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_64" title="Note"></a><p><strong>Note:</strong>&nbsp;<code>_CFAutoreleasePoolPrintPools</code> is only available on Mac OS X 10.6 or later.</p><p></p></aside></div><p>On earlier systems you can use the <code>NSAutoreleasePoolCountForObject</code> function to determine how many times an object has been added to an autorelease pool. For an example, see <span class="content_text"><!--a  -->Listing 65<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE65" title="Listing 65Calling NSAutoreleasePoolCountForObject"></a><p class="codesample clear"><strong class="caption_number">Listing 65</strong>&nbsp;&nbsp;Calling NSAutoreleasePoolCountForObject</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) # d is an NSDictionary created with -[NSDictionary dictionaryWithObjectsAndKeys:].
(gdb) p d
$1 = (NSDictionary *) 0x12d620
(gdb) po d
{
    test = 12345;
}
(gdb) p (int)[d retainCount]
$2 = 1
(gdb) p (int)NSAutoreleasePoolCountForObject(d)
$3 = 1<span></span></pre></td></tr></tbody></table></div><p>Starting with Mac OS X 10.6, NSAutoreleasePool implements a number of <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDTRACE">DTrace</a></span> probes that you can use to profile and debug autorelease issues. See the <span class="content_text"><a href="http://developer.apple.com/library/ios/#releasenotes/Cocoa/Foundation.html" class="browserLink">Foundation Framework Release Notes</a></span> for details..</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECZOMBIES" title="More Zombies!"></a><h4 class="jump">More Zombies!</h4><p>A common type of bug when programming with Cocoa is over-releasing an object. This typically causes your application to crash, but the crash occurs after the last reference count is released (when you try to message the freed object), which is usually quite removed from the original bug. <code>NSZombieEnabled</code> is your best bet for debugging this sort of problems; it will uncover any attempt to interact with a freed object.</p><p>The easiest way to enable zombies is via <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECINSTRUMENTS">Instruments</a></span>. However, you can also enable zombies via an <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECENV">environment variable</a></span>. <span class="content_text"><!--a  -->Listing 66<!--/a--></span> shows the type of the message you'll see in this case.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE66" title="Listing 66The effect of NSZombie"></a><p class="codesample clear"><strong class="caption_number">Listing 66</strong>&nbsp;&nbsp;The effect of NSZombie</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ NSZombieEnabled=YES build/Debug/DummyMac.app/Contents/MacOS/DummyMac  [â€¦] -[AppDelegate testAction:] [â€¦] *** -[CFNumber release]: message sent to deallocated instance 0x3737c0 Trace/BPT trap<span></span></pre></td></tr></tbody></table></div><p>As shown in <span class="content_text"><!--a  -->Listing 66<!--/a--></span>, the system will execute a breakpoint instruction if it detects a zombie. If you're running under GDB, the program will stop and you can look at the backtrace to see the chain of calls that triggered the zombie detector.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_65" title="Note"></a><p><strong>Note:</strong>&nbsp;Prior to Mac OS X 10.5 the zombie detector would raise an exception if it detected a zombie. You can use GDB to set a breakpoint on <code>-[_NSZombie methodSignatureForSelector:]</code> to further debug this sort of problem.</p><p></p></aside></div><p><code>NSZombieEnabled</code> also affects Core Foundation objects as well as Objective-C objects. However, you'll only be notified when you access a zombie Core Foundation object from Objective-C, not when you access it via a CF API.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_66" title="Note"></a><p><strong>Note:</strong>&nbsp;The integration between <code>NSZombieEnabled</code> and Core Foundation was introduced in Mac OS X 10.5.</p><p></p></aside></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECFOUNDATIONOTHER" title="Other Foundation Magic"></a><h4 class="jump">Other Foundation Magic</h4><p>If you're using Key-Value Observing and you want to know who is observing what on a particular object, you can get the observation information for that object and print it using using GDB's <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCOCOA">print-object command</a></span>. <span class="content_text"><!--a  -->Listing 67<!--/a--></span> shows an example of this.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE67" title="Listing 67Display key-value observers"></a><p class="codesample clear"><strong class="caption_number">Listing 67</strong>&nbsp;&nbsp;Display key-value observers</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) # self is some Objective-C object.
(gdb) po self
&lt;ZoneInfoManager: 0x48340d0&gt;
(gdb) # Let's see who's observing what key paths.
(gdb) po [self observationInfo]
&lt;NSKeyValueObservationInfo 0x48702d0&gt; (
&lt;NSKeyValueObservance 0x4825490: Observer: 0x48436e0, \
Key path: zones, Options: &lt;New: NO, Old: NO, Prior: NO&gt; \
Context: 0x0, Property: 0x483a820&gt;
)<span></span></pre></td></tr></tbody></table></div><p>You can set the <code>NSShowNonLocalizedStrings</code> preference to find strings that should have been localized but weren't. Once enabled, if you request a localized string and the string is not found in a strings file, the system will return the string capitalized and log a message to the console. This is a great way to uncover problems with out-of-date localizations.</p><p>This setting affects <code>NSLocalizedString</code>, all of its variants, and all underlying infrastructure including <code>CFCopyLocalizedString</code>.</p><p>If you set the <code>NSBundleLogResourceLookUp</code> preference, NSBundle will log its actions as it looks up resources within bundles; this facility is not available prior to Mac OS X 10.5.</p><p>If you set the <code>NSDOLoggingEnabled</code> environment variable to "YES", Foundation will enable logging for Distributed Objects (<code>NSConnection</code>, <code>NSInvocation</code>, <code>NSDistantObject</code>, and <code>NSConcretePortCoder</code>).</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_67" title="Note"></a><p><strong>Note:</strong>&nbsp;Prior to Mac OS X 10.5 the Foundation framework supported a couple of other environment variables:</p><p></p></aside></div><ul class="ul"><li class="li"><p>If you set the <code>NSPrintDynamicClassLoads</code> environment variable to "YES", Foundation would log a message whenever it loaded a class or category dynamically (that is, from a bundle).</p><p>This facility does not work in Mac OS X 10.5 or later; the nearest equivalent is the <code>DYLD_PRINT_LIBRARIES</code> environment variable, discussed in <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECDYLD">Dynamic Linker (dyld)</a></span>.</p></li><li class="li"><p>If you set the <code>NSExceptionLoggingEnabled</code> environment variable to "YES", Foundation would log all exception activity (<code>NSException</code>) to <code>stderr</code>.</p><p>This facility does not work in Mac OS X 10.5 or later; the nearest equivalent is the <code>OBJC_PRINT_EXCEPTIONS</code> environment variable, discussed in the <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECOBJECTIVEC">Objective-C</a></span> section.</p></li></ul></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECFOUNDATIONSCRIPTING" title="Foundation Scripting"></a><h4 class="jump">Foundation Scripting</h4><p>You can enable logging for Foundation's scripting support using the <code>NSScriptingDebugLogLevel</code> preference. <span class="content_text"><!--a  -->Listing 68<!--/a--></span> shows an example of this; the log shown is the result of running the trivial AppleScript <code>count windows of application "TextEdit"</code>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE68" title="Listing 68Enabling NSScriptingDebugLogLevel"></a><p class="codesample clear"><strong class="caption_number">Listing 68</strong>&nbsp;&nbsp;Enabling NSScriptingDebugLogLevel</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ /Applications/TextEdit.app/Contents/MacOS/TextEdit -NSScriptingDebugLogLevel 1
[â€¦] Suite NSCoreSuite, apple event code 0x3f3f3f3f
[â€¦] Suite NSTextSuite, apple event code 0x3f3f3f3f
[â€¦] Suite TextEdit, apple event code 0x74786474
[â€¦] Command: NSCoreSuite.Count
    Direct Parameter: (null)
    Receivers: (null)
    Arguments: {
        ObjectClass = 1668770158;
    }
[â€¦] Result: 1<span></span></pre></td></tr></tbody></table></div><p>Foundation scripting objects (things like <code>NSAppleEventDescriptor</code>) have meaningful <code>-description</code> methods, so you get useful output in <code>NSLog</code> and from GDB's <code>print-object</code> command.</p><p>One particularly useful example of the above is NSScriptSuiteRegistry. When debugging your scripting definitions, you can see the system's view of your application's scripting definitions by printing the description of <code>+[NSScriptSuiteRegistry sharedScriptSuiteRegistry]</code>, as illustrated in <span class="content_text"><!--a  -->Listing 69<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE69" title="Listing 69Print the system&#39;s view of your scripting definitions"></a><p class="codesample clear"><strong class="caption_number">Listing 69</strong>&nbsp;&nbsp;Print the system's view of your scripting definitions</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>(gdb) po [NSClassFromString(@"NSScriptSuiteRegistry") sharedScriptSuiteRegistry]
Suite: NSCoreSuite ('????') - uses unnamed arguments
    Name: "Standard Suite", description: "Common classes and commands for most applications."
    Class: NSApplication ('capp'), superclass: AbstractObject
        Implementation class: NSApplication
[â€¦]<span></span></pre></td></tr></tbody></table></div></section></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECCOREDATA" title="Core Data"></a><h3 class="jump">Core Data</h3><p>The <code>com.apple.CoreData.SQLDebug</code> preference lets you see the actual SQL sent to SQLite. See the "Debugging Fetching" section of the <span class="content_text"><a href="http://developer.apple.com/library/mac/#documentation/cocoa/Conceptual/CoreData/cdProgrammingGuide.html" class="browserLink">Core Data Programming Guide</a></span> for details. Additionally, if you set the <code>com.apple.CoreData.SyntaxColoredLogging</code> preference to 1, the logging will have spiffy syntax coloring.</p><p>The <code>com.apple.CoreData.SQLiteDebugSynchronous</code> preference controls some aspects of the SQLite store. See the "Configuring a SQLite Store's Save Behavior" section of the <span class="content_text"><a href="http://developer.apple.com/library/mac/#documentation/cocoa/Conceptual/CoreData/cdProgrammingGuide.html" class="browserLink">Core Data Programming Guide</a></span> for details.</p><p>If you set the <code>com.apple.CoreData.SQLiteIntegrityCheck</code> preference to 1, the SQLite store does extra integrity checking.</p><p>If you set the <code>com.apple.CoreData.MigrationDebug</code> preference to 1, Core Data will log information about exceptional cases as it migrates data.</p><p>The <code>com.apple.CoreData.ThreadingDebug</code> preference enables assertions to enforce Core Data's multi-threading policy. It is a number, where increasing values enable more debugging. A value of 3 is recommended. This feature requires the debug variant of the framework.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECAPPKIT" title="AppKit"></a><h3 class="jump">AppKit</h3><p>If you set the <code>NSQuitAfterLaunch</code> environment variable to 1, your application will quit as soon as it enters its event loop. This is useful if you want to measure application launch time or look for leaks. This environment variable is also supported by <span class="content_text"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECHLTBOTHER">Carbon</a></span>.</p><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECAPPKITEVENTS" title="AppKit Events"></a><h4 class="jump">AppKit Events</h4><p>If you set the <code>NSTraceEvents</code> preference to YES, AppKit will log information about all events it processes. <span class="content_text"><!--a  -->Listing 70<!--/a--></span> shows an example of this.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE70" title="Listing 70Using NSTraceEvents"></a><p class="codesample clear"><strong class="caption_number">Listing 70</strong>&nbsp;&nbsp;Using NSTraceEvents</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ /Applications/TextEdit.app/Contents/MacOS/TextEdit -NSTraceEvents YES
2010-02-04 11:08:44.776 TextEdit[29986:903] timeout = 62826929475.223495 se[â€¦]
2010-02-04 11:08:44.797 TextEdit[29986:903] got apple event of class 616576[â€¦]
2010-02-04 11:08:44.840 TextEdit[29986:903] still in loop, timeout = 628269[â€¦]
2010-02-04 11:08:44.841 TextEdit[29986:903] timeout = 62826929475.159660 se[â€¦]
[â€¦]<span></span></pre></td></tr></tbody></table></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECAPPKITVIEWS" title="AppKit Views"></a><h4 class="jump">AppKit Views</h4><p>NSView has a private method, <code>_subtreeDescription</code>, that you can call from GDB to see a pretty-printed description of the view's subviews.</p><p>If you set the <code>NSShowAllViews</code> preference to YES, AppKit will draw outlines around each of the views in a window. <span class="content_text"><!--a  -->Figure 5<!--/a--></span> shows how a standard TextEdit window looks with <code>NSShowAllViews</code> enabled.</p><figure class="figure"><a name="//apple_ref/doc/uid/DTS10003391-CH1-FIGURE5" title="Figure 5TextEdit with NSShowAllViews enabled"></a><figcaption><strong class="caption_number">Figure 5</strong>&nbsp;&nbsp;TextEdit with NSShowAllViews enabled</figcaption><img src="./Technical Note TN2124  Mac OS X Debugging Magic_files/tn2124_NSShowAllViews106.png" alt="" width="555" height="522"></figure><p>If you set the <code>NSShowAllDrawing</code> preference to YES, AppKit will flash every rectangle that it draws, much like Quartz Debug. <span class="content_text"><!--a  -->Figure 6<!--/a--></span> shown an example of what to expect.</p><figure class="figure"><a name="//apple_ref/doc/uid/DTS10003391-CH1-FIGURE6" title="Figure 6NSShowAllDrawing in action"></a><figcaption><strong class="caption_number">Figure 6</strong>&nbsp;&nbsp;NSShowAllDrawing in action</figcaption><img src="./Technical Note TN2124  Mac OS X Debugging Magic_files/tn2124_NSShowAllDrawing106.png" alt="" width="515" height="482"></figure><p>You can control the duration of the flash by setting <code>NSShowAllDrawing</code> to a number, which is interpreted as the number of milliseconds to flash; the default is 100 ms. You can control the color of the flash by setting <code>NSShowAllDrawingColor</code> to a string that holds three floating point numbers, separated by spaces, representing the red, green, and blue color components. Each number should be a value from 0.0 to 1.0 representing the intensity of that component. For example, the string "0.0 1.0 1.0" would yield pure cyan. Alternatively, if you set <code>NSShowAllDrawingColor</code> to "CYCLE", AppKit will cycle through pure red, pure green, and pure blue.</p><p>If you set the <code>NSDebugCursorRects</code> preference to YES, AppKit will log information about its cursor rect handling.</p><p>If you set the <code>NSDebugFocusRing</code> preference to YES, AppKit will visually highlight focus rings and log information about their construction.</p><p>On Mac OS X 10.6 you can disable concurrent view drawing by setting the <code>NSEnableConcurrentViewDrawing</code> preference to <code>NO</code>.</p></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECAPPKITOTHER" title="Other AppKit Magic"></a><h4 class="jump">Other AppKit Magic</h4><p>The <code>NSBindingDebugLogLevel</code> preference, introduced in Mac OS X 10.4, controls AppKit's response to binding problems. To receive useful logs about a binding problem (rather than, say, an undefined key exception), set this preference to 1. This is useful when trying to find a misconfigured binding in a large, bindings-rich application.</p><p>The <code>NSDragManagerLogLevel</code> preference is a number that controls how much logging AppKit does during drag and drop operations. Large values give you more logging. Currently the value of 6 is the maximum effective value. <span class="content_text"><!--a  -->Listing 71<!--/a--></span> shows an example of how to set this and the kind of output you get when you drag a simple text selection from TextEdit.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE71" title="Listing 71Using NSDragManagerLogLevel"></a><p class="codesample clear"><strong class="caption_number">Listing 71</strong>&nbsp;&nbsp;Using NSDragManagerLogLevel</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ /Applications/TextEdit.app/Contents/MacOS/TextEdit -NSDragManagerLogLevel 6
2010-02-04 11:32:55.956 TextEdit[30160:903] mouseDown location: {11, 360}, [â€¦]
2010-02-04 11:32:55.959 TextEdit[30160:903] offset of image lower left rela[â€¦]
2010-02-04 11:32:55.960 TextEdit[30160:903] type public.rtf: data &lt;7b5c7274[â€¦]
[â€¦]<span></span></pre></td></tr></tbody></table></div><p>The <code>NSAccessibilityDebugLogLevel</code> preference is a number that controls how much logging AppKit does during accessibility operations. We recommend that third party developers always use a value of 1.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_68" title="Note"></a><p><strong>Note:</strong>&nbsp;The <code>NSAccessibilityDebugLogLevel</code> preference is interpreted as a bit field. Bit 0, which is what's set when you use the recommended value of 1, causes AppKit to log the sort of information that's likely to be useful to you. The other bits (currently up to bit 4) show information that's more likely to be useful to Apple-internal developers.</p><p></p></aside></div><p>Prior to Mac OS X 10.4, <code>NSAccessibilityDebugLogLevel</code> had fewer options: a value of 1 turned logging on and a value of 0 turned it off.</p></section></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECSYNCSERVICES" title="Sync Services"></a><h3 class="jump">Sync Services</h3><p>When working with Sync Services, Syncrospector (in <code>/Developer/Applications/Utilities</code>) is an invaluable tool.</p><p>Sync Services logs information about its activities to <code>~/Library/Logs/Sync</code>. You can radically increase the level of logging by running the following commands in Terminal.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE72" title="Listing 72Enabling Sync Services logging"></a><p class="codesample clear"><strong class="caption_number">Listing 72</strong>&nbsp;&nbsp;Enabling Sync Services logging</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>$ defaults write -g SyncServicesLogEverything YES $ defaults write com.apple.syncserver SaveSyncServicesDirectory YES<span></span></pre></td></tr></tbody></table></div><p>You must log out and log back in for the settings to become effective.</p><p>This will log a lot of information to <code>~/Library/Application Support/SyncServices</code>. Because this logs so much data, you should make sure to disable it when you're done. You can do that with the following commands.</p><a name="//apple_ref/doc/uid/DTS10003391-CH1-SOURCECODE73" title="Listing 73Disabling Sync Services logging"></a><p class="codesample clear"><strong class="caption_number">Listing 73</strong>&nbsp;&nbsp;Disabling Sync Services logging</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>defaults delete -g SyncServicesLogEverything defaults delete com.apple.syncserver SaveSyncServicesDirectory rm -rf ~/Library/Application\ Support/SyncServices/Local/ save.isyncplayback<span></span></pre></td></tr></tbody></table></div><p>Don't forget to log out and log back in!</p></section><div class="back_to_top"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS10003391-CH1-SECNETWORKING" title="Networking"></a><h2 class="jump">Networking</h2><p>The most critical tool for debugging network code is the packet trace. <span class="content_text"><a href="https://developer.apple.com/qa/qa2001/qa1176.html" class="urlLink" rel="external">Technical Q&amp;A QA1176, 'Getting a Packet Trace'</a></span> discusses how to get a packet trace on Mac OS X.</p><p>The <code>netstat</code> tool can display a wealth of information about the state of the local machine's network stack; see its <span class="content_text"><a href="x-man-page://1/netstat" class="urlLink" rel="external">man page</a></span> for details.</p><p>If you want to know what sockets a process has open, you can use the <code>lsof</code> tool; see its <span class="content_text"><a href="x-man-page://8/lsof" class="urlLink" rel="external">man page</a></span> for details.</p><p>The <code>nc</code> tool is extremely useful for basic network testing; see its <span class="content_text"><a href="x-man-page://1/nc" class="urlLink" rel="external">man page</a></span> for details.</p><p>The <code>telnet</code> tool can also be useful for basic networking testing; see its <span class="content_text"><a href="x-man-page://1/telnet" class="urlLink" rel="external">man page</a></span> for details.</p><p>When debugging Transport Layer Security (TLS, formerly known as the Secure Sockets Layer, or SSL) problems, OpenSSL's <span class="content_text"><a href="x-man-page://1ssl/s_client" class="urlLink" rel="external">s_client</a></span> and <span class="content_text"><a href="x-man-page://1ssl/s_server" class="urlLink" rel="external">s_server</a></span> subcommands are extremely useful.</p><p>The AirPort daemon (<code>/usr/libexec/airportd</code>) has a number of cool debugging features. To learn more, run the daemon from Terminal without any arguments and read the resulting help text.</p><div class="back_to_top"><a href="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#top">Back to Top</a></div></section><br><hr><a name="//apple_ref/doc/uid/DTS10003391-CH1-DontLinkElementID_1" title="Document Revision History"></a><a name="//apple_ref/doc/uid/DTS10003391-RevisionHistory-DontLinkElementID_1" title="Document Revision History"></a><h4>Document Revision History</h4><br><table class="graybox revision-history" border="0" cellspacing="0" cellpadding="5"><colgroup span="1"><col width="145"></colgroup><tbody><tr><th scope="col" align="left"><strong>Date</strong></th><th scope="col" align="left"><strong>Notes</strong></th></tr><tr><td scope="row">2010-11-16</td><td><p>Updates the document for Mac OS X 10.6.</p></td></tr><tr><td scope="row">2007-01-10</td><td><p>Corrected a misspelling.</p></td></tr><tr><td scope="row">2006-07-25</td><td><p></p></td></tr><tr><td scope="row">2006-04-11</td><td><p>Added a warning about CFZombieLevel. Corrected bug in Listing 20.</p></td></tr><tr><td scope="row">2006-03-31</td><td><p>A general update for Mac OS X 10.4.x on PowerPC- and Intel-based computers.  Added new sections covering the standard C++ library, launchd, lookupd, Disk Utility, Core Graphics, and the Objective-C runtime.</p></td></tr><tr><td scope="row">2004-12-02</td><td><p>New document that 
					describes a large collection of Mac OS X debugging hints and tips.</p></td></tr></tbody></table><br>
        <div id="pageNavigationLinks_bottom" class="pageNavigationLinks">
            
        </div><br>
        <div class="copyright"><br><hr><div align="center"><p class="content_text" lang="en" dir="ltr"> Copyright Â© 2010 Apple Inc. All Rights Reserved. <a href="http://www.apple.com/legal/internet-services/terms/site.html" target="_blank">Terms of Use</a>   |  <a href="http://www.apple.com/privacy/" target="_blank">Privacy Policy</a>  |  Updated: 2010-11-16</p></div></div>

        <!-- /CONTENTS -->
        <div id="pediaWindow">
            <div id="pediaHeader"></div>
            <div id="pediaBody"></div>
        </div>
    </article>

    <div id="blackout">
    <div id="preload"></div>
</div>
<div id="leave_feedback" class="button" role="button" tabindex="0">Provide Feedback</div>
<div id="modal" aria-hidden="true">
    <div id="closebox" tabindex="0" aria-label="Close feedback form" role="button"></div>
    <div id="sending" class="hidden">
        <h2 tabindex="0">Sending feedbackâ€¦</h2>
        <div id="sending_img"></div>
    </div>
    <div id="error" class="hidden">
        <h2 tabindex="0">Weâ€™re sorry, an error has occurred.</h2>
        <p>Please try submitting your feedback later.</p>
        <div id="error_icon"></div>
    </div>
    <div id="success" class="hidden">
        <h2 tabindex="0">Thank you for providing feedback!</h2>
        <p>Your input helps improve our developer documentation.</p>
        <div id="thank_you_icon"></div>
    </div>
    
    <form id="feedback" action="https://developer.apple.com/library/mac/technotes/tn2124/_index.html#" method="post">
        <div class="left-leaf">
            <h2 id="helpful_title" data-asterisk="a1" tabindex="0">How helpful is this document?</h2>     
            <sup id="a1" class="asterisk" aria-hidden="true">*</sup>

            <div id="star_group" role="radiogroup" aria-required="true">
                <label> 
                    <input class="radio" type="radio" name="helped" value="1"> 
                    Very helpful
                </label>
                <label> 
                    <input class="radio" type="radio" name="helped" value="2"> 
                    Somewhat helpful
                </label>
                <label>
                    <input class="radio" type="radio" name="helped" value="3"> 
                    Not helpful
                </label>
            </div>
        </div>
        <div class="right-leaf">
            <h2>How can we improve this document?</h2>
            <div id="improve" class="checkboxes">
                <label>
                    <input type="checkbox" name="typo"> 
                    Fix typos or links
                </label>
                <label>
                    <input type="checkbox" name="infoIncorrect"> 
                    Fix incorrect information
                </label>
                <label>
                    <input type="checkbox" name="needs_examples"> 
                    Add or update code samples
                </label>
                <label>
                    <input type="checkbox" name="needs_art"> 
                    Add or update illustrations
                </label>
                <label>
                    <input type="checkbox" name="missingInfo"> 
                    Add information about...
                </label>
            </div>
        </div>

        <textarea id="comment" name="problem" cols="70" rows="8" placeholder="Please tell us more about your experience with this document" data-asterisk="a2" required=""></textarea>
        <sup id="a2" class="asterisk" aria-hidden="true">*</sup>

        <input id="email" type="email" name="email" placeholder="Email (optional)" size="48">

        <p class="fineprint">
            <em aria-hidden="true"><span>*</span> Required information</em>
        </p> 

        <input id="submit" type="button" value="Send">

        <section id="legal">
            <p>
                To submit a product bug or enhancement request, please visit the 
                <a href="https://developer.apple.com/bugreporter/" target="_blank">Bug Reporter</a> 
                page.
            </p>
            <p>
                Please read <a href="http://www.apple.com/legal/policies/ideas.html" target="_blank">Apple's Unsolicited Idea Submission Policy</a> 
                before you send us your feedback.
            </p> 
        </section>
    </form>
</div>

    
    <script charset="utf-8" src="./Technical Note TN2124  Mac OS X Debugging Magic_files/prototype.js"></script>
    <script src="./Technical Note TN2124  Mac OS X Debugging Magic_files/library.js"></script>
    <script src="./Technical Note TN2124  Mac OS X Debugging Magic_files/feedback.js"></script>

<script type="text/javascript" src="./Technical Note TN2124  Mac OS X Debugging Magic_files/pagetracker.js"></script>
<script type="text/javascript">
if(typeof PageTracker !== 'undefined') {
  if(window.addEventListener) {
    window.addEventListener("load", function(){PageTracker.logPageLoad()},false);
  } else if(window.attachEvent) {
    window.attachEvent("onload",function(){PageTracker.logPageLoad()});
  }
}
</script>

<script id="hiddenlpsubmitdiv" style="display: none;"></script><script>try{for(var lastpass_iter=0; lastpass_iter < document.forms.length; lastpass_iter++){ var lastpass_f = document.forms[lastpass_iter]; if(typeof(lastpass_f.lpsubmitorig2)=="undefined"){ lastpass_f.lpsubmitorig2 = lastpass_f.submit; lastpass_f.submit = function(){ var form=this; var customEvent = document.createEvent("Event"); customEvent.initEvent("lpCustomEvent", true, true); var d = document.getElementById("hiddenlpsubmitdiv"); if (d) {for(var i = 0; i < document.forms.length; i++){ if(document.forms[i]==form){ d.innerText=i; } } d.dispatchEvent(customEvent); }form.lpsubmitorig2(); } } }}catch(e){}</script></body></html>